const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DgyaL07j.js","assets/basic-TZNKCopR.js","assets/index-yzzBeQZ6.js","assets/basic-Czn6p6qK.css","assets/nprogress-BHGRirBd.js","assets/avatar-v1-CTy651s_.js","assets/useBreakpoint-CxTVfX4w.js","assets/Col-DYB5-dge.js","assets/collapseMotion-cqUX5Jv0.js","assets/isEqual-C5fpHP8_.js","assets/eagerComputed-DI6QXORB.js","assets/index-0yPate9l.js","assets/index-CZUN42_b.js","assets/isMobile--2fOlCHx.js","assets/FormItemContext-Cyr7DhyQ.js","assets/RightOutlined-o2ph79Q2.js","assets/index-DJfuW7pi.js","assets/index-DnMFLIjL.js","assets/load-DltU-5xC.js","assets/index-CE5U6DWk.js","assets/index-Cpa2GvYs.css","assets/plugin-vueexport-helper-DlAUqK2U.js","assets/logo_small-gsCc05bA.js","assets/index-D9lOsNIi.js","assets/logo_small-BpeYkMTk.css","assets/index-CW3PfY-D.js","assets/Group-CBQ561nU.js","assets/index-gS778--p.js","assets/index-DWFwZi3y.js","assets/index-Dk-QHNLo.js","assets/index-Bh4EblnI.js","assets/hasIn-BSXZj9lR.js","assets/index-CY3Dn-vq.js","assets/index-nyqA2aKy.css","assets/index-UzYc-FbD.js","assets/index-D4W06xbQ.js","assets/pick-0tZsMZIq.js","assets/index-BYjJZ2xl.js","assets/auth-title-CyF7nMCQ.js","assets/auth-title-DH9anRsb.css","assets/regexp-BZOQi8XT.js","assets/index-CBzcYT2b.js","assets/index-j1jk-vJj.js","assets/index-CEKewxhi.js","assets/index-BKloQzsv.css","assets/index-PZ7vkh2C.js","assets/index-DVBc_o54.js","assets/ReloadOutlined-ChOzO1sA.js","assets/index-CQ9v-vL8.css","assets/index-sirc5VW3.js","assets/index-cr6a5sRF.css","assets/index-DvTlR_2A.js","assets/index-iSPYyQCC.js","assets/index-B5Z9qTI8.css","assets/index-BPEIxO40.js","assets/index-DhZLGeap.js","assets/LeftOutlined-VPGFKcfy.js","assets/index-D9AoVfq8.js","assets/index-DHbd6paj.css","assets/index-DHoIpABd.js","assets/index-c4Tri7rE.js","assets/index-C3bNAlHY.js","assets/index-CfKGofFm.js","assets/index-9vna0y0e.js","assets/forbidden-CQm9dYJy.js","assets/not-found-B5npchqy.js","assets/index-CeukUAtz.js"])))=>i.map(i=>d[i]);
import{_ as V,l as gt,i as Tn,d as Kt,h as Vt,V as mr,a as xn,b as Nn,p as ae,c as Et,e as Bn,f as Qt,g as Un,o as Wn,j as Fn,s as Hn,w as jn,$ as $n,u as Gn,k as qn,m as Kn}from"./index-yzzBeQZ6.js";import{c as _r,t as Vn,n as vr,f as Qn,m as Xn,u as zn,a as Yn,L as Ye,r as Jn,b as Zn,d as kn,e as eo,g as to,h as ro,i as no,s as oo,j as io,_ as so}from"./basic-TZNKCopR.js";import{s as ao,a as co}from"./nprogress-BHGRirBd.js";import{p as Xt}from"./pick-0tZsMZIq.js";import"./hasIn-BSXZj9lR.js";function zt(t){const e={};if(Object.keys(t||{}).forEach(r=>{t[r]!==void 0&&(e[r]=t[r])}),!(Object.keys(e).length<1))return e}const lo=()=>V(()=>import("./index-DgyaL07j.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33])),uo=["activeIcon","activePath","affixTab","affixTabOrder","hideChildrenInMenu","hideInBreadcrumb","hideInMenu","hideInTab","icon","iframeSrc","microUrl","componentPath","appName","ignoreAccess","keepAlive","link","loaded","maxNumOfOpenTab","menuVisibleWithForbidden","noBasicLayout","openInNewWindow","order","query","title"];function ho(t){const e={};return Qn(t,r=>{e[r.path]=r}),e}function fo(t,e,r,n){return Xn(t,i=>{const o=i,s=e[o.path],{component:a,name:c,microUrl:u,iframeSrc:d,children:b}=i,A=b?.filter(g=>!g?.hideInMenu);if(d||u)o.microUrl&&(o.path=`/${o.appName}${o.path}`,o.meta={componentPath:o.component}),A?.length||(o.component=async()=>Kt({name:o.name,setup(){let g=u;return g&&u.endsWith("/")&&(g=g.slice(0,-1)),()=>Vt("div",g?`MicroAppPage:${g}${o.path}`:`IframePage:${d}`)}}));else if(a&&r[a])o.component=r[a];else if(a){const g=vr(a),m=g.endsWith(".vue")?g:`${g}.vue`;n[m]?o.component=n[m]:(gt.error(`route component is invalid: ${m}`,o),o.component=n["/fallback/not-found.vue"])}else!A?.length&&!Tn(o.path)&&(s?.component?o.component=s?.component:gt.error("the routing configuration does not exist",o));const S=i.hideChildrenInMenu?[]:A??[],D=Xt(o,uo),w=zt({...s?.meta??{},...o.meta??{},...D});if(S.length>0){S.forEach(m=>{const h={name:i.name,path:i.path,meta:w};m.parents=[...i.parents??[],h],m.parent=h});let g=S[0];o.redirect&&(g=S.find(h=>h.path===o.redirect)||g),o.redirect=g.microUrl&&mr!==g.appName?`/${g.appName}${g.path}`:g.path}if(o.meta=zt({...w,parent:i.parent,parents:i.parents}),o.meta?.keepAlive&&xn(o.component)&&o.name&&Nn(o.name)){const g=o.component;o.component=async()=>{const m=await g();return m.default?Kt({name:o.name,setup(h,{attrs:f,slots:E}){return()=>Vt(m.default,{...h,...f},E)}}):m}}return Xt(o,["component","children","redirect","props","path","alias","name","meta"])})}async function po(t){const{menus:e=[],layoutMap:r={},pageMap:n={},routes:i=[]}=t,o=Vn(e);try{if(!e?.length)return[];const s={};for(const[u,d]of Object.entries(n))s[vr(u)]=d;const a=ho(i);return fo(o,a,r,s)}catch(s){throw s}}const mo=async t=>{const{router:e}=t;t.routes=_r(t.routes);const r=await po(t),n=e.getRoutes().find(o=>o.path==="/"),i=n?.children?.map(o=>o.name)??[];r.forEach(o=>{if(n&&!o.meta?.noBasicLayout)if(i?.includes(o.name)){const s=n.children?.findIndex(a=>a.name===o.name);s!==void 0&&s!==-1&&n.children&&(n.children[s]=o)}else n.children?.push(o);else e.addRoute(o)}),n&&(n.name&&e.removeRoute(n.name),e.addRoute(n))},_o=async t=>await mo({...t,layoutMap:{BasicLayout:lo},pageMap:Object.assign({"../views/about/index.vue":()=>V(()=>import("./index-UzYc-FbD.js"),__vite__mapDeps([34,1,2,3,35,12,8,9,36,31,13])),"../views/authentication/code-login/index.vue":()=>V(()=>import("./index-BYjJZ2xl.js"),__vite__mapDeps([37,38,21,2,39,40,1,3,30,7,9,31,8,14,27,11])),"../views/authentication/forget-password/index.vue":()=>V(()=>import("./index-CBzcYT2b.js"),__vite__mapDeps([41,38,21,2,39,1,3,40,30,7,9,31,8,14,27,11])),"../views/authentication/login/index.vue":()=>V(()=>import("./index-j1jk-vJj.js"),__vite__mapDeps([42,38,21,2,39,1,3,30,7,9,31,8,14,27,11,43,26,17,18,44])),"../views/authentication/qrcode-login/index.vue":()=>V(()=>import("./index-PZ7vkh2C.js"),__vite__mapDeps([45,38,21,2,39,1,3,46,47,48])),"../views/authentication/register/index.vue":()=>V(()=>import("./index-sirc5VW3.js"),__vite__mapDeps([49,38,21,2,39,1,3,30,7,9,31,8,14,27,11,43,26,50])),"../views/dashboard/analytics/index.vue":()=>V(()=>import("./index-DvTlR_2A.js"),__vite__mapDeps([51,18,2,19,1,3,16,20,35,12,8,9,36,31,13,52,7,21,53])),"../views/dashboard/workspace/index.vue":()=>V(()=>import("./index-BPEIxO40.js"),__vite__mapDeps([54,1,2,3,5,6,7,8,9,10,11,12,13,14,15,19,18,16,20,35,36,31,21,46,55,56,43,26,57,52,58])),"../views/demos/form/index.vue":()=>V(()=>import("./index-DHoIpABd.js"),__vite__mapDeps([59,1,2,3,23,12,8,9,15,16,60,28,36,31,52,7,57,30,14,46,6,35,13])),"../views/demos/index.vue":()=>V(()=>import("./index-C3bNAlHY.js"),__vite__mapDeps([61,21,2])),"../views/demos/table/index.vue":()=>V(()=>import("./index-CfKGofFm.js"),__vite__mapDeps([62,2,23,1,3,12,8,9,15,60,28,36,31,52,7,57,30,14,46,6,35,13,29,32,55,56,10,11,27,63,26,43,47])),"../views/fallback/forbidden.vue":()=>V(()=>import("./forbidden-CQm9dYJy.js"),__vite__mapDeps([64,19,2,18,1,3,16,20])),"../views/fallback/not-found.vue":()=>V(()=>import("./not-found-B5npchqy.js"),__vite__mapDeps([65,19,2,18,1,3,16,20]))})}),vo=t=>{const e=new Set;t.beforeEach(r=>(r.meta.loaded=e.has(r.path),!r.meta.loaded&&ae.transition.progress&&ao(),!0)),t.afterEach(r=>{e.add(r.path),ae.transition.progress&&co()})},go=t=>{t.beforeEach(async(e,r)=>{if(Et.powerByMicro)return!0;const n=zn();if(Yn.includes(e.name))return e.path===Ye&&n.accessToken?decodeURIComponent(e.query?.redirect||n.userInfo?.homePath||ae.app.defaultHomePath):!0;if(!n.accessToken){if(e.meta.ignoreAccess)return!0;if(e.fullPath!==Ye)return{path:Ye,query:e.fullPath===ae.app.defaultHomePath?{}:{redirect:encodeURIComponent(e.fullPath)},replace:!0}}if(n.isAccessChecked)return!0;const i=n.userInfo||await n.fetchUserInfo();if(!i)return Jn(),{path:Ye,query:e.fullPath===ae.app.defaultHomePath?{}:{redirect:encodeURIComponent(e.fullPath)},replace:!0};const o=await n.fetchAccessMenus();n.setAccessMenus(o),await _o({router:t,menus:_r(o),routes:Zn}),n.setIsAccessChecked(!0);const s=r.query.redirect??(e.path===ae.app.defaultHomePath?i.homePath||ae.app.defaultHomePath:e.fullPath);return{...t.resolve(decodeURIComponent(s)),replace:!0}})};function Eo(t){vo(t),go(t)}const Dt=kn({history:Bn==="hash"?eo(Qt):to(Qt),routes:ro,scrollBehavior:(t,e,r)=>r||(t.hash?{behavior:"smooth",el:t.hash}:{left:0,top:0})}),wo=t=>{t.use(Dt)};Eo(Dt);const Ao="1.0.0-rc.26",st=typeof window<"u",gr=typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:Function("return this")(),bo=()=>!1,le=Array.isArray,k=Object.assign,H=Object.defineProperty,ee=Object.defineProperties,Po=Object.prototype.toString,we=Object.prototype.hasOwnProperty,K=t=>Po.call(t);function ve(t){return t===void 0}function Ue(t){return t===null}function B(t){return typeof t=="string"}function Er(t){return typeof t=="boolean"}function wt(t){return typeof t=="number"}function R(t){return typeof t=="function"}function U(t){return K(t)==="[object Object]"}function Ro(t){return!Ue(t)&&typeof t=="object"}function At(t){return K(t)==="[object Promise]"}function So(t){var e;return R(t)&&((e=t.name)===null||e===void 0?void 0:e.indexOf("bound "))===0&&!t.hasOwnProperty("prototype")}function at(t){var e;if(R(t)){const r=t.toString();return((e=t.prototype)===null||e===void 0?void 0:e.constructor)===t&&Object.getOwnPropertyNames(t.prototype).length>1||/^function\s+[A-Z]/.test(r)||/^class\s+/.test(r)}return!1}function yo(t){return typeof ShadowRoot<"u"&&t instanceof ShadowRoot}function ct(t){var e;return t instanceof URL||!!(!((e=t)===null||e===void 0)&&e.href)}function he(t){var e;return t instanceof Element||B((e=t)===null||e===void 0?void 0:e.tagName)}function De(t){var e;return t instanceof Node||wt((e=t)===null||e===void 0?void 0:e.nodeType)}function Mo(t){return K(t)==="[object HTMLAnchorElement]"}function Oo(t){return K(t)==="[object HTMLAudioElement]"}function Do(t){return K(t)==="[object HTMLVideoElement]"}function Co(t){return K(t)==="[object HTMLLinkElement]"}function Io(t){return K(t)==="[object HTMLBodyElement]"}function wr(t){return K(t)==="[object HTMLStyleElement]"}function Se(t){return K(t)==="[object HTMLScriptElement]"}function Lo(t){return K(t)==="[object HTMLDivElement]"}function To(t){return K(t)==="[object HTMLImageElement]"}function xo(t){return K(t)==="[object HTMLBaseElement]"}function ke(t){return K(t)==="[object DocumentFragment]"}function No(t){return K(t)==="[object ShadowRoot]"}function et(t){return he(t)&&t.tagName.toUpperCase()==="MICRO-APP-BODY"}function Bo(t){return he(t)&&t.tagName.toUpperCase()==="MICRO-APP-HEAD"}function Uo(t){let e=K(t)==="[object HTMLElement]";if(e){const r=t.tagName.toUpperCase();e=e&&!r.startsWith("MICRO-APP")}return e}function Wo(t){return K(t)==="[object ProxyDocument]"}function Ar(t,e){try{return W(t).pathname.split(".").pop()===e}catch{return!1}}function ne(t,e,r){if(t==null)throw new TypeError("includes target is null or undefined");const n=Object(t),i=parseInt(n.length,10)||0;if(i===0)return!1;r=parseInt(r,10)||0;let o=Math.max(r>=0?r:i+r,0);for(;o<i;){if(e===n[o]||e!==e&&n[o]!==n[o])return!0;o++}return!1}function I(t,e=null,...r){const n=e&&B(e)?` app ${e}:`:"";B(t)}function ge(t,e=null,...r){const n=e&&B(e)?` app ${e}:`:"";B(t)}function te(t,...e){Promise.resolve().then(t.bind(null,...e))}function Fo(t,e=0,...r){setTimeout(t.bind(null,...r),e)}const W=(function(){class t extends URL{}return(e,r)=>r?new t(""+e,r):new t(""+e)})();function Ct(t){return t.startsWith("//")?`${gr.location.protocol}${t}`:t}function bt(t,e=null){if(!B(t)||!t)return"";try{const{origin:r,pathname:n,search:i}=W(Ct(t),(window.rawWindow||window).location.href),o=`${r}${n}${i}`;return/^https?:\/\//.test(o)?o:""}catch(r){return I(r,e),""}}function $(t){return!B(t)||!t?"":t.replace(/(^\d+)|([^\w\d-_])/gi,"")}function lt(t){const{origin:e,pathname:r}=W(t);if(/\.(\w+)$/.test(r)){const n=`${e}${r}`.split("/");return n.pop(),n.join("/")+"/"}return`${e}${r}/`.replace(/\/\/$/,"/")}function z(t,e){return!t||/^((((ht|f)tps?)|file):)?\/\//.test(t)||/^(data|blob):/.test(t)?t:W(t,lt(Ct(e))).toString()}function Ho(t){const e=t.split("/");return e.pop(),Ct(e.join("/")+"/")}function ut(t,e,r,n){let i=0;function o(){++i===t.length&&n&&n()}t.forEach((s,a)=>{At(s)?s.then(c=>{e({data:c,index:a}),o()}).catch(c=>{r({error:c,index:a}),o()}):(e({data:s,index:a}),o())})}function jo(){return"noModule"in document.createElement("script")}function $o(){return"inline-"+Math.random().toString(36).substr(2,15)}function Go(t){return t.filter(function(e){return e in this?!1:this[e]=!0},Object.create(null))}const ht=gr.requestIdleCallback||function(t){const e=Date.now();return setTimeout(function(){t({didTimeout:!1,timeRemaining(){return Math.max(0,50-(Date.now()-e))}})},1)};function br(t){return new Promise(e=>{ht(()=>{t(e)})})}let It=null;function Pt(t){It=t}function Q(){return It}function We(t){It!==t&&!xt()&&(Pt(t),te(()=>{Pt(null)}))}let Lt=null;function Rt(t){Lt=t}function Je(){return Lt}function Tt(t){Lt!==t&&!xt()&&(Rt(t),te(()=>{Rt(null)}))}let Te=!1;function xt(){return Te}function G(t){t!==!1?(Pt(null),Rt(null),t&&!Te&&(Te=!0,te(()=>{Te=!1}))):Te=!1}function Y(t,e){const r=(window.rawDocument||document).createElement(t,e);return r.__MICRO_APP_NAME__&&delete r.__MICRO_APP_NAME__,r.__PURE_ELEMENT__=!0,r}function pe(t){return!t||/(^\d)|([^\w\d-_\u4e00-\u9fa5])/gi.test(t)}function ye(t){return/^body$/i.test(t)||/^head$/i.test(t)||/^html$/i.test(t)||/^title$/i.test(t)||/^:root$/i.test(t)}function de(t){return yo(t)?t.host:t}function vt(t){return t?t.replace(/^\s+|\s+$/g,""):""}function Yt(){return navigator.userAgent.indexOf("Firefox")>-1}function Jt(t){const e={},r=t.split("&");for(const n of r){const i=n.indexOf("="),o=i<0?n:n.slice(0,i),s=i<0?null:n.slice(i+1);if(o in e){let a=e[o];le(a)||(a=e[o]=[a]),a.push(s)}else e[o]=s}return e}function tt(t){let e="";for(const r in t){const n=t[r];Ue(n)?e+=(e.length?"&":"")+r:(le(n)?n:[n]).forEach(o=>{ve(o)||(e+=(e.length?"&":"")+r,Ue(o)||(e+="="+o))})}return e}function Zt(){const t=new Set;function e(r){return t.add(r),()=>t.has(r)?t.delete(r):!1}return{add:e,list:()=>t}}function qo(){const t=new Map;function e(r,n){return t.set(r,n),()=>t.has(r)?t.delete(r):!1}return{add:e,get:r=>t.get(r),delete:r=>t.has(r)?t.delete(r):!1}}function St(t){const e=t.attributes,r=new Map;for(let n=0;n<e.length;n++)r.set(e[n].name,e[n].value);return r}function Fe(t,e){t?t.push(()=>br(r=>{e(),r()})):e()}function He(t){return t?.reduce((e,r)=>e.then(r),Promise.resolve())||null}function je(t){return t.startsWith("inline-")}function kt(t,e,r,...n){try{R(t)&&t(...n)}catch(i){I(`An error occurred in app ${e} window.${r} 
`,null,i)}}function Ko(t){for(;t?.firstChild;)t.removeChild(t.firstChild)}function er(t,e){if(t==null)return!1;if(R(e)){if(typeof t=="number"||typeof t=="string"||typeof t=="boolean")return!1}else throw new TypeError("Right-hand side of 'instanceof' is not callable");let r=Object.getPrototypeOf(t);for(;r;){if(r===e.prototype)return!0;r=Object.getPrototypeOf(r)}return!1}const Vo=["mounted","unmount"];function yt(t,e){return Vo.includes(t)?`${t}-${e}`:t}function Qo(t){return U(t)?!Object.keys(t).length:!0}function Xo(t,e){Object.defineProperties(t,{currentTarget:{get(){return e}},target:{get(){return e}}})}function fe(t,e,r,n){var i;if(!t)return ge(`element does not exist in lifecycle ${r}`,e);t=de(t),G();const o=k({name:e,container:t},n&&{error:n}),s=new CustomEvent(r,{detail:o});Xo(s,t),R((i=v.options.lifeCycles)===null||i===void 0?void 0:i[r])&&v.options.lifeCycles[r](s,e),t.dispatchEvent(s)}function se(t,e,r={}){var n;const i=new CustomEvent(yt(e,t.name),{detail:r});(n=t.sandBox)===null||n===void 0||n.microAppWindow.dispatchEvent(i)}function Ae(t,e=null,r={}){return G(),R(v.options.fetch)?v.options.fetch(t,r,e):window.fetch(t,r).then(n=>n.text())}class Nt{static getInstance(){return this.instance||(this.instance=new Nt),this.instance}run(e,r){const n=e.name,i=e.ssrUrl||e.url;(Ar(i,"js")?Promise.resolve(`<micro-app-head><script src='${i}'><\/script></micro-app-head><micro-app-body></micro-app-body>`):Ae(i,n,{cache:"no-cache"})).then(a=>{if(!a){const c="html is empty, please check in detail";return e.onerror(new Error(c)),I(c,n)}a=this.formatHTML(i,a,n),r(a,e)}).catch(a=>{I(`Failed to fetch data from ${e.url}, micro-app stop rendering`,n,a),e.onLoadError(a)})}formatHTML(e,r,n){return this.processHtml(e,r,n,v.options.plugins).replace(/<head[^>]*>[\s\S]*?<\/head>/i,i=>i.replace(/<head/i,"<micro-app-head").replace(/<\/head>/i,"</micro-app-head>")).replace(/<body[^>]*>[\s\S]*?<\/body>/i,i=>i.replace(/<body/i,"<micro-app-body").replace(/<\/body>/i,"</micro-app-body>"))}processHtml(e,r,n,i){var o;if(!i)return r;const s=[];return i.global&&s.push(...i.global),!((o=i.modules)===null||o===void 0)&&o[n]&&s.push(...i.modules[n]),s.length>0?s.reduce((a,c)=>U(c)&&R(c.processHtml)?c.processHtml(a,e):a,r):r}}const zo=/(^|\s+)(html|:root)(?=[\s>~[.#:]+|$)/,tr=/(^|\s+)((html[\s>~]+body)|body)(?=[\s>~[.#:]+|$)/;function Yo(t,e){t=e?`${e} ${t}`:t;const r=new Error(t);throw r.reason=t,e&&(r.filename=e),r}class Jo{constructor(){this.cssText="",this.prefix="",this.baseURI="",this.linkPath="",this.result="",this.scopecssDisable=!1,this.scopecssDisableSelectors=[],this.scopecssDisableNextLine=!1,this.mediaRule=this.createMatcherForRuleWithChildRule(/^@media *([^{]+)/,"@media"),this.supportsRule=this.createMatcherForRuleWithChildRule(/^@supports *([^{]+)/,"@supports"),this.documentRule=this.createMatcherForRuleWithChildRule(/^@([-\w]+)?document *([^{]+)/,"@document"),this.hostRule=this.createMatcherForRuleWithChildRule(/^@host\s*/,"@host"),this.importRule=this.createMatcherForNoneBraceAtRule("import"),this.charsetRule=this.createMatcherForNoneBraceAtRule("charset"),this.namespaceRule=this.createMatcherForNoneBraceAtRule("namespace"),this.containerRule=this.createMatcherForRuleWithChildRule(/^@container *([^{]+)/,"@container")}exec(e,r,n,i){return this.cssText=e,this.prefix=r,this.baseURI=n,this.linkPath=i||"",this.matchRules(),Yt()?decodeURIComponent(this.result):this.result}reset(){this.cssText=this.prefix=this.baseURI=this.linkPath=this.result="",this.scopecssDisable=this.scopecssDisableNextLine=!1,this.scopecssDisableSelectors=[]}matchRules(){for(this.matchLeadingSpaces(),this.matchComments();this.cssText.length&&this.cssText.charAt(0)!=="}"&&(this.matchAtRule()||this.matchStyleRule());)this.matchComments()}matchStyleRule(){const e=this.formatSelector(!0);return this.scopecssDisableNextLine=!1,e?(this.recordResult(e),this.matchComments(),this.styleDeclarations(),this.matchLeadingSpaces(),!0):this.printError("selector missing",this.linkPath)}formatSelector(e){const r=this.commonMatch(/^[^{]+/,e);if(!r)return!1;const n={};return r[0].replace(/\[([^\]=]+)(?:=([^\]]+))?\]/g,(o,s,a,c)=>{const u=`__mock_${s}_${c}Value__`;return n[u]=a,o.replace(a,u)}).replace(/(^|,[\n\s]*)([^,]+)/g,(o,s,a)=>(a=vt(a),a=a.replace(/\[[^\]=]+(?:=([^\]]+))?\]/g,(c,u)=>n[u]?c.replace(u,n[u]):c),a&&!(this.scopecssDisableNextLine||this.scopecssDisable&&(!this.scopecssDisableSelectors.length||this.scopecssDisableSelectors.includes(a))||zo.test(a))&&(tr.test(a)?a=a.replace(tr,this.prefix+" micro-app-body"):a=this.prefix+" "+a),s+a))}styleDeclarations(){return this.matchOpenBrace()?(this.matchAllDeclarations(),this.matchCloseBrace()?!0:this.printError("Declaration missing '}'",this.linkPath)):this.printError("Declaration missing '{'",this.linkPath)}matchAllDeclarations(e=0){let r=this.commonMatch(/^(?:url\(["']?(?:[^)"'}]+)["']?\)|[^{}/])*/,!0)[0];if(r&&(!this.scopecssDisableNextLine&&(!this.scopecssDisable||this.scopecssDisableSelectors.length)&&(r=r.replace(/url\((["']?)(.*?)\1\)/gm,(n,i,o)=>/^((data|blob):|#|%23)/.test(o)||/^(https?:)?\/\//.test(o)?n:(/^((\.\.?\/)|[^/])/.test(o)&&this.linkPath&&(this.baseURI=Ho(this.linkPath)),`url("${z(o,this.baseURI)}")`))),this.recordResult(r)),this.scopecssDisableNextLine=!1,!!this.cssText.length){if(this.cssText.charAt(0)==="/")this.cssText.charAt(1)==="*"?this.matchComments():this.commonMatch(/\/+/);else if(this.cssText.charAt(0)==="{")this.matchOpenBrace(),e++;else if(this.cssText.charAt(0)==="}"){if(e<1)return;this.matchCloseBrace(),e--}return this.matchAllDeclarations(e)}}matchAtRule(){return this.cssText[0]!=="@"?!1:(this.scopecssDisableNextLine=!1,this.keyframesRule()||this.mediaRule()||this.customMediaRule()||this.supportsRule()||this.importRule()||this.charsetRule()||this.namespaceRule()||this.containerRule()||this.documentRule()||this.pageRule()||this.hostRule()||this.fontFaceRule()||this.layerRule())}keyframesRule(){if(!this.commonMatch(/^@([-\w]+)?keyframes\s*/))return!1;if(!this.commonMatch(/^[^{]+/))return this.printError("@keyframes missing name",this.linkPath);if(this.matchComments(),!this.matchOpenBrace())return this.printError("@keyframes missing '{'",this.linkPath);for(this.matchComments();this.keyframeRule();)this.matchComments();return this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):this.printError("@keyframes missing '}'",this.linkPath)}keyframeRule(){let e;const r=[];for(;e=this.commonMatch(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)r.push(e[1]),this.commonMatch(/^,\s*/);return r.length?(this.styleDeclarations(),this.matchLeadingSpaces(),!0):!1}customMediaRule(){return this.commonMatch(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/)?(this.matchLeadingSpaces(),!0):!1}pageRule(){return this.commonMatch(/^@page */)?(this.formatSelector(!1),this.scopecssDisableNextLine=!1,this.commonHandlerForAtRuleWithSelfRule("page")):!1}fontFaceRule(){return this.commonMatch(/^@font-face\s*/)?this.commonHandlerForAtRuleWithSelfRule("font-face"):!1}layerRule(){return this.commonMatch(/^@layer\s*([^{;]+)/)?this.matchOpenBrace()?(this.matchComments(),this.matchRules(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):this.printError("@layer missing '}'",this.linkPath)):!!this.commonMatch(/^[;]+/):!1}createMatcherForRuleWithChildRule(e,r){return()=>this.commonMatch(e)?this.matchOpenBrace()?(this.matchComments(),this.matchRules(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):this.printError(`${r} missing '}'`,this.linkPath)):this.printError(`${r} missing '{'`,this.linkPath):!1}createMatcherForNoneBraceAtRule(e){const r=new RegExp("^@"+e+"\\s*([^;]+);");return()=>this.commonMatch(r)?(this.matchLeadingSpaces(),!0):!1}commonHandlerForAtRuleWithSelfRule(e){return this.matchOpenBrace()?(this.matchAllDeclarations(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):this.printError(`@${e} missing '}'`,this.linkPath)):this.printError(`@${e} missing '{'`,this.linkPath)}matchComments(){for(;this.matchComment(););}matchComment(){if(this.cssText.charAt(0)!=="/"||this.cssText.charAt(1)!=="*")return!1;this.scopecssDisableNextLine=!1;let e=2;for(;this.cssText.charAt(e)!==""&&(this.cssText.charAt(e)!=="*"||this.cssText.charAt(e+1)!=="/");)++e;if(e+=2,this.cssText.charAt(e-1)==="")return this.printError("End of comment missing",this.linkPath);let r=this.cssText.slice(2,e-2);return this.recordResult(`/*${r}*/`),r=vt(r.replace(/^\s*!/,"")),r==="scopecss-disable-next-line"?this.scopecssDisableNextLine=!0:/^scopecss-disable/.test(r)?r==="scopecss-disable"?this.scopecssDisable=!0:(this.scopecssDisable=!0,r.replace("scopecss-disable","").split(",").forEach(i=>{this.scopecssDisableSelectors.push(vt(i))})):r==="scopecss-enable"&&(this.scopecssDisable=!1,this.scopecssDisableSelectors=[]),this.cssText=this.cssText.slice(e),this.matchLeadingSpaces(),!0}commonMatch(e,r=!1){const n=e.exec(this.cssText);if(!n)return;const i=n[0];return this.cssText=this.cssText.slice(i.length),r||this.recordResult(i),n}matchOpenBrace(){return this.commonMatch(/^{\s*/)}matchCloseBrace(){return this.commonMatch(/^}\s*/)}matchLeadingSpaces(){this.commonMatch(/^\s*/)}recordResult(e){Yt()?this.result+=encodeURIComponent(e):this.result+=e}printError(e,r){this.cssText.length&&Yo(e,r)}}function rr(t,e,r,n,i){if(!t.__MICRO_APP_HAS_SCOPED__){t.__MICRO_APP_HAS_SCOPED__=!0;let o=null;try{o=xe.exec(t.textContent,r,n,i),xe.reset()}catch(s){xe.reset(),I(`An error occurred while parsing CSS:
`,e,s)}o&&(t.textContent=o)}}let xe;function dt(t,e,r){if(e.scopecss){const n=Bt(e.name);xe||(xe=new Jo);const i=o=>o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(t.textContent){rr(t,e.name,n,e.url,r);const o=new MutationObserver(()=>{const s=i(n),a=t.textContent&&new RegExp(s).test(t.textContent);o.disconnect(),a||(t.__MICRO_APP_HAS_SCOPED__=!1,dt(t,e,r))});o.observe(t,{childList:!0,characterData:!0})}else{const o=new MutationObserver(function(){o.disconnect(),t.textContent&&!t.hasAttribute("data-styled")&&rr(t,e.name,n,e.url,r)});o.observe(t,{childList:!0})}}return t}function Bt(t,e=!1){const r=e?"\\":"";return`${v.tagName}${r}[name=${t}${r}]`}function Pr(t,e){Object.defineProperties(t,{currentTarget:{get(){return e}},srcElement:{get(){return e}},target:{get(){return e}}})}function Rr(t){const e=new CustomEvent("load");Pr(e,t),R(t.onload)?t.onload(e):t.dispatchEvent(e)}function Sr(t){const e=new CustomEvent("error");Pr(e,t),R(t.onerror)?t.onerror(e):t.dispatchEvent(e)}function Zo(){const t=new Map,e=new Map;function r(n){return{setInfo(i,o){n.set(i,o)},getInfo(i){var o;return(o=n.get(i))!==null&&o!==void 0?o:null},hasInfo(i){return n.has(i)},deleteInfo(i){return n.delete(i)}}}return{link:r(t),script:Object.assign(Object.assign({},r(e)),{deleteInlineInfo(n){n.forEach(i=>{je(i)&&e.delete(i)})}})}}var J=Zo();function ko(t,e,r){const n=r.appSpace;for(const i in n)if(i!==t){const o=n[i];if(o.parsedCode)return o.parsedCode.replace(new RegExp(Bt(i,!0),"g"),e)}}function ei(t,e){e.forEach((r,n)=>{n!=="rel"&&(n==="href"&&(n="data-origin-href"),l.rawSetAttribute.call(t,n,r))})}function yr(t,e,r,n=!1){const i=t.getAttribute("rel");let o=t.getAttribute("href"),s=null;if(i==="stylesheet"&&o){o=z(o,r.url);let a=J.link.getInfo(o);const c={attrs:St(t)};if(a?a.appSpace[r.name]=a.appSpace[r.name]||c:a={code:"",appSpace:{[r.name]:c}},J.link.setInfo(o,a),!n)r.source.links.add(o),s=document.createComment(`link element with href=${o} move to micro-app-head as style element`),a.appSpace[r.name].placeholder=s;else return{address:o,linkInfo:a}}else i&&["prefetch","preload","prerender","modulepreload","icon"].includes(i)?n?s=document.createComment(`link element with rel=${i}${o?" & href="+o:""} removed by micro-app`):e?.removeChild(t):o&&l.rawSetAttribute.call(t,"href",z(o,r.url));if(n)return{replaceComment:s};if(s)return e?.replaceChild(s,t)}function ti(t,e,r,n){const i=Array.from(e.source.links),o=i.map(a=>{const c=J.link.getInfo(a);return c.code?c.code:Ae(a,e.name)}),s=n?[]:null;ut(o,a=>{Fe(s,()=>ri(i[a.index],a.data,r,e))},a=>{I(a,e.name)},()=>{n?n.then(()=>{s.push(()=>Promise.resolve(e.onLoad({html:t}))),He(s)}):e.onLoad({html:t})})}function ri(t,e,r,n){const i=J.link.getInfo(t);i.code=e;const o=i.appSpace[n.name],s=o.placeholder;if(s){const a=Y("style");Mr(n,t,a,i,o.attrs),s.parentNode?s.parentNode.replaceChild(a,s):r.appendChild(a),o.placeholder=null}}function Mr(t,e,r,n,i){if(t.scopecss){const o=n.appSpace[t.name];if(o.prefix=o.prefix||Bt(t.name),o.parsedCode)r.textContent=o.parsedCode;else{const s=ko(t.name,o.prefix,n);s?r.textContent=s:(r.textContent=n.code,dt(r,t,e)),o.parsedCode=r.textContent}}else r.textContent=n.code;ei(r,i)}function ni(t,e,r,n){const i=Y("style"),o=()=>{Mr(e,t,i,r,r.appSpace[e.name].attrs),Rr(n)};return r.code?te(o):Ae(t,e.name).then(s=>{r.code=s,o()}).catch(s=>{I(s,e.name),Sr(n)}),i}var Ne;(function(t){t.NAME="name",t.URL="url"})(Ne||(Ne={}));var j;(function(t){t.CREATED="created",t.LOADING="loading",t.LOAD_FAILED="load_failed",t.BEFORE_MOUNT="before_mount",t.MOUNTING="mounting",t.MOUNTED="mounted",t.UNMOUNT="unmount"})(j||(j={}));var N;(function(t){t.CREATED="created",t.BEFOREMOUNT="beforemount",t.MOUNTED="mounted",t.UNMOUNT="unmount",t.ERROR="error",t.BEFORESHOW="beforeshow",t.AFTERSHOW="aftershow",t.AFTERHIDDEN="afterhidden"})(N||(N={}));var Pe;(function(t){t.ONMOUNT="onmount",t.ONUNMOUNT="onunmount"})(Pe||(Pe={}));var Be;(function(t){t.KEEP_ALIVE_SHOW="keep_alive_show",t.KEEP_ALIVE_HIDDEN="keep_alive_hidden"})(Be||(Be={}));var nr;(function(t){t.DESTROY="destroy",t.DESTORY="destory",t.INLINE="inline",t.DISABLESCOPECSS="disableScopecss",t.DISABLESANDBOX="disableSandbox",t.DISABLE_SCOPECSS="disable-scopecss",t.DISABLE_SANDBOX="disable-sandbox",t.DISABLE_MEMORY_ROUTER="disable-memory-router",t.DISABLE_PATCH_REQUEST="disable-patch-request",t.KEEP_ROUTER_STATE="keep-router-state",t.KEEP_ALIVE="keep-alive",t.CLEAR_DATA="clear-data",t.SSR="ssr",t.FIBER="fiber"})(nr||(nr={}));const or="window,self,globalThis,document,Document,Array,Object,String,Boolean,Math,Number,Symbol,Date,Function,Proxy,WeakMap,WeakSet,Set,Map,Reflect,Element,Node,RegExp,Error,TypeError,JSON,isNaN,parseFloat,parseInt,performance,console,decodeURI,encodeURI,decodeURIComponent,encodeURIComponent,navigator,undefined,location,history",ir=[1,2,3],Or="state",$e="search",rt="native",Dr="native-scope",Cr="pure",oi=[$e,Or,rt,Dr,Cr],Ir=["popstate","hashchange","load","unload","unmount","appstate-change","statechange","mounted","error"],ii=Ir,si=Ir.concat(["unhandledrejection","message"]),Lr=["onpopstate","onhashchange","onload","onunload","onerror"],ai=Lr,ci=Lr.concat(["onunhandledrejection"]),li=["DOMContentLoaded","readystatechange"],ui=["onreadystatechange"],Tr=["window","self","globalThis"],hi=["rawWindow","rawDocument"],di=["host","hostname","port","protocol","origin"],fi=["text/javascript","text/ecmascript","application/javascript","application/ecmascript","module","systemjs-module","systemjs-importmap"];function me(t,e){return e.appSpace[t.name].module&&(!t.useSandbox||t.iframe)}function pi(t,e){return e.appSpace[t.name].attrs.has("id")}function ft(t,e){return t.inline||e.appSpace[t.name].inline||me(t,e)||pi(t,e)}function xr(t){return t.iframe?t.sandBox.microAppWindow:l.rawWindow}function mi(t,e){const r=xr(t);return new r.Function(e)}function _i(t,e,r){const n=e.appSpace;for(const i in n)if(i!==t.name){const o=n[i];if(o.parsedCode===r&&o.parsedFunction)return o.parsedFunction}}function Nr(t,e,r){return _i(t,e,r)||mi(t,r)}function Br(){const t=$o();return J.script.hasInfo(t)?Br():t}function vi(t,e){e.forEach((r,n)=>{n==="type"&&r==="module"||n==="defer"||n==="async"||(n==="src"&&(n="data-origin-src"),l.rawSetAttribute.call(t,n,r))})}function Ur(t,e){return t.useSandbox&&!me(t,e)}function Wr(t,e){return Ur(t,e)?t.iframe?"iframe":"with":"disable"}function Fr(t,e,r,n=!1){var i;let o=null,s=t.getAttribute("src");if(s&&(s=z(s,r.url)),t.hasAttribute("exclude")||Ut(s,r.name))o=document.createComment("script element with exclude attribute removed by micro-app");else{if(t.type&&!fi.includes(t.type)||t.hasAttribute("ignore")||Wt(s,r.name))return!((i=l.rawDocument)===null||i===void 0)&&i.currentScript&&delete l.rawDocument.currentScript,null;if(l.supportModuleScript&&t.noModule||!l.supportModuleScript&&t.type==="module")o=document.createComment(`${t.noModule?"noModule":"module"} script ignored by micro-app`);else if(s){let a=J.script.getInfo(s);const c={async:t.hasAttribute("async"),defer:t.defer||t.type==="module",module:t.type==="module",inline:t.hasAttribute("inline"),pure:t.hasAttribute("pure"),attrs:St(t)};if(a?a.appSpace[r.name]=a.appSpace[r.name]||c:a={code:"",isExternal:!0,appSpace:{[r.name]:c}},J.script.setInfo(s,a),!n)r.source.scripts.add(s),o=document.createComment(`script with src='${s}' extract by micro-app`);else return{address:s,scriptInfo:a}}else if(t.textContent){const a=Br(),c={code:t.textContent,isExternal:!1,appSpace:{[r.name]:{async:!1,defer:t.type==="module",module:t.type==="module",inline:t.hasAttribute("inline"),pure:t.hasAttribute("pure"),attrs:St(t)}}};if(!n)r.source.scripts.add(a),J.script.setInfo(a,c),o=document.createComment("inline script extract by micro-app");else return{address:a,scriptInfo:c}}else n||(o=document.createComment("script element removed by micro-app"))}return n?{replaceComment:o}:e?.replaceChild(o,t)}function Hr(t){var e,r,n;const i=((e=v.options.plugins)===null||e===void 0?void 0:e.global)||[],o=((n=(r=v.options.plugins)===null||r===void 0?void 0:r.modules)===null||n===void 0?void 0:n[t])||[];return[...i,...o]}function Ut(t,e){return t?(Hr(e)||[]).some(n=>n.excludeChecker?n.excludeChecker(t):!1):!1}function Wt(t,e){return t?(Hr(e)||[]).some(n=>n.ignoreChecker?n.ignoreChecker(t):!1):!1}function gi(t,e){const r=Array.from(e.source.scripts),n=[],i=[];for(const s of r){const a=J.script.getInfo(s),c=a.appSpace[e.name];(!c.defer&&!c.async||e.isPrefetch&&!e.isPrerender)&&(n.push(a.code?a.code:Ae(s,e.name)),i.push([s,a]))}const o=e.isPrefetch||e.fiber?[]:null;n.length?ut(n,s=>{Fe(o,()=>Ei(i[s.index][0],i[s.index][1],s.data,e))},s=>{I(s,e.name)},()=>{o?(o.push(()=>Promise.resolve(e.onLoad({html:t}))),He(o)):e.onLoad({html:t})}):e.onLoad({html:t})}function Ei(t,e,r,n){if(e.code=r,n.isPrefetch&&n.prefetchLevel===2){const i=e.appSpace[n.name];if(!i.parsedCode&&(i.parsedCode=jr(t,n,r,e),i.sandboxType=Wr(n,e),!ft(n,e)))try{i.parsedFunction=Nr(n,e,i.parsedCode)}catch(o){I("Something went wrong while handling preloaded resources",n.name,`
`,o)}}}function wi(t,e){const r=t.fiber?[]:null,n=Array.from(t.source.scripts),i=[],o=[];for(const s of n){const a=J.script.getInfo(s),c=a.appSpace[t.name];c.defer||c.async?(a.isExternal&&!a.code&&!me(t,a)?i.push(Ae(s,t.name)):i.push(a.code),o.push([s,a]),me(t,a)&&(e.moduleCount=e.moduleCount?++e.moduleCount:1)):Fe(r,()=>{nt(s,t,a),e(!1)})}i.length?ut(i,s=>{const a=o[s.index][1];a.code=a.code||s.data},s=>{e.errorCount=e.errorCount?++e.errorCount:1,I(s,t.name)},()=>{o.forEach(([s,a])=>{B(a.code)&&Fe(r,()=>{nt(s,t,a,e),!me(t,a)&&e(!1)})}),r?(r.push(()=>Promise.resolve(e(ve(e.moduleCount)||e.errorCount===i.length))),He(r)):e(ve(e.moduleCount)||e.errorCount===i.length)}):r?(r.push(()=>Promise.resolve(e(!0))),He(r)):e(!0)}function nt(t,e,r,n,i){var o,s;try{Si(e);const a=r.appSpace[e.name],c=Wr(e,r);if((!a.parsedCode||a.sandboxType!==c)&&(a.parsedCode=jr(t,e,r.code,r),a.sandboxType=c,a.parsedFunction=null),ft(e,r)){const u=i||Y("script");if(Pi(t,a.parsedCode,me(e,r),u,a.attrs,n),!i){const d=e.iframe?(o=e.sandBox)===null||o===void 0?void 0:o.microBody:e.querySelector("micro-app-body");d?.appendChild(u)}}else Ri(e,r)}catch(a){const c=a;let u=!0;if(typeof((s=v?.options)===null||s===void 0?void 0:s.excludeRunScriptFilter)=="function"&&(u=v.options.excludeRunScriptFilter(t,c,e.name,e.url)!==!0),u)throw a}}function Ai(t,e,r,n){const i=ft(e,r)?Y("script"):document.createComment(`dynamic script with src='${t}' extract by micro-app`),o=()=>Rr(n),s=()=>{const a=Object.getOwnPropertyDescriptor(l.rawDocument,"currentScript");(!a||a.configurable)&&Object.defineProperty(l.rawDocument,"currentScript",{value:n,configurable:!0}),nt(t,e,r,o,i),!me(e,r)&&o()};return r.code||me(e,r)?te(s):Ae(t,e.name).then(a=>{r.code=a,s()}).catch(a=>{I(a,e.name),Sr(n)}),i}function bi(t,e,r){const n=ft(e,r)?Y("script"):document.createComment("dynamic inline script extract by micro-app");return nt(t,e,r,void 0,n),n}function Pi(t,e,r,n,i,o){if(r){if(l.rawSetAttribute.call(n,"type","module"),je(t)?n.textContent=e:n.src=t,o){const s=()=>{o.moduleCount&&o.moduleCount--,o(o.moduleCount===0)};je(t)?te(s):n.onload=s}}else n.textContent=e;vi(n,i)}function Ri(t,e){const r=e.appSpace[t.name];r.parsedFunction||(r.parsedFunction=Nr(t,e,r.parsedCode)),r.parsedFunction.call(xr(t))}function jr(t,e,r,n){return U(v.options.plugins)&&(r=Mi(t,r,e.name,v.options.plugins)),Ur(e,n)?e.iframe?`(function(window,self,global,location){;${r}
${je(t)?"":`//# sourceURL=${t}
`}}).call(window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyLocation);`:`;(function(proxyWindow){with(proxyWindow.__MICRO_APP_WINDOW__){(function(${or}){;${r}
${je(t)?"":`//# sourceURL=${t}
`}}).call(proxyWindow,${or})}})(window.__MICRO_APP_PROXY_WINDOW__);`:r}function Si(t){yi(t)}function yi(t){t.sandBox&&(l.rawWindow.__MICRO_APP_PROXY_WINDOW__=t.sandBox.proxyWindow)}function Mi(t,e,r,n){var i;const o=sr(n.global,e,t);return sr((i=n.modules)===null||i===void 0?void 0:i[r],o,t)}function sr(t,e,r){return le(t)?t.reduce((n,i)=>U(i)&&R(i.loader)?i.loader(n,r):n,e):e}function Oi(t,e,r){if(!t||!Io(t))return;Array.from(t.getElementsByTagName("link")).map(a=>(a.hasAttribute("exclude")||Ut(a.getAttribute("href"),e.name)?a.parentElement.replaceChild(document.createComment("link element with exclude attribute ignored by micro-app"),a):a.hasAttribute("ignore")||Wt(a.getAttribute("href"),e.name)?a.hasAttribute("href")&&l.rawSetAttribute.call(a,"href",z(a.getAttribute("href"),e.url)):yr(a,a.parentElement,e),a)),Array.from(t.getElementsByTagName("style")).map(a=>(a.hasAttribute("exclude")?a.parentElement.replaceChild(document.createComment("style element with exclude attribute ignored by micro-app"),a):e.scopecss&&!a.hasAttribute("ignore")&&Fe(r,()=>dt(a,e)),a)),Array.from(t.getElementsByTagName("script")).map(a=>(Fr(a,a.parentElement,e),a)),Array.from(t.getElementsByTagName("img")).map(a=>(a.hasAttribute("src")&&l.rawSetAttribute.call(a,"src",z(a.getAttribute("src"),e.url)),a))}function Di(t,e){const r=e.parseHtmlString(t),n=l.rawElementQuerySelector.call(r,"micro-app-head"),i=l.rawElementQuerySelector.call(r,"micro-app-body");if(!n||!i){const a=`element ${n?"body":"head"} is missing`;return e.onerror(new Error(a)),I(a,e.name)}const o=e.isPrefetch||e.fiber?[]:null;Oi(r,e,o);const s=He(o);e.source.links.size?ti(r,e,n,s):s?s.then(()=>e.onLoad({html:r})):e.onLoad({html:r}),e.source.scripts.size?gi(r,e):e.onLoad({html:r})}class Ci{constructor(){this.eventList=new Map,this.queue=[],this.recordStep={},this.process=()=>{var e,r;let n;const i=this.recordStep,o=this.queue;for(this.recordStep={},this.queue=[];n=o.shift();){const s=this.eventList.get(n),a=s.tempData,c=s.force;s.tempData=null,s.force=!1;let u;if(c||!this.isEqual(s.data,a)){s.data=a||s.data;for(const d of s.callbacks){const b=d(s.data);b&&(u??(u=[])).push(b)}(r=(e=i[n]).dispatchDataEvent)===null||r===void 0||r.call(e),i[n].nextStepList.forEach(d=>d(u))}}}}isLegalName(e){return e?!0:(I("event-center: Invalid name"),!1)}enqueue(e,r,n){this.recordStep[e]?(this.recordStep[e].nextStepList.push(r),n&&(this.recordStep[e].dispatchDataEvent=n)):this.recordStep[e]={nextStepList:[r],dispatchDataEvent:n},!this.queue.includes(e)&&this.queue.push(e)===1&&te(this.process)}isEqual(e,r){if(!r||Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&e[n]!==r[n])return!1;return!0}on(e,r,n=!1){if(this.isLegalName(e)){if(!R(r))return I("event-center: Invalid callback function");let i=this.eventList.get(e);i?n&&Object.keys(i.data).length&&(!this.queue.includes(e)||this.isEqual(i.data,i.tempData))&&r(i.data):(i={data:{},callbacks:new Set},this.eventList.set(e,i)),i.callbacks.add(r)}}off(e,r){if(this.isLegalName(e)){const n=this.eventList.get(e);n&&(R(r)?n.callbacks.delete(r):n.callbacks.clear())}}clearData(e){if(this.isLegalName(e)){const r=this.eventList.get(e);r&&(r.data={})}}dispatch(e,r,n,i,o){if(this.isLegalName(e)){if(!U(r))return I("event-center: data must be object");let s=this.eventList.get(e);s?(s.tempData=k({},s.tempData||s.data,r),!s.force&&(s.force=!!i)):(s={data:r,callbacks:new Set},this.eventList.set(e,s),s.force=!0),this.enqueue(e,n,o)}}getData(e){var r;const n=this.eventList.get(e);return(r=n?.data)!==null&&r!==void 0?r:null}}const x=new Ci;function q(t,e){return!B(t)||!t?"":e?`__${t}_from_base_app__`:`__${t}_from_micro_app__`}class $r{addGlobalDataListener(e,r){const n=this.appName;n&&(e.__APP_NAME__=n,e.__AUTO_TRIGGER__=r),x.on("global",e,r)}removeGlobalDataListener(e){R(e)&&x.off("global",e)}setGlobalData(e,r,n){G(),x.dispatch("global",e,i=>R(r)&&r(i),n)}forceSetGlobalData(e,r){this.setGlobalData(e,r,!0)}getGlobalData(){return x.getData("global")}clearGlobalData(){x.clearData("global")}clearGlobalDataListener(){const e=this.appName,r=x.eventList.get("global");if(r)for(const n of r.callbacks)(e&&e===n.__APP_NAME__||!(e||n.__APP_NAME__))&&r.callbacks.delete(n)}}class Ii extends $r{addDataListener(e,r,n){x.on(q($(e),!1),r,n)}removeDataListener(e,r){R(r)&&x.off(q($(e),!1),r)}getData(e,r=!1){return x.getData(q($(e),r))}setData(e,r,n,i){x.dispatch(q($(e),!0),r,o=>R(n)&&n(o),i)}forceSetData(e,r,n){this.setData(e,r,n,!0)}clearData(e,r=!0){x.clearData(q($(e),r))}clearDataListener(e){x.off(q($(e),!1))}changeEventAppName(e,r){const n=q($(e),!0),i=q($(r),!0);x.eventList.has(i)&&(x.eventList.set(n,x.eventList.get(i)),x.eventList.delete(i))}}class Gr extends $r{constructor(e){super(),this.appName=$(e),!this.appName&&I(`Invalid appName ${e}`)}addDataListener(e,r){e.__AUTO_TRIGGER__=r,x.on(q(this.appName,!0),e,r)}removeDataListener(e){R(e)&&x.off(q(this.appName,!0),e)}getData(e=!0){return x.getData(q(this.appName,e))}dispatch(e,r,n){G(),x.dispatch(q(this.appName,!1),e,i=>R(r)&&r(i),n,()=>{const i=O.get(this.appName);if(i?.container&&U(e)){const o=new CustomEvent("datachange",{detail:{data:x.getData(q(this.appName,!1))}});de(i.container).dispatchEvent(o)}})}forceDispatch(e,r){this.dispatch(e,r,!0)}clearData(e=!1){x.clearData(q(this.appName,e))}clearDataListener(){x.off(q(this.appName,!0))}}function qr(t){var e,r;if(t){t.umdDataListeners={global:new Set((e=t.umdDataListeners)===null||e===void 0?void 0:e.global),normal:new Set((r=t.umdDataListeners)===null||r===void 0?void 0:r.normal)};const n=x.eventList.get("global");if(n)for(const o of n.callbacks)t.appName===o.__APP_NAME__&&t.umdDataListeners.global.add(o);const i=x.eventList.get(q(t.appName,!0));if(i)for(const o of i.callbacks)t.umdDataListeners.normal.add(o)}}function Kr(t){if(t?.umdDataListeners){for(const e of t.umdDataListeners.global)t.addGlobalDataListener(e,e.__AUTO_TRIGGER__);for(const e of t.umdDataListeners.normal)t.addDataListener(e,e.__AUTO_TRIGGER__);Ft(t)}}function Ft(t){t==null||delete t.umdDataListeners}class Ge{constructor(){this.appInstanceMap=O}static getInstance(){return this.instance||(this.instance=new Ge),this.instance}get(e){return this.appInstanceMap.get(e)}set(e,r){this.appInstanceMap.set(e,r)}getAll(){return Array.from(this.appInstanceMap.values())}clear(){this.appInstanceMap.clear()}}function Vr(){Qr(),Ge.getInstance().getAll().forEach(t=>{t.container&&de(t.container).disconnectedCallback()}),!window.__MICRO_APP_UMD_MODE__&&Ge.getInstance().clear()}function Qr(){window.__MICRO_APP_ENVIRONMENT__&&window.removeEventListener("unmount",Vr,!1)}function Li(){window.__MICRO_APP_ENVIRONMENT__&&(Qr(),window.addEventListener("unmount",Vr,!1))}function Ti(t){return Er(t.__MICRO_APP_IS_BOUND_FUNCTION__)?t.__MICRO_APP_IS_BOUND_FUNCTION__:t.__MICRO_APP_IS_BOUND_FUNCTION__=So(t)}function xi(t){return Er(t.__MICRO_APP_IS_CONSTRUCTOR__)?t.__MICRO_APP_IS_CONSTRUCTOR__:t.__MICRO_APP_IS_CONSTRUCTOR__=at(t)}function Z(t,e,r="WINDOW"){if(R(t)&&!xi(t)&&!Ti(t)&&t.bind){const n=`__MICRO_APP_BOUND_${r}_FUNCTION__`;if(t[n])return t[n];const i=t.bind(e);for(const o in t)i[o]=t[o];return t.hasOwnProperty("prototype")&&H(i,"prototype",{value:t.prototype,configurable:!0,enumerable:!1,writable:!0}),t[n]=i}return t}class Ni{constructor(e,r){this.rawWindowScopeKeyList=["location"],this.staticEscapeProperties=["System","__cjsWrapper"],this.staticScopeProperties=["webpackJsonp","webpackHotUpdate","Vue","onpopstate","onhashchange","event"],this.scopeProperties=Array.from(this.staticScopeProperties),this.escapeProperties=[],this.injectedKeys=new Set,this.escapeKeys=new Set,this.appName=e,this.url=r,this.injectReactHMRProperty()}injectReactHMRProperty(){}}class Bi{}function Ui(){l.rawWindow._babelPolyfill&&(l.rawWindow._babelPolyfill=!1)}function Ht(t,e){const r=Array.from(t.childNodes);r.length&&r.forEach(n=>{Ht(n,e)}),F(t,e)}function F(t,e){var r,n;if(e&&De(t)&&t.__MICRO_APP_NAME__!==e&&!t.__PURE_ELEMENT__&&!xt()){const i={__MICRO_APP_NAME__:{configurable:!0,enumerable:!0,writable:!0,value:e}};if(Mo(t)&&Ge.getInstance().get(e)&&(i.href={get(){return this.getAttribute("href")},set(s){s!==void 0&&this.setAttribute("href",s)}}),ee(t,i),be(e)){const o=(n=(r=O.get(e))===null||r===void 0?void 0:r.sandBox)===null||n===void 0?void 0:n.proxyWindow;o&&ee(t,{baseURI:{configurable:!0,enumerable:!0,get:()=>o.location.href},ownerDocument:{configurable:!0,enumerable:!0,get:()=>t!==o.document?o.document:null},parentNode:Xr(e,l.rawParentNodeDesc),getRootNode:{configurable:!0,enumerable:!0,writable:!0,value:function(){return o.document}}})}}return t}function Xr(t,e){return{configurable:!0,enumerable:!0,get(){var r,n,i,o,s,a,c;Tt(t);const u=(r=e.get)===null||r===void 0?void 0:r.call(this);if(et(u)&&(!((n=O.get(t))===null||n===void 0)&&n.container)){const d=(o=(i=v.options).getRootElementParentNode)===null||o===void 0?void 0:o.call(i,this,t);return d||((s=v?.options)===null||s===void 0?void 0:s.inheritBaseBody)!==!0&&((c=(a=O.get(t))===null||a===void 0?void 0:a.container)===null||c===void 0?void 0:c.querySelector("micro-app-body"))||l.rawDocument.body}return u}}}function Wi(t,e,r){const{proxyDocument:n,documentEffect:i}=Fi(t,r),o=Hi(t,n);return ee(e,{document:{configurable:!1,enumerable:!0,get(){return n}},Document:{configurable:!1,enumerable:!1,get(){return o}}}),i}function Fi(t,e){const r=new Map,n=new Map;let i=null,o=null;const{rawDocument:s,rawCreateElement:a,rawCreateElementNS:c,rawAddEventListener:u,rawRemoveEventListener:d}=l;function b(p,_){const P=a.call(s,p,_);return F(P,t)}function A(p,_,P){const T=c.call(s,p,_,P);return F(T,t)}function S(p,_,P){const T=r.get(p);T?T.add(_):r.set(p,new Set([_])),_&&(_.__MICRO_APP_MARK_OPTIONS__=P),u.call(s,p,_,P)}function D(p,_,P){const T=r.get(p);T?.size&&T.has(_)&&T.delete(_),d.call(s,p,_,P)}const w=()=>{n.clear(),o=null},M=()=>{o=i||o,r.forEach((p,_)=>{if(p.size){const P=n.get(_)||[];n.set(_,new Set([...P,...p]))}})},g=()=>{o&&!i&&(E.onclick=o),n.forEach((p,_)=>{for(const P of p)E.addEventListener(_,P,P?.__MICRO_APP_MARK_OPTIONS__)}),w()},m=()=>{R(i)&&d.call(s,"click",i),i=null,r.size&&(r.forEach((p,_)=>{for(const P of p)d.call(s,_,P)}),r.clear())},f=(()=>{var p;const _=new Map([["onclick",L=>{R(i)&&d.call(s,"click",i,!1),R(L)&&u.call(s,"click",L,!1),i=L}]]),P=((p=v.options)===null||p===void 0?void 0:p.customProxyDocumentProps)||new Map;return new Map([..._,...P])})(),E=new Proxy(s,{get:(p,_)=>{var P;return We(t),_==="createElement"?b:_==="createElementNS"?A:_===Symbol.toStringTag?"ProxyDocument":_==="defaultView"?e.proxyWindow:_==="onclick"?i:_==="addEventListener"?S:_==="removeEventListener"?D:_==="microAppElement"?(P=O.get(t))===null||P===void 0?void 0:P.container:_==="__MICRO_APP_NAME__"?t:Z(Reflect.get(p,_),s,"DOCUMENT")},set:(p,_,P)=>(f.has(_)?f.get(_)(P):_!=="microAppElement"&&Reflect.set(p,_,P),!0)});return{proxyDocument:E,documentEffect:{reset:w,record:M,rebuild:g,release:m}}}function Hi(t,e){const{rawDocument:r,rawRootDocument:n}=l;class i{static[Symbol.hasInstance](s){let a=s;for(;a;)if(a=Object.getPrototypeOf(a),a===i.prototype)return!0;return s===e||s instanceof n}}return Object.setPrototypeOf(i,n),Object.setPrototypeOf(i.prototype,new Proxy(n.prototype,{get(o,s){return We(t),Z(Reflect.get(o,s),r,"DOCUMENT")},set(o,s,a){return Reflect.set(o,s,a),!0}})),i}function ji(t,e,r){return $i(e),Gi(t,e,r),qi(e,t)}function $i(t){const e=l.rawWindow;Object.getOwnPropertyNames(e).filter(r=>/^on/.test(r)&&!ai.includes(r)).forEach(r=>{const{enumerable:n,writable:i,set:o}=Object.getOwnPropertyDescriptor(e,r)||{enumerable:!0,writable:!0};H(t,r,{enumerable:n,configurable:!0,get:()=>e[r],set:i??!!o?s=>{e[r]=s}:void 0})})}function Gi(t,e,r){const n=l.rawWindow,i=new Map,o=new Proxy(e,{get:(s,a)=>(We(t),Reflect.has(s,a)||B(a)&&/^__MICRO_APP_/.test(a)||ne(r.scopeProperties,a)?(ne(hi,a)&&G(),Reflect.get(s,a)):Z(Reflect.get(n,a),n)),set:(s,a,c)=>{if(ne(r.rawWindowScopeKeyList,a))Reflect.set(n,a,c);else if(!we.call(s,a)&&we.call(n,a)&&!ne(r.scopeProperties,a)){const u=Object.getOwnPropertyDescriptor(n,a),{configurable:d,enumerable:b,writable:A,set:S}=u;H(s,a,{value:c,configurable:d,enumerable:b,writable:A??!!S}),r.injectedKeys.add(a)}else(!Reflect.has(s,a)||ne(r.scopeProperties,a))&&r.injectedKeys.add(a),Reflect.set(s,a,c);return(ne(r.escapeProperties,a)||ne(r.staticEscapeProperties,a)&&!Reflect.has(n,a))&&!ne(r.scopeProperties,a)&&(!Reflect.has(n,a)&&r.escapeKeys.add(a),Reflect.set(n,a,c)),!0},has:(s,a)=>ne(r.scopeProperties,a)?r.injectedKeys.has(a)?Reflect.has(s,a):!!s[a]:Reflect.has(s,a)||Reflect.has(n,a),getOwnPropertyDescriptor:(s,a)=>{if(we.call(s,a))return i.set(a,"target"),Object.getOwnPropertyDescriptor(s,a);if(we.call(n,a)){i.set(a,"rawWindow");const c=Object.getOwnPropertyDescriptor(n,a);return c&&!c.configurable&&(c.configurable=!0),c}},defineProperty:(s,a,c)=>i.get(a)==="rawWindow"?Reflect.defineProperty(n,a,c):Reflect.defineProperty(s,a,c),ownKeys:s=>Go(Reflect.ownKeys(n).concat(Reflect.ownKeys(s))),deleteProperty:(s,a)=>we.call(s,a)?(r.injectedKeys.has(a)&&r.injectedKeys.delete(a),r.escapeKeys.has(a)&&Reflect.deleteProperty(n,a),Reflect.deleteProperty(s,a)):!0});r.proxyWindow=o}function qi(t,e){const r=new Map,n=new Map,i=new Map,o=new Map,{rawWindow:s,rawAddEventListener:a,rawRemoveEventListener:c,rawDispatchEvent:u,rawSetInterval:d,rawSetTimeout:b,rawClearInterval:A,rawClearTimeout:S}=l;function D(h){var f;return ii.includes(h)&&(!((f=O.get(e))===null||f===void 0)&&f.container)?de(O.get(e).container):s}t.addEventListener=function(h,f,E){h=yt(h,e);const p=r.get(h);p?p.add(f):r.set(h,new Set([f])),f&&(f.__MICRO_APP_MARK_OPTIONS__=E),a.call(D(h),h,f,E)},t.removeEventListener=function(h,f,E){h=yt(h,e);const p=r.get(h);p?.size&&p.has(f)&&p.delete(f),c.call(D(h),h,f,E)},t.dispatchEvent=function(h){return u.call(D(h?.type),h)},t.setInterval=function(h,f,...E){const p=d.call(s,h,f,...E);return i.set(p,{handler:h,timeout:f,args:E}),p},t.setTimeout=function(h,f,...E){const _=typeof h=="string"?h:function(...T){o.delete(P),typeof h=="function"&&h(...T)},P=b.call(s,_,f,...E);return o.set(P,{handler:_,timeout:f,args:E}),P},t.clearInterval=function(h){i.delete(h),A.call(s,h)},t.clearTimeout=function(h){o.delete(h),S.call(s,h)};const w=()=>{n.clear()};return{reset:w,record:()=>{r.forEach((h,f)=>{if(h.size){const E=n.get(f)||[];n.set(f,new Set([...E,...h]))}})},rebuild:()=>{n.forEach((h,f)=>{for(const E of h)t.addEventListener(f,E,E?.__MICRO_APP_MARK_OPTIONS__)}),w()},release:h=>{r.size&&(r.forEach((f,E)=>{for(const p of f)c.call(D(E),E,p)}),r.clear()),h&&(i.forEach((f,E)=>{A.call(s,E)}),o.forEach((f,E)=>{S.call(s,E)}),i.clear(),o.clear())}}}function ce(t,e,r){const n=l.rawWindow.history.state,i={__MICRO_APP_STATE__:k({},n?.__MICRO_APP_STATE__,{[t]:{fullPath:r?r.pathname+r.search+r.hash:null,state:e??null,mode:Ce(t)}})};return k({},n,i)}function Ki(t,e){return U(e?.__MICRO_APP_STATE__)&&(ve(e.__MICRO_APP_STATE__[t])||delete e.__MICRO_APP_STATE__[t],Object.keys(e.__MICRO_APP_STATE__).length||delete e.__MICRO_APP_STATE__),Qo(e)?null:k({},e)}function Qe(t){var e,r;const n=l.rawWindow.history.state;return((r=(e=n?.__MICRO_APP_STATE__)===null||e===void 0?void 0:e[t])===null||r===void 0?void 0:r.state)||null}function zr(t){var e;const r=l.rawWindow.history.state;return((e=r?.__MICRO_APP_STATE__)===null||e===void 0?void 0:e[t])||null}const Vi=/&/g,Qi=/=/g,Yr=/%M1/g,Jr=/%M2/g;function Zr(t){return encodeURIComponent(jt(t).replace(Vi,"%M1").replace(Qi,"%M2"))}function kr(t){return jt(t).replace(Yr,"&").replace(Jr,"=")}function jt(t){try{const e=decodeURIComponent(t);return t===e||Yr.test(e)||Jr.test(e)?e:jt(e)}catch{return t}}function Xe(t){var e,r,n,i;const o=l.rawWindow.location,s=l.rawWindow.history.state;if(X(t)){const a=$t(o.search,o.hash),c=((e=a.hashQuery)===null||e===void 0?void 0:e[t])||((r=a.searchQuery)===null||r===void 0?void 0:r[t]);return B(c)?kr(c):null}return((i=(n=s?.__MICRO_APP_STATE__)===null||n===void 0?void 0:n[t])===null||i===void 0?void 0:i.fullPath)||(ie(t)?o.pathname+o.search+o.hash:null)}function _e(t,e){const r=l.rawWindow.location;let n=e.pathname+e.search+e.hash,i=!1;if(X(t)){let{pathname:o,search:s,hash:a}=r;const c=$t(s,a),u=Zr(n);return a&&!s?(i=!0,c.hashQuery?c.hashQuery[t]=u:c.hashQuery={[t]:u},a=(a.includes("?")?a.slice(0,a.indexOf("?")+1):a+"?")+tt(c.hashQuery)):(c.searchQuery?c.searchQuery[t]=u:c.searchQuery={[t]:u},s="?"+tt(c.searchQuery)),{fullPath:o+s+a,isAttach2Hash:i}}return(Gt(t)||oe(t))&&(n=r.pathname+r.search+r.hash),{fullPath:n,isAttach2Hash:i}}function Xi(t){var e,r,n,i;let{pathname:o,search:s,hash:a}=l.rawWindow.location,c=!1;if(X(t)){const u=$t(s,a);if(!((e=u.hashQuery)===null||e===void 0)&&e[t]){c=!0,(r=u.hashQuery)===null||r===void 0||delete r[t];const d=tt(u.hashQuery);a=a.slice(0,a.indexOf("?")+ +!!d)+d}else if(!((n=u.searchQuery)===null||n===void 0)&&n[t]){(i=u.searchQuery)===null||i===void 0||delete i[t];const d=tt(u.searchQuery);s=d?"?"+d:""}}return{fullPath:o+s+a,isAttach2Hash:c}}function $t(t,e){const r={};return t!==""&&t!=="?"&&(r.searchQuery=Jt(t.slice(1))),e.includes("?")&&(r.hashQuery=Jt(e.slice(e.indexOf("?")+1))),r}function zi(t,e){const r=Xe(t);if(!r)return"";const n=W(r,e);return n.origin+n.pathname+n.search}function qe(t){const e=O.get(t);return!!(e&&!e.isPrefetch)}function Ce(t){var e;return(e=O.get(t))===null||e===void 0?void 0:e.routerMode}function X(t){return Ce(t)===$e}function Gt(t){return Ce(t)===Or}function Mt(t){return Ce(t)===rt}function Yi(t){return Ce(t)===Dr}function oe(t){return Ce(t)===Cr}function ie(t){return Mt(t)||Yi(t)}function en(t,e){const r=e&&rt||t||v.options["disable-memory-router"]&&rt||v.options["router-mode"]||$e;return oi.includes(r)?r:$e}function tn(t){const e=l.rawWindow,r=n=>{var i,o,s;if(Oe({excludeHiddenApp:!0,excludePreRender:!0}).includes(t)&&!n.onlyForBrowser&&(!ie(t)||!l.rawWindow.history.state||zr(t))){const a=(i=O.get(t))===null||i===void 0?void 0:i.container;Fo(()=>ot(t,Xe(t)),(s=(o=a&&de(a))===null||o===void 0?void 0:o.getRouterEventDelay())!==null&&s!==void 0?s:0)}};return e.addEventListener("popstate",r),()=>{e.removeEventListener("popstate",r)}}function ot(t,e){const r=O.get(t);if(r?.sandBox){const n=r.sandBox.proxyWindow,i=r.sandBox.microAppWindow;let o=!1;const s=n.location.href;if(e){const a=n.location.hash;Ie(t,e,i.location),o=n.location.hash!==a}Ji(t,n,i),o&&Zi(t,n,i,s),G()}}function Ji(t,e,r){const n=new PopStateEvent("popstate",{state:Qe(t)});r.dispatchEvent(n),be(t)||R(e.onpopstate)&&e.onpopstate(n)}function Zi(t,e,r,n){const i=new HashChangeEvent("hashchange",{newURL:e.location.href,oldURL:n});r.dispatchEvent(i),be(t)||R(e.onhashchange)&&e.onhashchange(i)}function ki(t){const e=new PopStateEvent("popstate",{state:null});t&&(e.onlyForBrowser=!0),l.rawWindow.dispatchEvent(e)}function es(t){const e=new HashChangeEvent("hashchange",{newURL:l.rawWindow.location.href,oldURL:t});l.rawWindow.dispatchEvent(e)}function Ot(t,e,r){G(),qe(t)&&(ki(e),r&&es(r))}function rn(t,e){const r=l.rawWindow.history;function n(o){return function(...s){var a,c,u;s[2]=ve(s[2])||Ue(s[2])||""+s[2]==""?e.href:""+s[2];const d=W(s[2],e.href),b=d.pathname+d.search+d.hash;oe(t)||pt(t,o,_e(t,d),!0,ce(t,s[0],d),s[1]),b!==e.fullPath&&Ie(t,b,e),(u=(a=O.get(t))===null||a===void 0?void 0:(c=a.sandBox).updateIframeBase)===null||u===void 0||u.call(c)}}const i={pushState:n("pushState"),replaceState:n("replaceState")};return be(t)?k({go(o){return r.go(o)}},i):new Proxy(r,{get(o,s){return s==="pushState"||s==="replaceState"?i[s]:s==="state"?Qe(t):Z(Reflect.get(o,s),o,"HISTORY")},set(o,s,a){return s==="pushState"||s==="replaceState"?i[s]=a:Reflect.set(o,s,a),!0}})}function Me(t,e,r,n=null,i=""){qe(t)&&(e==="pushState"?l.rawPushState:l.rawReplaceState).call(l.rawWindow.history,n,i,r)}function pt(t,e,r,n,i,o){if(qe(t)){const s=l.rawWindow.location,a=s.pathname+s.search+s.hash,c=r.isAttach2Hash&&a!==r.fullPath?s.href:null;Me(t,e,r.fullPath,i,o),a!==r.fullPath&&X(t)&&Ot(t,n,c)}}function mt(t,e,r){pt(t,"replaceState",e,!0,r)}function ar(t){const e=l.rawWindow;return function(...r){var n;if(!((n=e.history.state)===null||n===void 0)&&n.__MICRO_APP_STATE__&&(!U(r[0])||!r[0].__MICRO_APP_STATE__)&&(B(r[2])||ct(r[2]))){const i=e.location.href;W(r[2],i).href===i&&(r[0]=k({},r[0],{__MICRO_APP_STATE__:e.history.state.__MICRO_APP_STATE__}))}t.apply(e.history,r),Oe({excludeHiddenApp:!0,excludePreRender:!0}).forEach(i=>{if((X(i)||Gt(i))&&!Xe(i)){const o=O.get(i);mt(i,_e(i,o.sandBox.proxyWindow.location),ce(i,Qe(i),o.sandBox.proxyWindow.location))}ie(i)&&!zr(i)&&Me(i,"replaceState",e.location.href,ce(i))}),G()}}function nn(){const t=l.rawWindow;t.history.pushState=ar(l.rawPushState),t.history.replaceState=ar(l.rawReplaceState)}function on(){const t=l.rawWindow;t.history.pushState=l.rawPushState,t.history.replaceState=l.rawReplaceState}function ts(){function t(w,M,g,m){pt(w,M,_e(w,g),!1,ce(w,m??null,g)),G()}function e(w,M,g,m){const h=M.sandBox.proxyWindow.location,f=W(g.path,h.href),E=h.pathname+h.search+h.hash,p=f.pathname+f.search+f.hash;if(E!==p||Xe(w)!==p){if(!oe(w)){const _=m&&g.replace!==!1||g.replace===!0?"replaceState":"pushState";t(w,_,f,g.state)}X(w)||ot(w,p)}}function r(w){return function(M){return new Promise((g,m)=>{const h=$(M.name);if(h&&B(M.path))if(Oe({excludeHiddenApp:!0,excludePreRender:!0}).includes(h)){const f=O.get(h);g(f.sandBox.sandboxReady.then(()=>e(h,f,M,w)))}else m(I("导航失败，请确保子应用渲染后再调用此方法"));else m(I(`navigation failed, name & path are required when use router.${w?"replace":"push"}`))})}}function n(w){return function(...M){return l.rawWindow.history[w](...M)}}const i=Zt(),o=Zt();function s(w,M,g,m){G();for(const h of m)R(h)?h(M,g,w):U(h)&&R(h[w])&&h[w](M,g)}function a(w,M,g){D.current.set(w,M),s(w,M,g,i.list()),ht(()=>{s(w,M,g,o.list())})}function c(w){D.current.delete(w)}function u(w){if(X(w)||Gt(w)){const M=O.get(w);mt(w,_e(w,M.sandBox.proxyWindow.location),ce(w,Qe(w),M.sandBox.proxyWindow.location))}}function d(w){w=$(w),w&&Oe().includes(w)&&u(w)}function b({includeHiddenApp:w=!1,includePreRender:M=!1}){Oe({excludeHiddenApp:!w,excludePreRender:!M}).forEach(g=>u(g))}function A(){const w=qo();function M(m){const h=$(m.name);return!h||!m.path?bo:w.add(h,m.path)}function g(m){return m=$(m),m?w.delete(m):!1}return{setDefaultPage:M,removeDefaultPage:g,getDefaultPage:w.get}}function S(){let w=null;function M(g){Ro(g)&&(w=new Proxy(g,{get(m,h){return G(),Z(Reflect.get(m,h),m,"BASEROUTER")},set(m,h,f){return Reflect.set(m,h,f),!0}}))}return{setBaseAppRouter:M,getBaseAppRouter:()=>w}}const D=Object.assign(Object.assign({current:new Map,encode:Zr,decode:kr,push:r(!1),replace:r(!0),go:n("go"),back:n("back"),forward:n("forward"),beforeEach:i.add,afterEach:o.add,attachToURL:d,attachAllToURL:b},A()),S());return{router:D,executeNavigationGuard:a,clearRouterWhenUnmount:c}}const{router:ze,executeNavigationGuard:sn,clearRouterWhenUnmount:rs}=ts(),ns=["href","pathname","search","hash","host","hostname","port","protocol","search"],os=[...ns,"origin","fullPath"];function an(t,e,r,n,i,o){const a=l.rawWindow.location,c=!!r,u=W(e);function d(){return c?r.location:u}function b(m,h){const f=W(m,g.href);if(f.origin===g.origin){const E=_e(t,f);if(!ie(t)){if(h=oe(t)?"replaceState":h,f.pathname===g.pathname&&f.search===g.search){let p=null;(f.hash!==g.hash||oe(t))&&(E.isAttach2Hash&&(p=a.href),(!oe(t)||!f.hash)&&Me(t,h,E.fullPath,X(t)?null:ce(t,null,f))),f.hash?X(t)?Ot(t,!1,p):ot(t,f.pathname+f.search+f.hash):M();return}Me(t,h,E.fullPath,X(t)?null:ce(t,null,f)),M();return}return E.fullPath}return m}function A(m,h){const f=W(m,e);f[h]===g[h]&&g.hash?Ot(t,!1):(Me(t,f[h]===g[h]||oe(t)?"replaceState":"pushState",_e(t,f).fullPath,X(t)?null:ce(t,null,f)),M())}const S=m=>function(h){if(qe(t)){const f=b(h,m==="assign"?"pushState":"replaceState");f&&a[m](W(f,a.origin).href)}},D=S("assign"),w=S("replace"),M=m=>a.reload(m);H(d(),"fullPath",{enumerable:!0,configurable:!0,get:()=>g.pathname+g.search+g.hash});const g=new Proxy({},{get:(m,h)=>{const f=d();if(h==="assign")return D;if(h==="replace")return w;if(h==="reload")return M;if(h==="self")return f;if(h==="fullPath")return f.fullPath;if(di.includes(h)){if(Mt(t))return a[h];if(c)return n[h]}if(h==="href"){if(Mt(t))return f[h].replace(f.origin,a.origin);if(c)return f[h].replace(i,o)}return Z(Reflect.get(f,h),f,"LOCATION")},set:(m,h,f)=>{if(qe(t)){const E=d();if(h==="href"){const p=b(f,"pushState");p&&(a.href=W(p,a.origin).href)}else if(h==="pathname")if(ie(t))a.pathname=f;else{const p=("/"+f).replace(/^\/+/,"/")+g.search+g.hash;A(p,"pathname")}else if(h==="search")if(ie(t))a.search=f;else{const p=g.pathname+("?"+f).replace(/^\?+/,"?")+g.hash;A(p,"search")}else if(h==="hash")if(ie(t))a.hash=f;else{const p=g.pathname+g.search+("#"+f).replace(/^#+/,"#"),_=W(p,e);_.hash!==g.hash&&(oe(t)||pt(t,"pushState",_e(t,_),!1,ce(t,null,_)),X(t)||ot(t,_.pathname+_.search+_.hash))}else Reflect.set(E,h,f)}return!0}});return g}function it(t,e){const r=k({name:t},e);for(const n of os)r[n]=e[n];return r}function is(t,e){sn(t,it(t,e),it(t,e))}function Ie(t,e,r,n){var i;const o=it(t,r),s=W(e,r.href);if(be(t)){const u=O.get(t).sandBox.microAppWindow;(i=u.rawReplaceState)===null||i===void 0||i.call(u.history,Qe(t),"",s.href)}else{let u=s.href;r.self.origin!==s.origin&&(u=u.replace(s.origin,r.self.origin)),r.self.href=u}const a=l.rawWindow.location;ie(t)&&e!==a.pathname+a.search+a.hash&&n!=="prevent"&&Me(t,"replaceState",e,l.rawWindow.history.state);const c=it(t,r);(n==="auto"||o.fullPath!==c.fullPath&&n!=="prevent")&&sn(t,c,o)}function ss(t,e){const r=an(t,e);return{microLocation:r,microHistory:rn(t,r)}}function cn(t,e,r){const n=Xe(t);n?(Ie(t,n,e,"auto"),oe(t)&&_t(t)):qt(t,e,r)}function qt(t,e,r){r&&Ie(t,r,e,"prevent"),oe(t)||mt(t,_e(t,e),ce(t,null,e)),is(t,e)}function ln(t,e,r,n){if(!n&&!ie(t)){const{pathname:i,search:o,hash:s}=W(e);Ie(t,i+o+s,r,"prevent")}oe(t)||_t(t),rs(t)}function _t(t){mt(t,Xi(t),Ki(t,l.rawWindow.history.state))}function cr(t,e){const r=ve(e)?l.rawWindow.fetch:e;return R(r)?function(i,o,...s){return(B(i)||ct(i))&&(i=W(i,t).toString()),G(),r.call(l.rawWindow,i,o,...s)}:r}function lr(t,e){const r=ve(e)?l.rawWindow.XMLHttpRequest:e;return at(r)?class extends r{open(i,o,...s){(B(o)&&!/^f(ile|tp):\/\//.test(o)||ct(o))&&(o=W(o,t).toString()),G(),super.open(i,o,...s)}}:r}function as(){let t;function e(n,i,o){const s=ve(o)?l.rawWindow.EventSource:o;return at(s)?class extends s{constructor(c,u,...d){if((B(c)||ct(c))&&(c=W(c,i).toString()),G(),super(c,u,...d),t){const b=t.get(n);b?b.add(this):t.set(n,new Set([this]))}else t=new Map([[n,new Set([this])]])}close(){var c;super.close(),(c=t.get(n))===null||c===void 0||c.delete(this)}}:s}function r(n){const i=t?.get(n);i?.size&&(i.forEach(o=>{o.close()}),i.clear())}return{createMicroEventSource:e,clearMicroEventSource:r}}const{createMicroEventSource:ur,clearMicroEventSource:cs}=as();class Ke extends Ni{constructor(e,r){super(e,r),this.active=!1,this.microAppWindow=new Bi,this.patchWith(n=>{this.getSpecialProperties(e),this.patchRouter(e,r,this.microAppWindow),this.windowEffect=ji(e,this.microAppWindow,this),this.documentEffect=Wi(e,this.microAppWindow,this),this.setMappingPropertiesWithRawDescriptor(this.microAppWindow),this.initStaticGlobalKeys(e,r,this.microAppWindow),n()})}start({umdMode:e,baseroute:r,defaultPage:n,disablePatchRequest:i}){this.active||(this.active=!0,this.initRouteState(n),this.removeHistoryListener=tn(this.microAppWindow.__MICRO_APP_NAME__),ie(this.microAppWindow.__MICRO_APP_NAME__)&&(this.microAppWindow.__MICRO_APP_BASE_ROUTE__=this.microAppWindow.__MICRO_APP_BASE_URL__=r),e||this.initGlobalKeysWhenStart(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.__MICRO_APP_URL__,this.microAppWindow,i),++l.activeSandbox===1&&(mn(),nn()),++Ke.activeCount===1&&Li(),Ui())}stop({umdMode:e,keepRouteState:r,destroy:n,clearData:i}){var o;this.active&&(this.recordAndReleaseEffect({umdMode:e,clearData:i,destroy:n},!e||n),this.clearRouteState(r),(o=this.removeHistoryListener)===null||o===void 0||o.call(this),(!e||n)&&(cs(this.microAppWindow.__MICRO_APP_NAME__),this.injectedKeys.forEach(s=>{Reflect.deleteProperty(this.microAppWindow,s)}),this.injectedKeys.clear(),this.escapeKeys.forEach(s=>{Reflect.deleteProperty(l.rawWindow,s)}),this.escapeKeys.clear(),this.clearHijackUmdHooks()),--l.activeSandbox===0&&(_n(),on()),--Ke.activeCount,this.active=!1)}initStaticGlobalKeys(e,r,n){n.__MICRO_APP_ENVIRONMENT__=!0,n.__MICRO_APP_NAME__=e,n.__MICRO_APP_URL__=r,n.__MICRO_APP_PUBLIC_PATH__=lt(r),n.__MICRO_APP_BASE_ROUTE__="",n.__MICRO_APP_WINDOW__=n,n.__MICRO_APP_PRE_RENDER__=!1,n.__MICRO_APP_UMD_MODE__=!1,n.__MICRO_APP_PROXY_WINDOW__=this.proxyWindow,n.__MICRO_APP_SANDBOX__=this,n.__MICRO_APP_SANDBOX_TYPE__="with",n.rawWindow=l.rawWindow,n.rawDocument=l.rawDocument,n.microApp=k(new Gr(e),{removeDomScope:G,pureCreateElement:Y,location:n.location,router:ze})}recordAndReleaseEffect(e,r=!1){r?this.resetEffectSnapshot():this.recordEffectSnapshot(),this.releaseGlobalEffect(e)}resetEffectSnapshot(){this.windowEffect.reset(),this.documentEffect.reset(),Ft(this.microAppWindow.microApp)}recordEffectSnapshot(){this.windowEffect.record(),this.documentEffect.record(),qr(this.microAppWindow.microApp)}rebuildEffectSnapshot(){this.windowEffect.rebuild(),this.documentEffect.rebuild(),Kr(this.microAppWindow.microApp)}releaseGlobalEffect({umdMode:e=!1,clearData:r=!1,isPrerender:n=!1,keepAlive:i=!1,destroy:o=!1}){var s,a,c;this.windowEffect.release(!e&&!i&&!n||o),this.documentEffect.release(),(s=this.microAppWindow.microApp)===null||s===void 0||s.clearDataListener(),(a=this.microAppWindow.microApp)===null||a===void 0||a.clearGlobalDataListener(),r&&(v.clearData(this.microAppWindow.__MICRO_APP_NAME__),(c=this.microAppWindow.microApp)===null||c===void 0||c.clearData())}getSpecialProperties(e){var r;U(v.options.plugins)&&(this.commonActionForSpecialProperties(v.options.plugins.global),this.commonActionForSpecialProperties((r=v.options.plugins.modules)===null||r===void 0?void 0:r[e]))}commonActionForSpecialProperties(e){if(le(e))for(const r of e)U(r)&&(le(r.scopeProperties)&&(this.scopeProperties=this.scopeProperties.concat(r.scopeProperties)),le(r.escapeProperties)&&(this.escapeProperties=this.escapeProperties.concat(r.escapeProperties)))}setPreRenderState(e){this.microAppWindow.__MICRO_APP_PRE_RENDER__=e}markUmdMode(e){this.microAppWindow.__MICRO_APP_UMD_MODE__=e}patchWith(e){this.sandboxReady=new Promise(r=>e(r))}setMappingPropertiesWithRawDescriptor(e){let r,n;const i=l.rawWindow;i===i.parent?r=n=this.proxyWindow:(r=i.top,n=i.parent),ee(e,{top:this.createDescriptorForMicroAppWindow("top",r),parent:this.createDescriptorForMicroAppWindow("parent",n)}),Tr.forEach(o=>{H(e,o,this.createDescriptorForMicroAppWindow(o,this.proxyWindow))})}createDescriptorForMicroAppWindow(e,r){const{configurable:n=!0,enumerable:i=!0,writable:o,set:s}=Object.getOwnPropertyDescriptor(l.rawWindow,e)||{writable:!0};return{value:r,configurable:n,enumerable:i,writable:o??!!s}}initGlobalKeysWhenStart(e,r,n,i){n.hasOwnProperty=o=>we.call(n,o)||we.call(l.rawWindow,o),this.setHijackProperty(e,n),i||this.patchRequestApi(e,r,n),this.setScopeProperties(n)}setHijackProperty(e,r){let n,i;ee(r,{eval:{configurable:!0,enumerable:!1,get(){return We(e),n||l.rawWindow.eval},set:o=>{n=o}},Image:{configurable:!0,enumerable:!1,get(){return We(e),i||l.ImageProxy},set:o=>{i=o}}})}patchRequestApi(e,r,n){let i=cr(r),o=lr(r),s=ur(e,r);ee(n,{fetch:{configurable:!0,enumerable:!0,get(){return i},set(a){i=cr(r,a)}},XMLHttpRequest:{configurable:!0,enumerable:!0,get(){return o},set(a){o=lr(r,a)}},EventSource:{configurable:!0,enumerable:!0,get(){return s},set(a){s=ur(e,r,a)}}})}setScopeProperties(e){this.scopeProperties.forEach(r=>{Reflect.set(e,r,e[r])})}patchRouter(e,r,n){const{microLocation:i,microHistory:o}=ss(e,r);ee(n,{location:{configurable:!1,enumerable:!0,get(){return i},set:s=>{l.rawWindow.location=s}},history:{configurable:!0,enumerable:!0,get(){return o}}})}initRouteState(e){cn(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location,e)}clearRouteState(e){ln(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.__MICRO_APP_URL__,this.microAppWindow.location,e)}setRouteInfoForKeepAliveApp(){qt(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location)}removeRouteInfoForKeepAliveApp(){_t(this.microAppWindow.__MICRO_APP_NAME__)}patchStaticElement(e){Ht(e,this.microAppWindow.__MICRO_APP_NAME__)}actionsBeforeExecScripts(e,r){this.patchStaticElement(e),this.clearHijackUmdHooks=this.hijackUmdHooks(this.appName,this.microAppWindow,r)}hijackUmdHooks(e,r,n){let i,o,s;return ee(r,{mount:{configurable:!0,get:()=>i,set:a=>{this.active&&R(a)&&!i&&n(i=a,o)}},unmount:{configurable:!0,get:()=>o,set:a=>{this.active&&R(a)&&!o&&n(i,o=a)}},[`micro-app-${e}`]:{configurable:!0,get:()=>s,set:a=>{this.active&&U(a)&&!s&&(s=a,n(s.mount,s.unmount))}}}),()=>{i=o=s=null}}setStaticAppState(e){this.microAppWindow.__MICRO_APP_STATE__=e}}Ke.activeCount=0;function ls(t,e,r,n){const i=l.rawWindow.history,o=W(e),s=o.protocol+"//"+o.host,a=o.pathname+o.search+o.hash,c=r.history;return r.rawReplaceState=c.replaceState,k(c,rn(t,r.location)),ee(c,{scrollRestoration:{configurable:!0,enumerable:!0,get(){return i.scrollRestoration},set(u){i.scrollRestoration=u}}}),Ie(t,a,r.location,"prevent"),an(t,e,r,o,n,s)}const us=["Array"],hs=["getComputedStyle","DOMParser","visualViewport","matchMedia","ResizeObserver","IntersectionObserver"],ds=[/animationFrame$/i,/mutationObserver$/i,/height$|width$/i,/offset$/i,/selection$/i,/^range/i,/^screen/i,/^scroll/i,/X$|Y$/],fs=["body","head","html","title"],ps=["childElementCount","children","firstElementChild","firstChild","lastElementChild","activeElement","fullscreenElement","pictureInPictureElement","pointerLockElement","styleSheets"],ms=["append","contains","replaceChildren","createRange","getSelection","elementFromPoint","elementsFromPoint","getAnimations"],_s=["characterSet","compatMode","contentType","designMode","dir","doctype","embeds","fullscreenEnabled","hidden","implementation","lastModified","pictureInPictureEnabled","plugins","readyState","referrer","visibilityState","fonts"],vs=["execCommand","createRange","exitFullscreen","exitPictureInPicture","getElementsByTagNameNS","hasFocus","prepend"],gs=["blob:"],Es=window.Worker;function ws(t){try{const e=t instanceof URL?t:new URL(t);return gs.includes(e.protocol)?!0:e.protocol===window.location.protocol&&e.hostname===window.location.hostname&&e.port===window.location.port}catch{return!1}}function As(t){let e;try{e=new Blob([t],{type:"application/javascript"})}catch{const i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,o=new i;o.append(t),e=o.getBlob("application/javascript")}return(window.URL||window.webkitURL).createObjectURL(e)}const hr=new Proxy(Es,{construct(t,e){let[r,n]=e;n=n||{};const i=Q();let o=r;if(i){const s=O.get(i);o=z(r,s.url)}if(o&&!ws(o)){const s=`import "${r}";`,a=As(s);return n.type="module",new t(a,n)}else return new t(r,n)}});function bs(t,e,r){return Ps(t,e,r),Rs(e,r),Ss(e)}function Ps(t,e,r){const n=l.rawWindow;hs.forEach(i=>{e[i]=Z(n[i],n)}),Object.getOwnPropertyNames(e).filter(i=>(ds.some(o=>{if(o.test(i)&&i in e.parent){if(R(n[i]))e[i]=Z(n[i],n);else{const{configurable:s,enumerable:a}=Object.getOwnPropertyDescriptor(e,i)||{configurable:!0,enumerable:!0};s&&H(e,i,{configurable:s,enumerable:a,get:()=>n[i],set:c=>{n[i]=c}})}return!0}return!1}),at(e[i])&&i in n&&!us.includes(i)&&H(e[i],Symbol.hasInstance,{configurable:!0,enumerable:!1,value(o){return er(o,n[i])||er(o,e[i])}}),/^on/.test(i)&&!ci.includes(i))).forEach(i=>{const{enumerable:o,writable:s,set:a}=Object.getOwnPropertyDescriptor(e,i)||{enumerable:!0,writable:!0};try{H(e,i,{enumerable:o,configurable:!0,get:()=>n[i],set:s??!!a?c=>{n[i]=R(c)?c.bind(e):c}:void 0})}catch(c){ge(c,t)}}),r.escapeProperties.forEach(i=>{let o=e[i];H(e,i,{enumerable:!0,configurable:!0,get(){return o??Z(n[i],n)},set(s){o=s}})})}function Rs(t,e){const r=l.rawWindow,n=new Set;Object.defineProperty(t,"Worker",{value:hr,configurable:!0,writable:!0});const i=new Proxy(t,{get:(o,s)=>s==="Worker"?hr:s==="location"?e.proxyLocation:ne(Tr,s)?i:n.has(s)?Reflect.get(o,s):ne(e.escapeProperties,s)&&!Reflect.get(o,s)?Z(Reflect.get(r,s),r):Z(Reflect.get(o,s),o),set:(o,s,a)=>s==="location"?Reflect.set(r,s,a):(Reflect.has(o,s)||n.add(s),Reflect.set(o,s,a),!0),has:(o,s)=>s in o,deleteProperty:(o,s)=>Reflect.has(o,s)?Reflect.deleteProperty(o,s):!0});e.proxyWindow=i}function Ss(t){const{rawWindow:e,rawAddEventListener:r,rawRemoveEventListener:n,rawDispatchEvent:i}=l,o=new Map,s=new Map;function a(A){var S;let D=[];return Array.isArray((S=v?.options)===null||S===void 0?void 0:S.escapeIframeWindowEvents)&&(D=v.options.escapeIframeWindowEvents),si.filter(M=>!D.includes(M)).includes(A)?t:e}t.addEventListener=function(A,S,D){const w=o.get(A);w?w.add(S):o.set(A,new Set([S])),S&&(S.__MICRO_APP_MARK_OPTIONS__=D),r.call(a(A),A,S,D)},t.removeEventListener=function(A,S,D){const w=o.get(A);w?.size&&w.has(S)&&w.delete(S),n.call(a(A),A,S,D)},t.dispatchEvent=function(A){return i.call(a(A?.type),A)};const c=()=>{s.clear()};return{reset:c,record:()=>{o.forEach((A,S)=>{if(A.size){const D=s.get(S)||[];s.set(S,new Set([...D,...A]))}})},rebuild:()=>{s.forEach((A,S)=>{for(const D of A)t.addEventListener(S,D,D?.__MICRO_APP_MARK_OPTIONS__)}),c()},release:()=>{o.size&&(o.forEach((A,S)=>{for(const D of A)n.call(a(S),S,D)}),o.clear())}}}function ys(t,e,r){return Ms(t,e),Os(t,e,r),Ds(t,e)}function re(t,e){var r;return!((r=v?.options)===null||r===void 0)&&r.disableIframeRootDocument?e:t}function Ms(t,e){const r=l.rawDocument,n=e.Document,i=e.document,o=n.prototype.createElement,s=n.prototype.createElementNS,a=n.prototype.createTextNode,c=n.prototype.createDocumentFragment,u=n.prototype.createComment,d=n.prototype.querySelector,b=n.prototype.querySelectorAll,A=n.prototype.getElementById,S=n.prototype.getElementsByClassName,D=n.prototype.getElementsByTagName,w=n.prototype.getElementsByName,M=n.prototype.elementFromPoint,g=n.prototype.caretRangeFromPoint;n.prototype.caretRangeFromPoint=function(p,_){const P=M.call(r,p,_),T=g.call(r,p,_);return F(P,t),T},n.prototype.createElement=function(p,_){let P=o.call(re(this,r),p,_);return Uo(P)&&(P=o.call(r,p,_)),F(P,t)},n.prototype.createElementNS=function(p,_,P){const T=s.call(re(this,r),p,_,P);return F(T,t)},n.prototype.createTextNode=function(p){const _=a.call(re(this,r),p);return F(_,t)},n.prototype.createDocumentFragment=function(){const p=c.call(re(this,r));return F(p,t)},n.prototype.createComment=function(p){const _=u.call(re(this,r),p);return F(_,t)};function m(E){return Tt(t),i===E?r:E}function h(E){var p,_;const P=m(this);if(E==="body"&&((p=v?.options)===null||p===void 0?void 0:p.inheritBaseBody)!==!0)return this.body;if(!E||ye(E)||r!==P)return d.call(P,E);const T=(_=O.get(t))===null||_===void 0?void 0:_.querySelector(E);return T||E==="base"?T:d.call(i,E)}function f(E){var p,_;const P=m(this);if(!E||ye(E)||r!==P)return b.call(P,E);const T=(_=(p=O.get(t))===null||p===void 0?void 0:p.querySelectorAll(E))!==null&&_!==void 0?_:[];return T.length||E==="base"?T:b.call(i,E)}n.prototype.querySelector=h,n.prototype.querySelectorAll=f,n.prototype.getElementById=function(p){const _=m(this);if(pe(p))return A.call(_,p);try{return h.call(re(this,r),`#${p}`)}catch{return A.call(_,p)}},n.prototype.getElementsByClassName=function(p){const _=m(this);if(pe(p))return S.call(_,p);try{return f.call(re(this,r),`.${p}`)}catch{return S.call(_,p)}},n.prototype.getElementsByTagName=function(p){const _=m(re(this,r));if(ye(p)||pe(p))return D.call(_,p);if(/^script$/i.test(p))return D.call(i,p);try{return f.call(re(this,r),p)}catch{return D.call(_,p)}},n.prototype.getElementsByName=function(p){const _=m(re(this,r));if(pe(p))return w.call(_,p);try{return f.call(re(this,r),`[name=${p}]`)}catch{return w.call(_,p)}}}function Os(t,e,r){const n=l.rawDocument,i=e.Document,o=e.document,s=(c,u)=>{const{enumerable:d}=Object.getOwnPropertyDescriptor(i.prototype,c)||{enumerable:!0};return{configurable:!0,enumerable:d,get:u}},a=()=>{const c={};return[["documentURI",()=>r.proxyLocation.href],["URL",()=>r.proxyLocation.href],["documentElement",()=>n.documentElement],["scrollingElement",()=>n.scrollingElement],["forms",()=>i.prototype.querySelectorAll.call(o,"form")],["images",()=>i.prototype.querySelectorAll.call(o,"img")],["links",()=>i.prototype.querySelectorAll.call(o,"a")],["microAppElement",()=>{var d;return(d=O.get(t))===null||d===void 0?void 0:d.container}],["__MICRO_APP_NAME__",()=>t]].forEach(d=>{c[d[0]]=s(d[0],d[1])}),ps.forEach(d=>{c[d]=s(d,()=>n[d])}),ms.forEach(d=>{c[d]=s(d,()=>Z(n[d],n,"DOCUMENT"))}),_s.forEach(d=>{c[d]=s(d,()=>n[d])}),vs.forEach(d=>{c[d]=s(d,()=>Z(n[d],n,"DOCUMENT"))}),c};ee(i.prototype,a()),fs.forEach(c=>{H(o,c,{enumerable:!0,configurable:!0,get:()=>{var u,d;return Tt(t),c==="body"&&((u=v?.options)===null||u===void 0?void 0:u.inheritBaseBody)!==!0&&((d=r.options.container)===null||d===void 0?void 0:d.querySelector("micro-app-body"))||n[c]},set:u=>{n[c]=u}})})}function Ds(t,e){const{rawDocument:r,rawAddEventListener:n,rawRemoveEventListener:i,rawDispatchEvent:o}=l,s=new Map,a=new Map;let c=null,u=null;const d=e.Document,b=e.document;function A(m,h){return li.includes(m)?h:r}d.prototype.addEventListener=function(m,h,f){const E=R(h)?h.__MICRO_APP_BOUND_FUNCTION__=h.__MICRO_APP_BOUND_FUNCTION__||h.bind(this):h,p=s.get(m);p?p.add(h):s.set(m,new Set([h])),h&&(h.__MICRO_APP_MARK_OPTIONS__=f),n.call(A(m,this),m,E,f)},d.prototype.removeEventListener=function(m,h,f){const E=s.get(m);E?.size&&E.has(h)&&E.delete(h);const p=h?.__MICRO_APP_BOUND_FUNCTION__||h;i.call(A(m,this),m,p,f)},d.prototype.dispatchEvent=function(m){return o.call(A(m?.type,this),m)};function S(m){return m==="onclick"?h=>{R(c)&&i.call(r,"click",c,!1),R(h)?(c=h.bind(b),n.call(r,"click",c,!1)):c=h}:h=>{r[m]=R(h)?h.bind(b):h}}Object.getOwnPropertyNames(d.prototype).filter(m=>/^on/.test(m)&&!ui.includes(m)).forEach(m=>{const{enumerable:h,writable:f,set:E}=Object.getOwnPropertyDescriptor(d.prototype,m)||{enumerable:!0,writable:!0};try{H(d.prototype,m,{enumerable:h,configurable:!0,get:()=>m==="onclick"?c:r[m],set:f??!!E?S(m):void 0})}catch(p){ge(p,t)}});const D=()=>{a.clear(),u=null};return{reset:D,record:()=>{u=c||u,s.forEach((m,h)=>{if(m.size){const f=a.get(h)||[];a.set(h,new Set([...f,...m]))}})},rebuild:()=>{u&&!c&&(b.onclick=u),a.forEach((m,h)=>{for(const f of m)b.addEventListener(h,f,f?.__MICRO_APP_MARK_OPTIONS__)}),D()},release:()=>{R(c)&&i.call(r,"click",c),c=null,s.size&&(s.forEach((m,h)=>{for(const f of m)i.call(A(h,b),h,f?.__MICRO_APP_BOUND_FUNCTION__||f)}),s.clear())}}}function Cs(t,e,r,n){Is(t,r,n),Ls(e,r,t)}function Is(t,e,r){const n=l.rawRootElement,i=l.rawRootNode,o=l.rawDocument,s=e.document,a=e.Node,c=e.Element,u=e.DocumentFragment,d=a.prototype.appendChild,b=a.prototype.insertBefore,A=a.prototype.replaceChild,S=a.prototype.removeChild,D=c.prototype.append,w=c.prototype.prepend,M=u.prototype.append,g=u.prototype.prepend,m=c.prototype.insertAdjacentElement,h=a.prototype.cloneNode,f=Object.getOwnPropertyDescriptor(c.prototype,"innerHTML"),E=Object.getOwnPropertyDescriptor(a.prototype,"parentNode"),p=Object.getOwnPropertyDescriptor(a.prototype,"ownerDocument"),_=L=>(Se(L)||xo(L))&&L.__PURE_ELEMENT__,P=L=>L===r.microHead?o.head:L===r.microBody?o.body:L;a.prototype.appendChild=function(y){return F(y,t),_(y)?d.call(this,y):i.prototype.appendChild.call(P(this),y)},a.prototype.insertBefore=function(y,C){return F(y,t),_(y)?b.call(this,y,C):i.prototype.insertBefore.call(P(this),y,C)},a.prototype.replaceChild=function(y,C){return F(y,t),_(y)?A.call(this,y,C):i.prototype.replaceChild.call(P(this),y,C)},a.prototype.removeChild=function(y){return _(y)||this.contains(y)?S.call(this,y):i.prototype.removeChild.call(P(this),y)},u.prototype.append=c.prototype.append=function(...y){let C=0,Ee=!1;for(;C<y.length;)y[C]=De(y[C])?y[C]:s.createTextNode(y[C]),_(y[C])&&(Ee=!0),C++;return Ee?(ke(this)?M:D).call(this,...y):n.prototype.append.call(P(this),...y)},u.prototype.prepend=c.prototype.prepend=function(...y){let C=0,Ee=!1;for(;C<y.length;)y[C]=De(y[C])?y[C]:s.createTextNode(y[C]),_(y[C])&&(Ee=!0),C++;return Ee?(ke(this)?g:w).call(this,...y):n.prototype.prepend.call(P(this),...y)},c.prototype.insertAdjacentElement=function(y,C){return F(C,t),_(C)?m.call(this,y,C):n.prototype.insertAdjacentElement.call(P(this),y,C)},H(a.prototype,"baseURI",{configurable:!0,enumerable:!0,get(){return r.proxyWindow.location.href}}),H(a.prototype,"ownerDocument",{configurable:!0,enumerable:!0,get(){var L;return this.__PURE_ELEMENT__||this===s?(L=p.get)===null||L===void 0?void 0:L.call(this):s}}),H(a.prototype,"parentNode",Xr(t,E)),a.prototype.getRootNode=function(){return s},a.prototype.cloneNode=function(y){const C=h.call(this,y);return F(C,t)},H(c.prototype,"innerHTML",{configurable:!0,enumerable:!0,get(){var L;return(L=f.get)===null||L===void 0?void 0:L.call(this)},set(L){var y;(y=f.set)===null||y===void 0||y.call(this,L),Array.from(this.children).forEach(C=>{he(C)&&F(C,t)})}});const T=new Proxy(e.Image,{construct(L,y){const C=new L(...y);return F(C,t),C}});H(e,"Image",{configurable:!0,writable:!0,value:T})}function Ls(t,e,r){const n=e.Element,i=n.prototype.setAttribute;n.prototype.setAttribute=function(a,c){var u;if(/^micro-app(-\S+)?/i.test(this.tagName)&&a==="data"&&this.setAttribute!==n.prototype.setAttribute)this.setAttribute(a,c);else{const d=(u=v?.options)===null||u===void 0?void 0:u.aHrefResolver;if(a==="href"&&/^a$/i.test(this.tagName)&&typeof d=="function")c=d(c,r,t);else if((a==="src"||a==="srcset")&&/^(img|script|video|audio|source|embed)$/i.test(this.tagName)||a==="href"&&/^(link|image)$/i.test(this.tagName)||a==="href"&&/^(a)$/i.test(this.tagName)&&!/^#/.test(c)){let b=t;st&&a==="href"&&/^a$/i.test(this.tagName)&&R(v.options.excludeAssetFilter)&&v.options.excludeAssetFilter(c)&&(b=document.baseURI),c=z(c,b)}i.call(this,a,c)}},[[e.HTMLImageElement.prototype,"src"],[e.HTMLScriptElement.prototype,"src"],[e.HTMLLinkElement.prototype,"href"],[e.SVGImageElement.prototype,"href"]].forEach(([s,a])=>{const{enumerable:c,configurable:u,get:d,set:b}=Object.getOwnPropertyDescriptor(s,a)||{enumerable:!0,configurable:!0};H(s,a,{enumerable:c,configurable:u,get:function(){return d?.call(this)},set:function(A){b?.call(this,z(A,t))}})})}class Ve{constructor(e,r,n){this.active=!1,this.escapeProperties=[],this.updateIframeBase=()=>{var s;(s=this.baseElement)===null||s===void 0||s.setAttribute("href",W(this.url).origin+this.proxyLocation.pathname)},this.appName=e,this.url=r,this.options=n;const i=l.rawWindow.location,o=i.protocol+"//"+i.host;this.deleteIframeElement=this.createIframeElement(e,o+i.pathname,n),this.microAppWindow=this.iframe.contentWindow,this.patchIframe(this.microAppWindow,s=>{this.microAppWindow=this.iframe.contentWindow,this.createIframeTemplate(this.microAppWindow),this.getSpecialProperties(e),this.proxyLocation=ls(e,r,this.microAppWindow,o),this.windowEffect=bs(e,this.microAppWindow,this),this.documentEffect=ys(e,this.microAppWindow,this),Cs(e,r,this.microAppWindow,this),this.initStaticGlobalKeys(e,r,this.microAppWindow),s()})}createIframeElement(e,r,n){this.iframe=Y("iframe");const i=Object.assign(Object.assign({},n?.attrs),{id:e,src:v.options.iframeSrc||r,style:"display: none","powered-by":"micro-app"});return Object.keys(i).forEach(o=>this.iframe.setAttribute(o,i[o])),l.rawDocument.body.appendChild(this.iframe),()=>te(()=>{var o,s;(s=(o=this.iframe)===null||o===void 0?void 0:o.parentNode)===null||s===void 0||s.removeChild(this.iframe),this.iframe=null})}start({baseroute:e,defaultPage:r,disablePatchRequest:n}){this.active||(this.active=!0,this.initRouteState(r),this.removeHistoryListener=tn(this.microAppWindow.__MICRO_APP_NAME__),ie(this.microAppWindow.__MICRO_APP_NAME__)&&(this.microAppWindow.__MICRO_APP_BASE_ROUTE__=this.microAppWindow.__MICRO_APP_BASE_URL__=e),n||this.createIframeBase(),++l.activeSandbox===1&&(mn(),nn()),++Ve.activeCount)}stop({umdMode:e,keepRouteState:r,destroy:n,clearData:i}){var o;this.active&&(this.recordAndReleaseEffect({clearData:i},!e||n),this.clearRouteState(r),(o=this.removeHistoryListener)===null||o===void 0||o.call(this),(!e||n)&&(this.deleteIframeElement(),this.clearHijackUmdHooks()),--l.activeSandbox===0&&(_n(),on()),--Ve.activeCount,this.active=!1)}initStaticGlobalKeys(e,r,n){n.__MICRO_APP_ENVIRONMENT__=!0,n.__MICRO_APP_NAME__=e,n.__MICRO_APP_URL__=r,n.__MICRO_APP_PUBLIC_PATH__=lt(r),n.__MICRO_APP_BASE_ROUTE__="",n.__MICRO_APP_WINDOW__=n,n.__MICRO_APP_PRE_RENDER__=!1,n.__MICRO_APP_UMD_MODE__=!1,n.__MICRO_APP_PROXY_WINDOW__=this.proxyWindow,n.__MICRO_APP_SANDBOX__=this,n.__MICRO_APP_SANDBOX_TYPE__="iframe",n.rawWindow=l.rawWindow,n.rawDocument=l.rawDocument,n.microApp=k(new Gr(e),{removeDomScope:G,pureCreateElement:Y,location:this.proxyLocation,router:ze})}recordAndReleaseEffect(e,r=!1){r?this.resetEffectSnapshot():this.recordEffectSnapshot(),this.releaseGlobalEffect(e)}resetEffectSnapshot(){var e,r;(e=this.windowEffect)===null||e===void 0||e.reset(),(r=this.documentEffect)===null||r===void 0||r.reset(),Ft(this.microAppWindow.microApp)}recordEffectSnapshot(){var e,r;(e=this.windowEffect)===null||e===void 0||e.record(),(r=this.documentEffect)===null||r===void 0||r.record(),qr(this.microAppWindow.microApp)}rebuildEffectSnapshot(){var e,r;(e=this.windowEffect)===null||e===void 0||e.rebuild(),(r=this.documentEffect)===null||r===void 0||r.rebuild(),Kr(this.microAppWindow.microApp)}releaseGlobalEffect({clearData:e=!1}){var r,n,i,o,s;(r=this.windowEffect)===null||r===void 0||r.release(),(n=this.documentEffect)===null||n===void 0||n.release(),(i=this.microAppWindow.microApp)===null||i===void 0||i.clearDataListener(),(o=this.microAppWindow.microApp)===null||o===void 0||o.clearGlobalDataListener(),e&&(v.clearData(this.microAppWindow.__MICRO_APP_NAME__),(s=this.microAppWindow.microApp)===null||s===void 0||s.clearData())}setPreRenderState(e){this.microAppWindow.__MICRO_APP_PRE_RENDER__=e}markUmdMode(e){this.microAppWindow.__MICRO_APP_UMD_MODE__=e}patchIframe(e,r){const n=e.document;this.sandboxReady=new Promise(i=>{(function o(){setTimeout(()=>{try{e.document===n?o():(e.stop(),r(i))}catch{o()}},0)})()})}createIframeTemplate(e){const r=e.document;Ko(r);const n=r.createElement("html");n.innerHTML="<head></head><body></body>",r.appendChild(n),this.microBody=r.body,this.microHead=r.head}createIframeBase(){this.baseElement=Y("base"),this.updateIframeBase(),this.microHead.appendChild(this.baseElement)}getSpecialProperties(e){var r;U(v.options.plugins)&&(this.commonActionForSpecialProperties(v.options.plugins.global),this.commonActionForSpecialProperties((r=v.options.plugins.modules)===null||r===void 0?void 0:r[e]))}commonActionForSpecialProperties(e){if(le(e))for(const r of e)U(r)&&le(r.escapeProperties)&&(this.escapeProperties=this.escapeProperties.concat(r.escapeProperties))}initRouteState(e){cn(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location,e)}clearRouteState(e){ln(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.__MICRO_APP_URL__,this.microAppWindow.location,e)}setRouteInfoForKeepAliveApp(){qt(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location)}removeRouteInfoForKeepAliveApp(){_t(this.microAppWindow.__MICRO_APP_NAME__)}patchStaticElement(e){Ht(e,this.microAppWindow.__MICRO_APP_NAME__)}actionsBeforeExecScripts(e,r){this.patchStaticElement(e),this.clearHijackUmdHooks=this.hijackUmdHooks(this.appName,this.microAppWindow,r)}hijackUmdHooks(e,r,n){let i,o,s;return ee(r,{mount:{configurable:!0,get:()=>i,set:a=>{this.active&&R(a)&&!i&&n(i=a,o)}},unmount:{configurable:!0,get:()=>o,set:a=>{this.active&&R(a)&&!o&&n(i,o=a)}},[`micro-app-${e}`]:{configurable:!0,get:()=>s,set:a=>{this.active&&U(a)&&!s&&(s=a,n(s.mount,s.unmount))}}}),()=>{i=o=s=null}}setStaticAppState(e){this.microAppWindow.__MICRO_APP_STATE__=e}}Ve.activeCount=0;const O=new Map;class un{constructor({name:e,url:r,container:n,scopecss:i,useSandbox:o,inline:s,iframe:a,ssrUrl:c,isPrefetch:u,prefetchLevel:d,routerMode:b,attrs:A}){this.state=j.CREATED,this.keepAliveState=null,this.loadSourceLevel=0,this.umdHookMount=null,this.umdHookUnmount=null,this.umdMode=!1,this.sandBox=null,this.fiber=!1,this.isReloading=!1,O.set(e,this),this.name=e,this.url=r,this.useSandbox=o,this.scopecss=this.useSandbox&&i,this.attrs=A,this.iframe=a??!1,this.inline=this.getInlineModeState(s),this.isReloading=!1,this.routerMode=b||$e,this.container=n??null,this.ssrUrl=c??"",this.isPrefetch=u??!1,this.isPrerender=d===3,this.prefetchLevel=d,this.source={html:null,links:new Set,scripts:new Set},this.loadSourceCode(),this.createSandbox()}loadSourceCode(){this.setAppState(j.LOADING),Nt.getInstance().run(this,Di)}onLoad({html:e,defaultPage:r,routerMode:n,baseroute:i,disablePatchRequest:o}){var s;if(++this.loadSourceLevel===2){if(this.source.html=e,this.isUnmounted())return;if(!this.isPrefetch)de(this.container).mount(this);else if(this.isPrerender){const a=Y("div");a.setAttribute("prerender","true"),(s=this.sandBox)===null||s===void 0||s.setPreRenderState(!0),this.mount({container:a,inline:this.inline,fiber:!0,defaultPage:r||"",disablePatchRequest:o??!1,routerMode:n,baseroute:i||""})}}}onLoadError(e){this.loadSourceLevel=-1,this.isUnmounted()||(this.onerror(e),this.setAppState(j.LOAD_FAILED))}mount({container:e,inline:r,routerMode:n,defaultPage:i,baseroute:o,disablePatchRequest:s,fiber:a}){if(this.loadSourceLevel!==2)return this.container=e,this.isPrerender=!1,se(this,"statechange",{appState:j.LOADING}),this.setAppState(j.LOADING);this.createSandbox();const c=()=>{var u,d,b,A,S,D,w;if(this.setAppState(j.BEFORE_MOUNT),this.isPrerender&&Lo(this.container)&&this.container.hasAttribute("prerender"))this.container=this.cloneContainer(e,this.container,!1),(u=this.sandBox)===null||u===void 0||u.rebuildEffectSnapshot(),(d=this.preRenderEvents)===null||d===void 0||d.forEach(M=>M()),this.isPrerender=!1,this.preRenderEvents=null,ze.attachToURL(this.name),(b=this.sandBox)===null||b===void 0||b.setPreRenderState(!1);else{this.container=e,this.inline=this.getInlineModeState(r),this.fiber=a,this.routerMode=n;const M=()=>{fe(this.container,this.name,N.BEFOREMOUNT)};if(this.isPrerender?((A=this.preRenderEvents)!==null&&A!==void 0?A:this.preRenderEvents=[]).push(M):M(),this.setAppState(j.MOUNTING),se(this,"statechange",{appState:j.MOUNTING}),this.cloneContainer(this.container,this.source.html,!this.umdMode),(S=this.sandBox)===null||S===void 0||S.start({umdMode:this.umdMode,baseroute:o,defaultPage:i,disablePatchRequest:s}),!this.umdMode)(D=this.sandBox)===null||D===void 0||D.actionsBeforeExecScripts(this.container,(g,m)=>{var h;if(!this.umdMode&&!this.isUnmounted()&&(this.umdHookMount=R(g)?g:null,this.umdHookUnmount=R(m)?m:null,R(this.umdHookMount)&&R(this.umdHookUnmount))){(h=this.sandBox)===null||h===void 0||h.markUmdMode(this.umdMode=!0);try{this.getAppState()===j.MOUNTED?this.umdHookMount(v.getData(this.name,!0)):this.handleMounted(this.umdHookMount(v.getData(this.name,!0)))}catch(f){I(`An error occurred when mount 
`,this.name,f)}}}),wi(this,g=>{!this.umdMode&&g===!0&&this.handleMounted()});else{(w=this.sandBox)===null||w===void 0||w.rebuildEffectSnapshot();try{this.handleMounted(this.umdHookMount(v.getData(this.name,!0)))}catch(g){I(`An error occurred when mount 
`,this.name,g)}}}};this.sandBox?this.sandBox.sandboxReady.then(()=>!this.isUnmounted()&&c()):c()}handleMounted(e){var r,n;const i=()=>{const o=()=>this.actionsAfterMounted();At(e)?e.then(o).catch(s=>{I(`An error occurred in window.mount 
`,this.name,s),o()}):o()};this.isPrerender?((r=this.preRenderEvents)===null||r===void 0||r.push(i),(n=this.sandBox)===null||n===void 0||n.recordAndReleaseEffect({isPrerender:!0})):i()}actionsAfterMounted(){var e;this.isUnmounted()||(this.setAppState(j.MOUNTED),kt(this.getMicroAppGlobalHook(Pe.ONMOUNT),this.name,Pe.ONMOUNT,v.getData(this.name,!0)),se(this,"statechange",{appState:j.MOUNTED}),se(this,"mounted"),fe(this.container,this.name,N.MOUNTED),this.isHidden()&&((e=this.sandBox)===null||e===void 0||e.recordAndReleaseEffect({keepAlive:!0})))}unmount({destroy:e,clearData:r,keepRouteState:n,unmountcb:i}){var o;e=e||this.state===j.LOAD_FAILED,this.setAppState(j.UNMOUNT);try{this.handleUnmounted(e,r,n,i,(o=this.umdHookUnmount)===null||o===void 0?void 0:o.call(this,v.getData(this.name,!0)))}catch(s){I(`An error occurred when unmount 
`,this.name,s)}}handleUnmounted(e,r,n,i,o){se(this,"statechange",{appState:j.UNMOUNT}),se(this,"unmount"),kt(this.getMicroAppGlobalHook(Pe.ONUNMOUNT),this.name,Pe.ONUNMOUNT);const s=()=>this.actionsAfterUnmounted({destroy:e,clearData:r,keepRouteState:n,unmountcb:i});At(o)?(G(),o.then(s).catch(a=>{I(`An error occurred in window.unmount 
`,this.name,a),s()})):s()}actionsAfterUnmounted({destroy:e,clearData:r,keepRouteState:n,unmountcb:i}){var o;this.umdMode&&this.container&&!e&&this.cloneContainer(this.source.html,this.container,!1);const s=this.isReloading?!1:r||e;(o=this.sandBox)===null||o===void 0||o.stop({umdMode:this.umdMode,keepRouteState:n&&!e,destroy:e,clearData:s}),fe(this.container,this.name,N.UNMOUNT),this.clearOptions(e),i?.()}clearOptions(e){var r,n;this.isPrerender=!1,this.preRenderEvents=null,this.setKeepAliveState(null),this.container?(this.container.innerHTML="",this.container=null):this.umdMode||(n=(r=this.sandBox)===null||r===void 0?void 0:r.deleteIframeElement)===null||n===void 0||n.call(r),this.iframe&&!this.umdMode&&(this.sandBox=null),e&&this.actionsForCompletelyDestroy(),G()}actionsForCompletelyDestroy(){var e,r;(r=(e=this.sandBox)===null||e===void 0?void 0:e.deleteIframeElement)===null||r===void 0||r.call(e),J.script.deleteInlineInfo(this.source.scripts),O.delete(this.name)}hiddenKeepAliveApp(e){var r,n;this.setKeepAliveState(Be.KEEP_ALIVE_HIDDEN),se(this,"appstate-change",{appState:"afterhidden"}),fe(this.container,this.name,N.AFTERHIDDEN),X(this.name)&&((r=this.sandBox)===null||r===void 0||r.removeRouteInfoForKeepAliveApp()),this.loadSourceLevel!==2?de(this.container).unmount():(this.container=this.cloneContainer(Y("div"),this.container,!1),(n=this.sandBox)===null||n===void 0||n.recordAndReleaseEffect({keepAlive:!0})),e?.()}showKeepAliveApp(e){var r,n;const i=this.container;this.container=e,(r=this.sandBox)===null||r===void 0||r.rebuildEffectSnapshot(),se(this,"appstate-change",{appState:"beforeshow"}),fe(e,this.name,N.BEFORESHOW),this.setKeepAliveState(Be.KEEP_ALIVE_SHOW),this.cloneContainer(this.container,i,!1),X(this.name)&&((n=this.sandBox)===null||n===void 0||n.setRouteInfoForKeepAliveApp()),se(this,"appstate-change",{appState:"aftershow"}),fe(this.container,this.name,N.AFTERSHOW)}onerror(e){se(this,"statechange",{appState:j.LOAD_FAILED}),fe(this.container,this.name,N.ERROR,e)}parseHtmlString(e){var r;const n=!((r=this.sandBox)===null||r===void 0)&&r.proxyWindow?this.sandBox.proxyWindow.DOMParser:l.rawWindow.DOMParser;return new n().parseFromString(e,"text/html").body}cloneContainer(e,r,n){return r&&e&&(e.innerHTML="",Array.from(n?this.parseHtmlString(r.innerHTML).childNodes:r.childNodes).forEach(i=>{e.appendChild(i)})),e}createSandbox(){if(this.useSandbox&&!this.sandBox){const e={attrs:this.attrs,container:this.container};this.sandBox=this.iframe?new Ve(this.name,this.url,e):new Ke(this.name,this.url)}}setAppState(e){var r;this.state=e,(r=this.sandBox)===null||r===void 0||r.setStaticAppState(e)}getAppState(){return this.state}setKeepAliveState(e){this.keepAliveState=e}getKeepAliveState(){return this.keepAliveState}isUnmounted(){return j.UNMOUNT===this.state}isHidden(){return Be.KEEP_ALIVE_HIDDEN===this.keepAliveState}getMicroAppGlobalHook(e){var r,n;const i=(n=(r=this.sandBox)===null||r===void 0?void 0:r.proxyWindow)===null||n===void 0?void 0:n[e];return R(i)?i:null}querySelector(e){return this.container?l.rawElementQuerySelector.call(this.container,e):null}querySelectorAll(e){return this.container?l.rawElementQuerySelectorAll.call(this.container,e):[]}getInlineModeState(e){var r;return(r=this.iframe||e)!==null&&r!==void 0?r:!1}}function be(t){var e,r;return(r=(e=O.get(t))===null||e===void 0?void 0:e.iframe)!==null&&r!==void 0?r:!1}const ue=new WeakMap;function hn(t){var e;return(e=ue.get(t))!==null&&e!==void 0?e:t}function dn(t,e){if(ue.has(t))return ue.get(t);if(wr(t)){if(t.hasAttribute("exclude")){const r=document.createComment("style element with exclude attribute ignored by micro-app");return ue.set(t,r),r}else if(e.scopecss&&!t.hasAttribute("ignore"))return dt(t,e);return t}else if(Co(t)){if(t.hasAttribute("exclude")||Ut(t.getAttribute("href"),e.name)){const o=document.createComment("link element with exclude attribute ignored by micro-app");return ue.set(t,o),o}else if(t.hasAttribute("ignore")||Wt(t.getAttribute("href"),e.name)||t.href&&R(v.options.excludeAssetFilter)&&v.options.excludeAssetFilter(t.href))return t;const{address:r,linkInfo:n,replaceComment:i}=yr(t,null,e,!0);if(r&&n){const o=ni(r,e,n,t);return ue.set(t,o),o}else if(i)return ue.set(t,i),i;return t}else if(Se(t)){if(t.src&&R(v.options.excludeAssetFilter)&&v.options.excludeAssetFilter(t.src))return t;const{replaceComment:r,address:n,scriptInfo:i}=Fr(t,null,e,!0)||{};if(n&&i){const o=i.isExternal?Ai(n,e,i,t):bi(n,e,i);return ue.set(t,o),o}else if(r)return ue.set(t,r),r;return t}return t}function fn(t,e,r,n,i){const o=pn(r,n,t);if(o){if(!be(t.name)&&et(o)&&e!==l.rawRemoveChild){const s=Object.getOwnPropertyDescriptor(n,"parentNode");(!s||s.configurable)&&!n.__MICRO_APP_HAS_DPN__&&ee(n,{parentNode:{configurable:!0,get(){var a,c;const u=l.rawParentNodeDesc.get.call(this);return et(u)&&t.container?((c=(a=v.options).getRootElementParentNode)===null||c===void 0?void 0:c.call(a,this,t.name))||document.body:u}},__MICRO_APP_HAS_DPN__:{configurable:!0,get:()=>!0}})}if(i&&!o.contains(i)){if(e===l.rawInsertBefore&&r.contains(i)){const s=Array.from(r.childNodes).indexOf(i);if(o.childNodes[s])return Ze(e,o,n,o.childNodes[s],t)}return l.rawAppendChild.call(o,n)}else if(e===l.rawRemoveChild&&!o.contains(n))return r.contains(n)?e.call(n.parentElement,n):n;return Ze(e,o,n,i,t)}return Ze(e,r,n,i,t)}function pn(t,e,r){if(r){if(t===document.head)return r.iframe&&Se(e)?r.sandBox.microHead:r.querySelector("micro-app-head");if(t===document.body||t===document.body.parentNode)return r.iframe&&Se(e)?r.sandBox.microBody:r.querySelector("micro-app-body");if(r.iframe&&Se(e))return r.sandBox.microBody}return null}function Ze(t,e,r,n,i){return Ts(t)?(i?.iframe&&Se(r)&&(t===l.rawFragmentAppend?t=l.rawAppend:t===l.rawFragmentPrepend&&(t=l.rawPrepend)),t.call(e,r)):t.call(e,r,n)}function Ts(t){return t===l.rawAppend||t===l.rawPrepend||t===l.rawFragmentAppend||t===l.rawFragmentPrepend}function xs(t,e){var r;if(he(e)){if(/^(img|script)$/i.test(e.tagName))e.hasAttribute("src")&&l.rawSetAttribute.call(e,"src",z(e.getAttribute("src"),t.url)),e.hasAttribute("srcset")&&l.rawSetAttribute.call(e,"srcset",z(e.getAttribute("srcset"),t.url));else if(/^(link|image)$/i.test(e.tagName)&&e.hasAttribute("href")||/^(a)$/i.test(e.tagName)&&e.hasAttribute("href")&&!/^#/.test(e.getAttribute("href")||"")){const n=(r=v?.options)===null||r===void 0?void 0:r.aHrefResolver,i=e.getAttribute("href");let o;/^(a)$/i.test(e.tagName)&&typeof n=="function"?o=n(i,t.name,t.url):o=z(i,t.url),l.rawSetAttribute.call(e,"href",o)}}}function Le(t,e,r,n){const i=Q();if(De(e)&&!e.__PURE_ELEMENT__&&(e.__MICRO_APP_NAME__||i)){F(e,e.__MICRO_APP_NAME__||i);const o=O.get(e.__MICRO_APP_NAME__);if(o?.container)return wr(e)&&t.getRootNode()instanceof ShadowRoot&&e.setAttribute("ignore","true"),xs(o,e),fn(o,n,t,dn(e,o),r&&hn(r))}return Ze(n,t,e,r)}function mn(){Ns();const t=l.rawRootElement,e=l.rawRootNode,r=l.rawDocumentFragment;e.prototype.appendChild=function(s){return Le(this,s,null,l.rawAppendChild)},e.prototype.insertBefore=function(s,a){return Le(this,s,a,l.rawInsertBefore)},e.prototype.replaceChild=function(s,a){return Le(this,s,a,l.rawReplaceChild)},e.prototype.removeChild=function(s){if(s?.__MICRO_APP_NAME__){const a=O.get(s.__MICRO_APP_NAME__);if(a?.container)return fn(a,l.rawRemoveChild,this,hn(s));try{return l.rawRemoveChild.call(this,s)}catch{return s?.parentNode&&l.rawRemoveChild.call(s.parentNode,s)}}return l.rawRemoveChild.call(this,s)},r.prototype.append=t.prototype.append=function(...s){let a=0;for(;a<s.length;){let c=s[a];c=De(c)?c:l.rawCreateTextNode.call(l.rawDocument,c),Le(this,Re(c),null,ke(this)?l.rawFragmentAppend:l.rawAppend),a++}},r.prototype.prepend=t.prototype.prepend=function(...s){let a=s.length,c=l.rawPrepend;for((ke(this)||No(this))&&(c=l.rawFragmentPrepend);a>0;){let u=s[a-1];u=De(u)?u:l.rawCreateTextNode.call(l.rawDocument,u),Le(this,Re(u),null,c),a--}},t.prototype.insertAdjacentElement=function(o,s){var a;if(s?.__MICRO_APP_NAME__&&he(s)){const c=O.get(s.__MICRO_APP_NAME__);if(c?.container){const u=dn(s,c);if(!he(u))return s;const d=(a=pn(this,u,c))!==null&&a!==void 0?a:this;return l.rawInsertAdjacentElement.call(d,o,u)}}return l.rawInsertAdjacentElement.call(this,o,s)};function n(o){const s=Je()||Q();if((o===document.body||o===document.head)&&s){const a=O.get(s);if(a?.container){if(o===document.body)return a.querySelector("micro-app-body");if(o===document.head)return a.querySelector("micro-app-head")}}return o}function i(o,s,a,c,u){if(o){const d=Je()||Q();if(d&&be(d)){const b=O.get(d);if(Bo(s))return b.sandBox.microHead[u](c);if(et(s))return b.sandBox.microBody[u](c)}}return a}t.prototype.querySelector=function(s){var a;const c=(a=n(this))!==null&&a!==void 0?a:this,u=l.rawElementQuerySelector.call(c,s);return i(Ue(u)&&c!==this,c,u,s,"querySelector")},t.prototype.querySelectorAll=function(s){var a;const c=(a=n(this))!==null&&a!==void 0?a:this,u=l.rawElementQuerySelectorAll.call(c,s);return i(!u.length&&c!==this,c,u,s,"querySelectorAll")},t.prototype.setAttribute=function(s,a){var c,u;if(/^micro-app(-\S+)?/i.test(this.tagName)&&s==="data"&&this.setAttribute!==t.prototype.setAttribute)this.setAttribute(s,a);else{const d=this.__MICRO_APP_NAME__||Q();if(d&&O.has(d)&&((s==="src"||s==="srcset")&&/^(img|script|video|audio|source|embed)$/i.test(this.tagName)||s==="href"&&/^(link|image)$/i.test(this.tagName)||s==="href"&&/^(a)$/i.test(this.tagName)&&!/^#/.test(a))){const b=O.get(d),A=(c=v?.options)===null||c===void 0?void 0:c.aHrefResolver;s==="href"&&/^a$/i.test(this.tagName)&&typeof A=="function"?a=A(a,d,b.url):a=z(a,b.url)}if(l.rawSetAttribute.call(this,s,a),To(this)||Do(this)||Oo(this)){let b=!1;!((u=v?.options)===null||u===void 0)&&u.includeCrossOrigin&&R(v.options.includeCrossOrigin)&&(b=v.options.includeCrossOrigin(a)),b&&(node.crossOrigin="anonymous")}}},H(e.prototype,"parentNode",{configurable:!0,enumerable:!0,get(){var o,s,a;const c=Je()||Q();if(c&&this===l.rawDocument.firstElementChild){const d=(a=(s=(o=O.get(c))===null||o===void 0?void 0:o.sandBox)===null||s===void 0?void 0:s.proxyWindow)===null||a===void 0?void 0:a.document;if(d)return d}return l.rawParentNodeDesc.get.call(this)}}),H(t.prototype,"innerHTML",{configurable:!0,enumerable:!0,get(){return l.rawInnerHTMLDesc.get.call(this)},set(o){l.rawInnerHTMLDesc.set.call(this,o);const s=this.__MICRO_APP_NAME__||Je()||Q();Array.from(this.children).forEach(a=>{he(a)&&s&&F(a,s)})}}),e.prototype.cloneNode=function(s){const a=l.rawCloneNode.call(this,s);return F(a,this.__MICRO_APP_NAME__)}}function Re(t){return F(t,Q())}function Ns(){const t=l.rawDocument,e=l.rawRootDocument;function r(o){return Wo(o)?t:o}e.prototype.createElement=function(s,a){const c=l.rawCreateElement.call(r(this),s,a);return Re(c)},e.prototype.createElementNS=function(s,a,c){const u=l.rawCreateElementNS.call(r(this),s,a,c);return Re(u)},e.prototype.createDocumentFragment=function(){const s=l.rawCreateDocumentFragment.call(r(this));return Re(s)},e.prototype.createComment=function(s){const a=l.rawCreateComment.call(r(this),s);return Re(a)};function n(o){var s,a;const c=r(this),u=Q();return!u||!o||ye(o)||t!==c?l.rawQuerySelector.call(c,o):(a=(s=O.get(u))===null||s===void 0?void 0:s.querySelector(o))!==null&&a!==void 0?a:null}function i(o){var s,a;const c=r(this),u=Q();return!u||!o||ye(o)||t!==c?l.rawQuerySelectorAll.call(c,o):(a=(s=O.get(u))===null||s===void 0?void 0:s.querySelectorAll(o))!==null&&a!==void 0?a:[]}e.prototype.querySelector=n,e.prototype.querySelectorAll=i,e.prototype.getElementById=function(s){const a=r(this);if(!Q()||pe(s))return l.rawGetElementById.call(a,s);try{return n.call(a,`#${s}`)}catch{return l.rawGetElementById.call(a,s)}},e.prototype.getElementsByClassName=function(s){const a=r(this);if(!Q()||pe(s))return l.rawGetElementsByClassName.call(a,s);try{return i.call(a,`.${s}`)}catch{return l.rawGetElementsByClassName.call(a,s)}},e.prototype.getElementsByTagName=function(s){var a;const c=r(this),u=Q();if(!u||ye(s)||pe(s)||!(!((a=O.get(u))===null||a===void 0)&&a.inline)&&/^script$/i.test(s))return l.rawGetElementsByTagName.call(c,s);try{return i.call(c,s)}catch{return l.rawGetElementsByTagName.call(c,s)}},e.prototype.getElementsByName=function(s){const a=r(this);if(!Q()||pe(s))return l.rawGetElementsByName.call(a,s);try{return i.call(a,`[name=${s}]`)}catch{return l.rawGetElementsByName.call(a,s)}}}function Bs(){const t=l.rawRootDocument;t.prototype.createElement=l.rawCreateElement,t.prototype.createElementNS=l.rawCreateElementNS,t.prototype.createDocumentFragment=l.rawCreateDocumentFragment,t.prototype.querySelector=l.rawQuerySelector,t.prototype.querySelectorAll=l.rawQuerySelectorAll,t.prototype.getElementById=l.rawGetElementById,t.prototype.getElementsByClassName=l.rawGetElementsByClassName,t.prototype.getElementsByTagName=l.rawGetElementsByTagName,t.prototype.getElementsByName=l.rawGetElementsByName}function _n(){G(),Bs();const t=l.rawRootElement,e=l.rawRootNode;e.prototype.appendChild=l.rawAppendChild,e.prototype.insertBefore=l.rawInsertBefore,e.prototype.replaceChild=l.rawReplaceChild,e.prototype.removeChild=l.rawRemoveChild,e.prototype.cloneNode=l.rawCloneNode,t.prototype.append=l.rawAppend,t.prototype.prepend=l.rawPrepend,t.prototype.querySelector=l.rawElementQuerySelector,t.prototype.querySelectorAll=l.rawElementQuerySelectorAll,t.prototype.setAttribute=l.rawSetAttribute,H(e.prototype,"parentNode",l.rawParentNodeDesc),H(t.prototype,"innerHTML",l.rawInnerHTMLDesc)}let dr=!1;function Us(){if(!dr){dr=!0;const t=Y("style");l.rawSetAttribute.call(t,"type","text/css"),t.textContent=`
${v.tagName}, micro-app-body { display: block; } 
micro-app-head { display: none; }`,l.rawDocument.head.appendChild(t)}}const l={activeSandbox:0};function Ws(){if(st){const t=window.rawWindow||Function("return window")(),e=window.rawDocument||Function("return document")(),r=t.Document||Function("return Document")(),n=t.Element,i=t.Node,o=t.EventTarget,s=t.DocumentFragment,a=i.prototype.appendChild,c=i.prototype.insertBefore,u=i.prototype.replaceChild,d=i.prototype.removeChild,b=n.prototype.setAttribute,A=n.prototype.append,S=n.prototype.prepend,D=s.prototype.append,w=s.prototype.prepend,M=i.prototype.cloneNode,g=n.prototype.querySelector,m=n.prototype.querySelectorAll,h=n.prototype.insertAdjacentElement,f=Object.getOwnPropertyDescriptor(n.prototype,"innerHTML"),E=Object.getOwnPropertyDescriptor(i.prototype,"parentNode"),p=r.prototype.createElement,_=r.prototype.createElementNS,P=r.prototype.createTextNode,T=r.prototype.createDocumentFragment,L=r.prototype.createComment,y=r.prototype.querySelector,C=r.prototype.querySelectorAll,Ee=r.prototype.getElementById,gn=r.prototype.getElementsByClassName,En=r.prototype.getElementsByTagName,wn=r.prototype.getElementsByName,An=new Proxy(t.Image,{construct(In,Ln){return F(new In(...Ln),Q())}}),bn=t.setInterval,Pn=t.setTimeout,Rn=t.clearInterval,Sn=t.clearTimeout,yn=t.history.pushState,Mn=t.history.replaceState,On=o.prototype.addEventListener,Dn=o.prototype.removeEventListener,Cn=o.prototype.dispatchEvent;window.__MICRO_APP_BASE_APPLICATION__=!0,k(l,{supportModuleScript:jo(),rawWindow:t,rawDocument:e,rawRootDocument:r,rawRootElement:n,rawRootNode:i,rawDocumentFragment:s,rawSetAttribute:b,rawAppendChild:a,rawInsertBefore:c,rawReplaceChild:u,rawRemoveChild:d,rawAppend:A,rawPrepend:S,rawFragmentAppend:D,rawFragmentPrepend:w,rawCloneNode:M,rawElementQuerySelector:g,rawElementQuerySelectorAll:m,rawInsertAdjacentElement:h,rawInnerHTMLDesc:f,rawParentNodeDesc:E,rawCreateElement:p,rawCreateElementNS:_,rawCreateDocumentFragment:T,rawCreateTextNode:P,rawCreateComment:L,rawQuerySelector:y,rawQuerySelectorAll:C,rawGetElementById:Ee,rawGetElementsByClassName:gn,rawGetElementsByTagName:En,rawGetElementsByName:wn,ImageProxy:An,rawSetInterval:bn,rawSetTimeout:Pn,rawClearInterval:Rn,rawClearTimeout:Sn,rawPushState:yn,rawReplaceState:Mn,rawAddEventListener:On,rawRemoveEventListener:Dn,rawDispatchEvent:Cn}),Us()}}function Fs(t){class e extends HTMLElement{constructor(){super(...arguments),this.isWaiting=!1,this.cacheData=null,this.connectedCount=0,this.connectStateMap=new Map,this._appName="",this.appUrl="",this.ssrUrl="",this.version=Ao,this.handleAttributeUpdate=()=>{this.isWaiting=!1;const n=$(this.getAttribute("name")),i=bt(this.getAttribute("url"),this.appName);if(this.legalAttribute("name",n)&&this.legalAttribute("url",i)){const o=O.get(n);if(n!==this.appName&&o&&!o.isUnmounted()&&!o.isHidden()&&!o.isPrefetch)return this.setAttribute("name",this.appName),I(`app name conflict, an app named ${n} is running`);(n!==this.appName||i!==this.appUrl)&&(n===this.appName?this.unmount(!0,()=>{this.actionsForAttributeChange(n,i,o)}):this.getKeepAliveModeResult()?(this.handleHiddenKeepAliveApp(),this.actionsForAttributeChange(n,i,o)):this.unmount(!1,()=>{this.actionsForAttributeChange(n,i,o)}))}else n!==this.appName&&this.setAttribute("name",this.appName)}}static get observedAttributes(){return["name","url"]}connectedCallback(){Object.getPrototypeOf(this)!==e.prototype&&Object.setPrototypeOf(this,e.prototype);const n=++this.connectedCount;this.connectStateMap.set(n,!0);const i=this.appName&&this.appUrl;te(()=>{this.connectStateMap.get(n)&&(fe(this,this.appName,N.CREATED),i&&this.handleConnected())})}disconnectedCallback(){this.connectStateMap.set(this.connectedCount,!1),this.handleDisconnected()}reload(n){return new Promise(i=>{const o=()=>{this.removeEventListener(N.MOUNTED,o),this.removeEventListener(N.AFTERSHOW,o),i(!0)};this.addEventListener(N.MOUNTED,o),this.addEventListener(N.AFTERSHOW,o),this.handleDisconnected(n,()=>{this.handleConnected()})})}handleDisconnected(n=!1,i){const o=O.get(this.appName);o&&!o.isUnmounted()&&!o.isHidden()&&(this.getKeepAliveModeResult()&&!n?this.handleHiddenKeepAliveApp(i):this.unmount(n,i))}attributeChangedCallback(n,i,o){if(this.legalAttribute(n,o)&&this[n===Ne.NAME?"appName":"appUrl"]!==o)if(n===Ne.URL&&(!this.appUrl||!this.connectStateMap.get(this.connectedCount))){if(o=bt(o,this.appName),!o)return I(`Invalid attribute url ${o}`,this.appName);this.appUrl=o,this.handleInitialNameAndUrl()}else if(n===Ne.NAME&&(!this.appName||!this.connectStateMap.get(this.connectedCount))){const s=$(o);if(!s)return I(`Invalid attribute name ${o}`,this.appName);this.cacheData&&(v.setData(s,this.cacheData),this.cacheData=null),this.appName=s,s!==o&&this.setAttribute("name",this.appName),this.handleInitialNameAndUrl()}else this.isWaiting||(this.isWaiting=!0,te(this.handleAttributeUpdate))}handleInitialNameAndUrl(){this.connectStateMap.get(this.connectedCount)&&this.handleConnected()}handleConnected(){if(!(!this.appName||!this.appUrl))if(this.getDisposeResult("shadowDOM")&&!this.shadowRoot&&R(this.attachShadow)&&this.attachShadow({mode:"open"}),this.updateSsrUrl(this.appUrl),O.has(this.appName)){const n=O.get(this.appName),i=n.ssrUrl||n.url,o=this.ssrUrl||this.appUrl;n.isHidden()&&n.url===this.appUrl?this.handleShowKeepAliveApp(n):i===o&&(n.isUnmounted()||n.isPrefetch&&this.sameCoreOptions(n))?this.handleMount(n):n.isPrefetch||n.isUnmounted()?this.handleCreateApp():I(`app name conflict, an app named ${this.appName} with url ${i} is running`)}else this.handleCreateApp()}actionsForAttributeChange(n,i,o){var s;this.updateSsrUrl(i),this.appName=n,this.appUrl=i,((s=this.shadowRoot)!==null&&s!==void 0?s:this).innerHTML="",n!==this.getAttribute("name")&&this.setAttribute("name",this.appName),o?o.isHidden()?o.url===this.appUrl?this.handleShowKeepAliveApp(o):I(`app name conflict, an app named ${this.appName} is running`):o.url===this.appUrl&&o.ssrUrl===this.ssrUrl?this.handleMount(o):this.handleCreateApp():this.handleCreateApp()}legalAttribute(n,i){return!B(i)||!i?(I(`unexpected attribute ${n}, please check again`,this.appName),!1):!0}handleCreateApp(){const n={};Array.prototype.slice.call(this.attributes).forEach(({name:s,value:a})=>{s.startsWith("data-")&&(n[s]=a)});const i=()=>{var s;return new un({name:this.appName,url:this.appUrl,container:(s=this.shadowRoot)!==null&&s!==void 0?s:this,scopecss:this.useScopecss(),useSandbox:this.useSandbox(),inline:this.getDisposeResult("inline"),iframe:this.getDisposeResult("iframe"),ssrUrl:this.ssrUrl,routerMode:this.getMemoryRouterMode(),attrs:n})},o=O.get(this.appName);o?o.isPrerender?this.unmount(!0,i):(o.actionsForCompletelyDestroy(),i()):i()}handleMount(n){n.isPrefetch=!1,n.setAppState(j.BEFORE_MOUNT),te(()=>this.mount(n))}mount(n){var i;n.mount({container:(i=this.shadowRoot)!==null&&i!==void 0?i:this,inline:this.getDisposeResult("inline"),routerMode:this.getMemoryRouterMode(),baseroute:this.getBaseRouteCompatible(),defaultPage:this.getDefaultPage(),disablePatchRequest:this.getDisposeResult("disable-patch-request"),fiber:this.getDisposeResult("fiber")})}unmount(n,i){const o=O.get(this.appName);o&&!o.isUnmounted()&&o.unmount({destroy:n||this.getDestroyCompatibleResult(),clearData:this.getDisposeResult("clear-data"),keepRouteState:this.getDisposeResult("keep-router-state"),unmountcb:i}),delete this.__MICRO_APP_NAME__}handleHiddenKeepAliveApp(n){const i=O.get(this.appName);i&&!i.isUnmounted()&&!i.isHidden()&&i.hiddenKeepAliveApp(n)}handleShowKeepAliveApp(n){te(()=>{var i;return n.showKeepAliveApp((i=this.shadowRoot)!==null&&i!==void 0?i:this)})}getDisposeResult(n){return(this.compatibleProperties(n)||!!v.options[n])&&this.compatibleDisableProperties(n)}compatibleProperties(n){return n==="disable-scopecss"?this.hasAttribute("disable-scopecss")||this.hasAttribute("disableScopecss"):n==="disable-sandbox"?this.hasAttribute("disable-sandbox")||this.hasAttribute("disableSandbox"):this.hasAttribute(n)}compatibleDisableProperties(n){return n==="disable-scopecss"?this.getAttribute("disable-scopecss")!=="false"&&this.getAttribute("disableScopecss")!=="false":n==="disable-sandbox"?this.getAttribute("disable-sandbox")!=="false"&&this.getAttribute("disableSandbox")!=="false":this.getAttribute(n)!=="false"}useScopecss(){return!(this.getDisposeResult("disable-scopecss")||this.getDisposeResult("shadowDOM"))}useSandbox(){return!this.getDisposeResult("disable-sandbox")}sameCoreOptions(n){return n.scopecss===this.useScopecss()&&n.useSandbox===this.useSandbox()&&n.iframe===this.getDisposeResult("iframe")}getBaseRouteCompatible(){var n,i;return(i=(n=this.getAttribute("baseroute"))!==null&&n!==void 0?n:this.getAttribute("baseurl"))!==null&&i!==void 0?i:""}getDestroyCompatibleResult(){return this.getDisposeResult("destroy")||this.getDisposeResult("destory")}getKeepAliveModeResult(){return this.getDisposeResult("keep-alive")&&!this.getDestroyCompatibleResult()}updateSsrUrl(n){if(this.getDisposeResult("ssr"))if(this.getDisposeResult("disable-memory-router")||this.getDisposeResult("disableSandbox")){const i=l.rawWindow.location;this.ssrUrl=z(i.pathname+i.search,n)}else{let i=zi(this.appName,n);const o=this.getDefaultPage();if(!i&&o){const s=W(o,n);i=s.origin+s.pathname+s.search}this.ssrUrl=i}else this.ssrUrl&&(this.ssrUrl="")}getDefaultPage(){return ze.getDefaultPage(this.appName)||this.getAttribute("default-page")||this.getAttribute("defaultPage")||""}getMemoryRouterMode(){return en(this.getAttribute("router-mode"),this.compatibleProperties("disable-memory-router")&&this.compatibleDisableProperties("disable-memory-router"))}setAttribute(n,i){if(n==="data")if(U(i)){const o={};Object.getOwnPropertyNames(i).forEach(s=>{B(s)&&s.indexOf("__")===0||(o[s]=i[s])}),this.data=o}else i!=="[object Object]"&&ge("property data must be an object",this.appName);else l.rawSetAttribute.call(this,n,i)}getRouterEventDelay(){let n=parseInt(this.getAttribute("router-event-delay"));return isNaN(n)&&(n=parseInt(R(v.options["router-event-delay"])?v.options["router-event-delay"](this.appName):v.options["router-event-delay"])),isNaN(n)?0:n}set data(n){this.appName?v.setData(this.appName,n):this.cacheData=n}get data(){return this.appName?v.getData(this.appName,!0):this.cacheData?this.cacheData:null}set appName(n){n!==this._appName&&(v.changeEventAppName(n,this._appName),this._appName=n)}get appName(){return this._appName}get publicPath(){return lt(this.appUrl)}get baseRoute(){return this.getBaseRouteCompatible()}}window.customElements.define(t,e)}function fr(t,e){if(!st)return I("preFetch is only supported in browser environment");ht(()=>{const r=wt(e)?e:v.options.prefetchDelay;setTimeout(()=>{Hs(t)},wt(r)?r:3e3)})}function Hs(t){R(t)&&(t=t()),le(t)&&t.reduce((e,r)=>e.then(()=>js(r)),Promise.resolve())}function js(t){return br(e=>{var r,n,i,o,s,a;if(U(t)&&navigator.onLine)if(t.name=$(t.name),t.url=bt(t.url,t.name),t.name&&t.url&&!O.has(t.name)){const c=new un({name:t.name,url:t.url,isPrefetch:!0,scopecss:!((n=(r=t["disable-scopecss"])!==null&&r!==void 0?r:t.disableScopecss)!==null&&n!==void 0?n:v.options["disable-scopecss"]),useSandbox:!((o=(i=t["disable-sandbox"])!==null&&i!==void 0?i:t.disableSandbox)!==null&&o!==void 0?o:v.options["disable-sandbox"]),inline:(s=t.inline)!==null&&s!==void 0?s:v.options.inline,iframe:(a=t.iframe)!==null&&a!==void 0?a:v.options.iframe,prefetchLevel:t.level&&ir.includes(t.level)?t.level:v.options.prefetchLevel&&ir.includes(v.options.prefetchLevel)?v.options.prefetchLevel:2}),u=c.onLoad,d=c.onLoadError;c.onLoad=b=>{c.isPrerender&&k(b,{defaultPage:t["default-page"],routerMode:en(t["router-mode"]),baseroute:t.baseroute,disablePatchRequest:t["disable-patch-request"]}),e(),u.call(c,b)},c.onLoadError=(...b)=>{e(),d.call(c,...b)}}else e();else e()})}function $s(t){U(t)&&ht(()=>{pr(t.js,"js",J.script),pr(t.css,"css",J.link)})}function pr(t,e,r){if(le(t)){const n=t.filter(o=>B(o)&&Ar(o,e)&&!r.hasInfo(o)),i=n.map(o=>Ae(o));ut(i,o=>{const s=n[o.index];e==="js"?r.hasInfo(s)||r.setInfo(s,{code:o.data,isExternal:!1,appSpace:{}}):r.hasInfo(s)||r.setInfo(s,{code:o.data,appSpace:{}})},o=>{I(o)})}}function Oe({excludeHiddenApp:t=!1,excludePreRender:e=!1}={}){const r=[];return O.forEach((n,i)=>{!n.isUnmounted()&&(!n.isPrefetch||n.isPrerender&&!e)&&(!t||!n.isHidden())&&r.push(i)}),r}function Gs(){return Array.from(O.keys())}function vn(t,e){const r=O.get($(t));return new Promise(n=>{if(r)if(r.isUnmounted()||r.isPrefetch)r.isPrerender?r.unmount({destroy:!!e?.destroy,clearData:!!e?.clearData,keepRouteState:!1,unmountcb:n.bind(null,!0)}):(e?.destroy&&r.actionsForCompletelyDestroy(),n(!0));else if(r.isHidden())e?.destroy?r.unmount({destroy:!0,clearData:!0,keepRouteState:!0,unmountcb:n.bind(null,!0)}):e?.clearAliveState?r.unmount({destroy:!1,clearData:!!e.clearData,keepRouteState:!0,unmountcb:n.bind(null,!0)}):n(!0);else{const i=de(r.container),o=()=>{i.removeEventListener(N.UNMOUNT,o),i.removeEventListener(N.AFTERHIDDEN,s),n(!0)},s=()=>{i.removeEventListener(N.UNMOUNT,o),i.removeEventListener(N.AFTERHIDDEN,s),n(!0)};if(i.addEventListener(N.UNMOUNT,o),i.addEventListener(N.AFTERHIDDEN,s),e?.destroy){let a,c;i.hasAttribute("destroy")&&(a=i.getAttribute("destroy")),i.hasAttribute("destory")&&(c=i.getAttribute("destory")),i.setAttribute("destroy","true"),i.parentNode.removeChild(i),i.removeAttribute("destroy"),B(a)&&i.setAttribute("destroy",a),B(c)&&i.setAttribute("destory",c)}else if(e?.clearAliveState&&i.hasAttribute("keep-alive")){const a=i.getAttribute("keep-alive");i.removeAttribute("keep-alive");let c=null;e.clearData&&(c=i.getAttribute("clear-data"),i.setAttribute("clear-data","true")),i.parentNode.removeChild(i),i.setAttribute("keep-alive",a),B(c)&&i.setAttribute("clear-data",c)}else{let a=null;e?.clearData&&(a=i.getAttribute("clear-data"),i.setAttribute("clear-data","true")),i.parentNode.removeChild(i),B(a)&&i.setAttribute("clear-data",a)}}else ge(`app ${t} does not exist when unmountApp`),n(!1)})}function qs(t){return Array.from(O.keys()).reduce((e,r)=>e.then(()=>vn(r,t)),Promise.resolve(!0))}function Ks(t,e){return new Promise(r=>{const n=O.get($(t));if(n){const i=n.container&&de(n.container);if(i){const o=v.getData(t);n.isReloading=!0,i.reload(e).then(()=>{o&&v.setData(t,o),n.isReloading=!1,r(!0)})}else ge(`app ${t} is not rendered, cannot use reload`),r(!1)}else ge(`app ${t} does not exist when reload app`),r(!1)})}function Vs(t){return new Promise(e=>{if(!U(t))return I("renderApp options must be an object");const r=he(t.container)?t.container:B(t.container)?document.querySelector(t.container):null;if(!he(r))return I("Target container is not a DOM element.");const n=Y(v.tagName);for(const a in t)if(a==="onDataChange")R(t[a])&&n.addEventListener("datachange",t[a]);else if(a==="lifeCycles"){const c=t[a];if(U(c))for(const u in c)u.toUpperCase()in N&&R(c[u])&&n.addEventListener(u.toLowerCase(),c[u])}else a!=="container"&&n.setAttribute(a,t[a]);const i=()=>{s(),e(!0)},o=()=>{s(),e(!1)},s=()=>{n.removeEventListener(N.MOUNTED,i),n.removeEventListener(N.ERROR,o)};n.addEventListener(N.MOUNTED,i),n.addEventListener(N.ERROR,o),r.appendChild(n)})}class Qs extends Ii{constructor(){super(...arguments),this.tagName="micro-app",this.hasInit=!1,this.options={},this.router=ze,this.preFetch=fr,this.unmountApp=vn,this.unmountAllApps=qs,this.getActiveApps=Oe,this.getAllApps=Gs,this.reload=Ks,this.renderApp=Vs}start(e){var r,n;if(!st||!window.customElements)return I("micro-app is not supported in this environment");if(this.hasInit)return I("microApp.start executed repeatedly");if(this.hasInit=!0,e?.tagName)if(/^micro-app(-\S+)?/.test(e.tagName))this.tagName=e.tagName;else return I(`${e.tagName} is invalid tagName`);if(Ws(),window.customElements.get(this.tagName))return ge(`element ${this.tagName} is already defined`);if(U(e)&&(this.options=e,e["disable-scopecss"]=(r=e["disable-scopecss"])!==null&&r!==void 0?r:e.disableScopecss,e["disable-sandbox"]=(n=e["disable-sandbox"])!==null&&n!==void 0?n:e.disableSandbox,e.preFetchApps&&fr(e.preFetchApps),e.globalAssets&&$s(e.globalAssets),U(e.plugins))){const i=e.plugins.modules;if(U(i))for(const o in i){const s=$(o);s&&o!==s&&(i[s]=i[o],delete i[o])}}Fs(this.tagName)}}const v=new Qs;async function ta(t){await Un({overrides:Wn});const e=no(so);if(Fn){const{setupMockData:r}=await V(async()=>{const{setupMockData:n}=await import("./index-CeukUAtz.js");return{setupMockData:n}},__vite__mapDeps([66,1,2,3]));r()}v.start({tagName:Et.powerByMicro?`micro-app-${Et.baseRoute.slice(1).toLowerCase()}`:"micro-app","disable-memory-router":!0,"disable-patch-request":!0,"router-mode":"native",iframeSrc:`${window.origin}/empty.html`,fetch:(r,n)=>{const i={};return window.fetch(r,Object.assign({},n,i)).then(o=>o.text())}}),Hn(e,{level:Kn,name:mr}),await oo(e),io(e),wo(e),e.mount("#app"),gt.info("namespace",t),jn(()=>{if(ae.app.dynamicTitle){const r=Dt.currentRoute.value.meta?.title,n=(r?`${$n(r)} - `:"")+ae.app.name;Gn(n)}}),qn(()=>ae.theme,r=>{v.setGlobalData({theme:r})})}export{ta as bootstrap};
