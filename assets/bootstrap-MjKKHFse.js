const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-MegHhVOP.js","assets/basic-CPM4wVnD.js","assets/index-D77qaaIQ.js","assets/basic-Czn6p6qK.css","assets/nprogress-C9ORJt3i.js","assets/avatar-v1-C1U5khp6.js","assets/useBreakpoint-iyB_bJn5.js","assets/Col-Crd_63hy.js","assets/collapseMotion-D81sf5BM.js","assets/isEqual-D8RX5zC9.js","assets/eagerComputed-CzfEF8Eq.js","assets/index-7LGI4Mi3.js","assets/index-DizqmUoF.js","assets/isMobile--2fOlCHx.js","assets/FormItemContext-DqmqT0xJ.js","assets/RightOutlined-DtM4rsYo.js","assets/index-B2exmz-C.js","assets/index-D-DFqThU.js","assets/load-Cid7k41C.js","assets/index-CKKTMjA-.js","assets/index-Cpa2GvYs.css","assets/plugin-vueexport-helper-DlAUqK2U.js","assets/logo_small-CoXXjsbk.js","assets/index-DAJI2ac1.js","assets/logo_small-DssciU_K.css","assets/index-fZAKpaHJ.js","assets/Group-CaV79xXU.js","assets/index-Cr4p7ZG1.js","assets/index-DRSJxV2L.js","assets/index-lEb1Cqdg.js","assets/index-t8TXmIt_.js","assets/hasIn-DFaD-83u.js","assets/index-BxHp5EHN.js","assets/index-nyqA2aKy.css","assets/index-DpC56Y8C.js","assets/index-BjcFJRiz.js","assets/pick--rJQhiZE.js","assets/index-x2zga167.js","assets/auth-title-BnibW4c4.js","assets/auth-title-DH9anRsb.css","assets/regexp-BZOQi8XT.js","assets/index-IzKgL03k.js","assets/index-BD7neIgw.js","assets/index-CfuyIIDG.js","assets/index-BKloQzsv.css","assets/index-DxENgP6b.js","assets/index-DTGmv3Ai.js","assets/ReloadOutlined-D6erQFx1.js","assets/index-CQ9v-vL8.css","assets/index-rVTURbcj.js","assets/index-cr6a5sRF.css","assets/index-D2vXLUV1.js","assets/index-134EVtWD.js","assets/index-B5Z9qTI8.css","assets/index-m6bUSLHP.js","assets/index-DuhP3ki4.js","assets/LeftOutlined-DQZVGWL2.js","assets/index-DigSeygf.js","assets/index-DHbd6paj.css","assets/index-MlizHpQb.js","assets/index-C6ZnEVBk.js","assets/index-DkwsiK4l.js","assets/index-Ap8PkAnQ.js","assets/index-TPruDv9A.js","assets/forbidden--WtUIg7Z.js","assets/not-found-CXrmLPWq.js","assets/index-BK-4Of0r.js"])))=>i.map(i=>d[i]);
import{_ as V,i as Ln,a as Tn,d as fr,h as pr,l as gt,b as xn,p as ae,c as Et,V as Nn,e as Kt,f as Bn,o as Un,g as Wn,s as Fn,w as Hn,$ as jn,u as $n,j as Gn,k as qn,m as Kn}from"./index-D77qaaIQ.js";import{c as Vn,m as mr,t as Qn,n as _r,f as Xn,u as zn,a as Yn,L as Ye,r as Jn,b as Zn,d as kn,e as eo,g as to,h as ro,i as no,s as oo,j as io,_ as so}from"./basic-CPM4wVnD.js";import{s as ao,a as co}from"./nprogress-C9ORJt3i.js";import{p as Vt}from"./pick--rJQhiZE.js";import"./hasIn-DFaD-83u.js";function Qt(t){const e={};if(Object.keys(t||{}).forEach(r=>{t[r]!==void 0&&(e[r]=t[r])}),!(Object.keys(e).length<1))return e}function lo(t,e){const r=Object.assign({},t);for(let n=0;n<e.length;n+=1){const o=e[n];delete r[o]}return r}const uo=()=>V(()=>import("./index-MegHhVOP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33])),ho=["activeIcon","activePath","affixTab","affixTabOrder","hideChildrenInMenu","hideInBreadcrumb","hideInMenu","hideInTab","icon","iframeSrc","microUrl","componentPath","appName","ignoreAccess","keepAlive","link","loaded","maxNumOfOpenTab","menuVisibleWithForbidden","noBasicLayout","openInNewWindow","order","query","title"];function fo(t,e,r,n){const o=[];return mr(t,i=>{const s=i,a=e[s.path],{component:c,name:u,microUrl:d,iframeSrc:A}=i;if(A||d)s.microUrl&&(s.path=`/${s.appName}${s.path}`,s.redirect=s.redirect?`/${s.appName}${s.redirect}`:void 0,s.meta={componentPath:s.component}),s.children?.length||(s.component=async()=>fr({name:s.name,setup(){let P=d;return P&&d.endsWith("/")&&(P=P.slice(0,-1)),()=>pr("div",P?`MicroAppPage:${P}${s.path}`:`IframePage:${A}`)}}));else if(c&&r[c])s.component=r[c];else if(c){const P=_r(c),w=P.endsWith(".vue")?P:`${P}.vue`;n[w]?s.component=n[w]:(gt.error(`route component is invalid: ${w}`,s),s.component=n["/fallback/not-found.vue"])}else!s.children?.filter(w=>!w?.hideInMenu).length&&!xn(s.path)&&(a?.component?s.component=a?.component:gt.error("the routing configuration does not exist",s));const b=i.hideChildrenInMenu?[]:i.children??[],M=Vt(s,ho),D=Qt({...a?.meta??{},...s.meta??{},...M});b.length>0&&b.forEach(P=>{const w={name:i.name,path:i.path,meta:D};P.parents=[...i.parents??[],w],P.parent=w}),s.meta=Qt({...D,parent:i.parent,parents:i.parents}),s.redirect=s.redirect||a?.redirect;const g=Vt(s,["component","children","redirect","props","path","alias","name","meta"]);return g.component&&o.push(lo(g,["children"])),g}),o}function po(t){const e={};return Xn(t,r=>{e[r.path]=r}),e}async function mo(t){const{menus:e=[],layoutMap:r={},pageMap:n={},routes:o=[]}=t,i=Qn(e);try{if(!e?.length)return[];const s={};for(const[u,d]of Object.entries(n))s[_r(u)]=d;const a=po(o);return fo(i,a,r,s)}catch(s){throw s}}const _o=async t=>{let e=await mo(t);return e=mr(e,r=>{if(r.meta?.keepAlive&&Ln(r.component)&&r.name&&Tn(r.name)){const i=r.component;r.component=async()=>{const s=await i();return s.default?fr({name:r.name,setup(a,{attrs:c,slots:u}){return()=>pr(s.default,{...a,...c},u)}}):s}}const n=r.children?.filter(i=>!i.meta?.hideInMenu);if(r.redirect||!n||n.length===0)return r;const o=r.children?.[0];return!o?.path||!o.path.startsWith("/")||(r.redirect=o.path),r}),e},vo=async t=>{const{router:e}=t;t.routes=Vn(t.routes);const r=await _o(t),n=e.getRoutes().find(i=>i.path==="/"),o=n?.children?.map(i=>i.name)??[];r.forEach(i=>{if(n&&!i.meta?.noBasicLayout)if(o?.includes(i.name)){const s=n.children?.findIndex(a=>a.name===i.name);s!==void 0&&s!==-1&&n.children&&(n.children[s]=i)}else n.children?.push(i);else e.addRoute(i)}),n&&(n.name&&e.removeRoute(n.name),e.addRoute(n))},go=async t=>await vo({...t,layoutMap:{BasicLayout:uo},pageMap:Object.assign({"../views/about/index.vue":()=>V(()=>import("./index-DpC56Y8C.js"),__vite__mapDeps([34,1,2,3,35,12,8,9,36,31,13])),"../views/authentication/code-login/index.vue":()=>V(()=>import("./index-x2zga167.js"),__vite__mapDeps([37,38,21,2,39,40,1,3,30,7,9,31,8,14,27,11])),"../views/authentication/forget-password/index.vue":()=>V(()=>import("./index-IzKgL03k.js"),__vite__mapDeps([41,38,21,2,39,1,3,40,30,7,9,31,8,14,27,11])),"../views/authentication/login/index.vue":()=>V(()=>import("./index-BD7neIgw.js"),__vite__mapDeps([42,38,21,2,39,1,3,30,7,9,31,8,14,27,11,43,26,17,18,44])),"../views/authentication/qrcode-login/index.vue":()=>V(()=>import("./index-DxENgP6b.js"),__vite__mapDeps([45,38,21,2,39,1,3,46,47,48])),"../views/authentication/register/index.vue":()=>V(()=>import("./index-rVTURbcj.js"),__vite__mapDeps([49,38,21,2,39,1,3,30,7,9,31,8,14,27,11,43,26,50])),"../views/dashboard/analytics/index.vue":()=>V(()=>import("./index-D2vXLUV1.js"),__vite__mapDeps([51,18,2,19,1,3,16,20,35,12,8,9,36,31,13,52,7,21,53])),"../views/dashboard/workspace/index.vue":()=>V(()=>import("./index-m6bUSLHP.js"),__vite__mapDeps([54,1,2,3,5,6,7,8,9,10,11,12,13,14,15,19,18,16,20,35,36,31,21,46,55,56,43,26,57,52,58])),"../views/demos/form/index.vue":()=>V(()=>import("./index-MlizHpQb.js"),__vite__mapDeps([59,1,2,3,23,12,8,9,15,16,60,28,36,31,52,7,57,30,14,46,6,35,13])),"../views/demos/index.vue":()=>V(()=>import("./index-DkwsiK4l.js"),__vite__mapDeps([61,21,2])),"../views/demos/table/index.vue":()=>V(()=>import("./index-Ap8PkAnQ.js"),__vite__mapDeps([62,2,23,1,3,12,8,9,15,60,28,36,31,52,7,57,30,14,46,6,35,13,29,32,55,56,10,11,27,63,26,43,47])),"../views/fallback/forbidden.vue":()=>V(()=>import("./forbidden--WtUIg7Z.js"),__vite__mapDeps([64,19,2,18,1,3,16,20])),"../views/fallback/not-found.vue":()=>V(()=>import("./not-found-CXrmLPWq.js"),__vite__mapDeps([65,19,2,18,1,3,16,20]))})}),Eo=t=>{const e=new Set;t.beforeEach(r=>(r.meta.loaded=e.has(r.path),!r.meta.loaded&&ae.transition.progress&&ao(),!0)),t.afterEach(r=>{e.add(r.path),ae.transition.progress&&co()})},wo=t=>{t.beforeEach(async(e,r)=>{if(Et.powerByMicro)return!0;const n=zn();if(Yn.includes(e.name))return e.path===Ye&&n.accessToken?decodeURIComponent(e.query?.redirect||n.userInfo?.homePath||ae.app.defaultHomePath):!0;if(!n.accessToken){if(e.meta.ignoreAccess)return!0;if(e.fullPath!==Ye)return{path:Ye,query:e.fullPath===ae.app.defaultHomePath?{}:{redirect:encodeURIComponent(e.fullPath)},replace:!0}}if(n.isAccessChecked)return!0;const o=n.userInfo||await n.fetchUserInfo();if(!o)return Jn(),{path:Ye,query:e.fullPath===ae.app.defaultHomePath?{}:{redirect:encodeURIComponent(e.fullPath)},replace:!0};const i=n.originMenus?.length?n.originMenus:await n.fetchAccessMenus();await go({router:t,menus:i,routes:Zn}),n.setAccessMenus(i),n.setIsAccessChecked(!0);const s=r.query.redirect??(e.path===ae.app.defaultHomePath?o.homePath||ae.app.defaultHomePath:e.fullPath);return{...t.resolve(decodeURIComponent(s)),replace:!0}})};function Ao(t){Eo(t),wo(t)}const Dt=kn({history:Nn==="hash"?eo(Kt):to(Kt),routes:ro,scrollBehavior:(t,e,r)=>r||(t.hash?{behavior:"smooth",el:t.hash}:{left:0,top:0})}),bo=t=>{t.use(Dt)};Ao(Dt);const Po="1.0.0-rc.26",st=typeof window<"u",vr=typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:Function("return this")(),Ro=()=>!1,le=Array.isArray,k=Object.assign,H=Object.defineProperty,ee=Object.defineProperties,So=Object.prototype.toString,we=Object.prototype.hasOwnProperty,K=t=>So.call(t);function ve(t){return t===void 0}function Ue(t){return t===null}function B(t){return typeof t=="string"}function gr(t){return typeof t=="boolean"}function wt(t){return typeof t=="number"}function S(t){return typeof t=="function"}function U(t){return K(t)==="[object Object]"}function yo(t){return!Ue(t)&&typeof t=="object"}function At(t){return K(t)==="[object Promise]"}function Mo(t){var e;return S(t)&&((e=t.name)===null||e===void 0?void 0:e.indexOf("bound "))===0&&!t.hasOwnProperty("prototype")}function at(t){var e;if(S(t)){const r=t.toString();return((e=t.prototype)===null||e===void 0?void 0:e.constructor)===t&&Object.getOwnPropertyNames(t.prototype).length>1||/^function\s+[A-Z]/.test(r)||/^class\s+/.test(r)}return!1}function Oo(t){return typeof ShadowRoot<"u"&&t instanceof ShadowRoot}function ct(t){var e;return t instanceof URL||!!(!((e=t)===null||e===void 0)&&e.href)}function he(t){var e;return t instanceof Element||B((e=t)===null||e===void 0?void 0:e.tagName)}function De(t){var e;return t instanceof Node||wt((e=t)===null||e===void 0?void 0:e.nodeType)}function Do(t){return K(t)==="[object HTMLAnchorElement]"}function Co(t){return K(t)==="[object HTMLAudioElement]"}function Io(t){return K(t)==="[object HTMLVideoElement]"}function Lo(t){return K(t)==="[object HTMLLinkElement]"}function To(t){return K(t)==="[object HTMLBodyElement]"}function Er(t){return K(t)==="[object HTMLStyleElement]"}function Se(t){return K(t)==="[object HTMLScriptElement]"}function xo(t){return K(t)==="[object HTMLDivElement]"}function No(t){return K(t)==="[object HTMLImageElement]"}function Bo(t){return K(t)==="[object HTMLBaseElement]"}function ke(t){return K(t)==="[object DocumentFragment]"}function Uo(t){return K(t)==="[object ShadowRoot]"}function et(t){return he(t)&&t.tagName.toUpperCase()==="MICRO-APP-BODY"}function Wo(t){return he(t)&&t.tagName.toUpperCase()==="MICRO-APP-HEAD"}function Fo(t){let e=K(t)==="[object HTMLElement]";if(e){const r=t.tagName.toUpperCase();e=e&&!r.startsWith("MICRO-APP")}return e}function Ho(t){return K(t)==="[object ProxyDocument]"}function wr(t,e){try{return W(t).pathname.split(".").pop()===e}catch{return!1}}function ne(t,e,r){if(t==null)throw new TypeError("includes target is null or undefined");const n=Object(t),o=parseInt(n.length,10)||0;if(o===0)return!1;r=parseInt(r,10)||0;let i=Math.max(r>=0?r:o+r,0);for(;i<o;){if(e===n[i]||e!==e&&n[i]!==n[i])return!0;i++}return!1}function I(t,e=null,...r){const n=e&&B(e)?` app ${e}:`:"";B(t)}function ge(t,e=null,...r){const n=e&&B(e)?` app ${e}:`:"";B(t)}function te(t,...e){Promise.resolve().then(t.bind(null,...e))}function jo(t,e=0,...r){setTimeout(t.bind(null,...r),e)}const W=(function(){class t extends URL{}return(e,r)=>r?new t(""+e,r):new t(""+e)})();function Ct(t){return t.startsWith("//")?`${vr.location.protocol}${t}`:t}function bt(t,e=null){if(!B(t)||!t)return"";try{const{origin:r,pathname:n,search:o}=W(Ct(t),(window.rawWindow||window).location.href),i=`${r}${n}${o}`;return/^https?:\/\//.test(i)?i:""}catch(r){return I(r,e),""}}function $(t){return!B(t)||!t?"":t.replace(/(^\d+)|([^\w\d-_])/gi,"")}function lt(t){const{origin:e,pathname:r}=W(t);if(/\.(\w+)$/.test(r)){const n=`${e}${r}`.split("/");return n.pop(),n.join("/")+"/"}return`${e}${r}/`.replace(/\/\/$/,"/")}function z(t,e){return!t||/^((((ht|f)tps?)|file):)?\/\//.test(t)||/^(data|blob):/.test(t)?t:W(t,lt(Ct(e))).toString()}function $o(t){const e=t.split("/");return e.pop(),Ct(e.join("/")+"/")}function ut(t,e,r,n){let o=0;function i(){++o===t.length&&n&&n()}t.forEach((s,a)=>{At(s)?s.then(c=>{e({data:c,index:a}),i()}).catch(c=>{r({error:c,index:a}),i()}):(e({data:s,index:a}),i())})}function Go(){return"noModule"in document.createElement("script")}function qo(){return"inline-"+Math.random().toString(36).substr(2,15)}function Ko(t){return t.filter(function(e){return e in this?!1:this[e]=!0},Object.create(null))}const ht=vr.requestIdleCallback||function(t){const e=Date.now();return setTimeout(function(){t({didTimeout:!1,timeRemaining(){return Math.max(0,50-(Date.now()-e))}})},1)};function Ar(t){return new Promise(e=>{ht(()=>{t(e)})})}let It=null;function Pt(t){It=t}function Q(){return It}function We(t){It!==t&&!xt()&&(Pt(t),te(()=>{Pt(null)}))}let Lt=null;function Rt(t){Lt=t}function Je(){return Lt}function Tt(t){Lt!==t&&!xt()&&(Rt(t),te(()=>{Rt(null)}))}let Te=!1;function xt(){return Te}function G(t){t!==!1?(Pt(null),Rt(null),t&&!Te&&(Te=!0,te(()=>{Te=!1}))):Te=!1}function Y(t,e){const r=(window.rawDocument||document).createElement(t,e);return r.__MICRO_APP_NAME__&&delete r.__MICRO_APP_NAME__,r.__PURE_ELEMENT__=!0,r}function pe(t){return!t||/(^\d)|([^\w\d-_\u4e00-\u9fa5])/gi.test(t)}function ye(t){return/^body$/i.test(t)||/^head$/i.test(t)||/^html$/i.test(t)||/^title$/i.test(t)||/^:root$/i.test(t)}function de(t){return Oo(t)?t.host:t}function vt(t){return t?t.replace(/^\s+|\s+$/g,""):""}function Xt(){return navigator.userAgent.indexOf("Firefox")>-1}function zt(t){const e={},r=t.split("&");for(const n of r){const o=n.indexOf("="),i=o<0?n:n.slice(0,o),s=o<0?null:n.slice(o+1);if(i in e){let a=e[i];le(a)||(a=e[i]=[a]),a.push(s)}else e[i]=s}return e}function tt(t){let e="";for(const r in t){const n=t[r];Ue(n)?e+=(e.length?"&":"")+r:(le(n)?n:[n]).forEach(i=>{ve(i)||(e+=(e.length?"&":"")+r,Ue(i)||(e+="="+i))})}return e}function Yt(){const t=new Set;function e(r){return t.add(r),()=>t.has(r)?t.delete(r):!1}return{add:e,list:()=>t}}function Vo(){const t=new Map;function e(r,n){return t.set(r,n),()=>t.has(r)?t.delete(r):!1}return{add:e,get:r=>t.get(r),delete:r=>t.has(r)?t.delete(r):!1}}function St(t){const e=t.attributes,r=new Map;for(let n=0;n<e.length;n++)r.set(e[n].name,e[n].value);return r}function Fe(t,e){t?t.push(()=>Ar(r=>{e(),r()})):e()}function He(t){return t?.reduce((e,r)=>e.then(r),Promise.resolve())||null}function je(t){return t.startsWith("inline-")}function Jt(t,e,r,...n){try{S(t)&&t(...n)}catch(o){I(`An error occurred in app ${e} window.${r} 
`,null,o)}}function Qo(t){for(;t?.firstChild;)t.removeChild(t.firstChild)}function Zt(t,e){if(t==null)return!1;if(S(e)){if(typeof t=="number"||typeof t=="string"||typeof t=="boolean")return!1}else throw new TypeError("Right-hand side of 'instanceof' is not callable");let r=Object.getPrototypeOf(t);for(;r;){if(r===e.prototype)return!0;r=Object.getPrototypeOf(r)}return!1}const Xo=["mounted","unmount"];function yt(t,e){return Xo.includes(t)?`${t}-${e}`:t}function zo(t){return U(t)?!Object.keys(t).length:!0}function Yo(t,e){Object.defineProperties(t,{currentTarget:{get(){return e}},target:{get(){return e}}})}function fe(t,e,r,n){var o;if(!t)return ge(`element does not exist in lifecycle ${r}`,e);t=de(t),G();const i=k({name:e,container:t},n&&{error:n}),s=new CustomEvent(r,{detail:i});Yo(s,t),S((o=_.options.lifeCycles)===null||o===void 0?void 0:o[r])&&_.options.lifeCycles[r](s,e),t.dispatchEvent(s)}function se(t,e,r={}){var n;const o=new CustomEvent(yt(e,t.name),{detail:r});(n=t.sandBox)===null||n===void 0||n.microAppWindow.dispatchEvent(o)}function Ae(t,e=null,r={}){return G(),S(_.options.fetch)?_.options.fetch(t,r,e):window.fetch(t,r).then(n=>n.text())}class Nt{static getInstance(){return this.instance||(this.instance=new Nt),this.instance}run(e,r){const n=e.name,o=e.ssrUrl||e.url;(wr(o,"js")?Promise.resolve(`<micro-app-head><script src='${o}'><\/script></micro-app-head><micro-app-body></micro-app-body>`):Ae(o,n,{cache:"no-cache"})).then(a=>{if(!a){const c="html is empty, please check in detail";return e.onerror(new Error(c)),I(c,n)}a=this.formatHTML(o,a,n),r(a,e)}).catch(a=>{I(`Failed to fetch data from ${e.url}, micro-app stop rendering`,n,a),e.onLoadError(a)})}formatHTML(e,r,n){return this.processHtml(e,r,n,_.options.plugins).replace(/<head[^>]*>[\s\S]*?<\/head>/i,o=>o.replace(/<head/i,"<micro-app-head").replace(/<\/head>/i,"</micro-app-head>")).replace(/<body[^>]*>[\s\S]*?<\/body>/i,o=>o.replace(/<body/i,"<micro-app-body").replace(/<\/body>/i,"</micro-app-body>"))}processHtml(e,r,n,o){var i;if(!o)return r;const s=[];return o.global&&s.push(...o.global),!((i=o.modules)===null||i===void 0)&&i[n]&&s.push(...o.modules[n]),s.length>0?s.reduce((a,c)=>U(c)&&S(c.processHtml)?c.processHtml(a,e):a,r):r}}const Jo=/(^|\s+)(html|:root)(?=[\s>~[.#:]+|$)/,kt=/(^|\s+)((html[\s>~]+body)|body)(?=[\s>~[.#:]+|$)/;function Zo(t,e){t=e?`${e} ${t}`:t;const r=new Error(t);throw r.reason=t,e&&(r.filename=e),r}class ko{constructor(){this.cssText="",this.prefix="",this.baseURI="",this.linkPath="",this.result="",this.scopecssDisable=!1,this.scopecssDisableSelectors=[],this.scopecssDisableNextLine=!1,this.mediaRule=this.createMatcherForRuleWithChildRule(/^@media *([^{]+)/,"@media"),this.supportsRule=this.createMatcherForRuleWithChildRule(/^@supports *([^{]+)/,"@supports"),this.documentRule=this.createMatcherForRuleWithChildRule(/^@([-\w]+)?document *([^{]+)/,"@document"),this.hostRule=this.createMatcherForRuleWithChildRule(/^@host\s*/,"@host"),this.importRule=this.createMatcherForNoneBraceAtRule("import"),this.charsetRule=this.createMatcherForNoneBraceAtRule("charset"),this.namespaceRule=this.createMatcherForNoneBraceAtRule("namespace"),this.containerRule=this.createMatcherForRuleWithChildRule(/^@container *([^{]+)/,"@container")}exec(e,r,n,o){return this.cssText=e,this.prefix=r,this.baseURI=n,this.linkPath=o||"",this.matchRules(),Xt()?decodeURIComponent(this.result):this.result}reset(){this.cssText=this.prefix=this.baseURI=this.linkPath=this.result="",this.scopecssDisable=this.scopecssDisableNextLine=!1,this.scopecssDisableSelectors=[]}matchRules(){for(this.matchLeadingSpaces(),this.matchComments();this.cssText.length&&this.cssText.charAt(0)!=="}"&&(this.matchAtRule()||this.matchStyleRule());)this.matchComments()}matchStyleRule(){const e=this.formatSelector(!0);return this.scopecssDisableNextLine=!1,e?(this.recordResult(e),this.matchComments(),this.styleDeclarations(),this.matchLeadingSpaces(),!0):this.printError("selector missing",this.linkPath)}formatSelector(e){const r=this.commonMatch(/^[^{]+/,e);if(!r)return!1;const n={};return r[0].replace(/\[([^\]=]+)(?:=([^\]]+))?\]/g,(i,s,a,c)=>{const u=`__mock_${s}_${c}Value__`;return n[u]=a,i.replace(a,u)}).replace(/(^|,[\n\s]*)([^,]+)/g,(i,s,a)=>(a=vt(a),a=a.replace(/\[[^\]=]+(?:=([^\]]+))?\]/g,(c,u)=>n[u]?c.replace(u,n[u]):c),a&&!(this.scopecssDisableNextLine||this.scopecssDisable&&(!this.scopecssDisableSelectors.length||this.scopecssDisableSelectors.includes(a))||Jo.test(a))&&(kt.test(a)?a=a.replace(kt,this.prefix+" micro-app-body"):a=this.prefix+" "+a),s+a))}styleDeclarations(){return this.matchOpenBrace()?(this.matchAllDeclarations(),this.matchCloseBrace()?!0:this.printError("Declaration missing '}'",this.linkPath)):this.printError("Declaration missing '{'",this.linkPath)}matchAllDeclarations(e=0){let r=this.commonMatch(/^(?:url\(["']?(?:[^)"'}]+)["']?\)|[^{}/])*/,!0)[0];if(r&&(!this.scopecssDisableNextLine&&(!this.scopecssDisable||this.scopecssDisableSelectors.length)&&(r=r.replace(/url\((["']?)(.*?)\1\)/gm,(n,o,i)=>/^((data|blob):|#|%23)/.test(i)||/^(https?:)?\/\//.test(i)?n:(/^((\.\.?\/)|[^/])/.test(i)&&this.linkPath&&(this.baseURI=$o(this.linkPath)),`url("${z(i,this.baseURI)}")`))),this.recordResult(r)),this.scopecssDisableNextLine=!1,!!this.cssText.length){if(this.cssText.charAt(0)==="/")this.cssText.charAt(1)==="*"?this.matchComments():this.commonMatch(/\/+/);else if(this.cssText.charAt(0)==="{")this.matchOpenBrace(),e++;else if(this.cssText.charAt(0)==="}"){if(e<1)return;this.matchCloseBrace(),e--}return this.matchAllDeclarations(e)}}matchAtRule(){return this.cssText[0]!=="@"?!1:(this.scopecssDisableNextLine=!1,this.keyframesRule()||this.mediaRule()||this.customMediaRule()||this.supportsRule()||this.importRule()||this.charsetRule()||this.namespaceRule()||this.containerRule()||this.documentRule()||this.pageRule()||this.hostRule()||this.fontFaceRule()||this.layerRule())}keyframesRule(){if(!this.commonMatch(/^@([-\w]+)?keyframes\s*/))return!1;if(!this.commonMatch(/^[^{]+/))return this.printError("@keyframes missing name",this.linkPath);if(this.matchComments(),!this.matchOpenBrace())return this.printError("@keyframes missing '{'",this.linkPath);for(this.matchComments();this.keyframeRule();)this.matchComments();return this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):this.printError("@keyframes missing '}'",this.linkPath)}keyframeRule(){let e;const r=[];for(;e=this.commonMatch(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)r.push(e[1]),this.commonMatch(/^,\s*/);return r.length?(this.styleDeclarations(),this.matchLeadingSpaces(),!0):!1}customMediaRule(){return this.commonMatch(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/)?(this.matchLeadingSpaces(),!0):!1}pageRule(){return this.commonMatch(/^@page */)?(this.formatSelector(!1),this.scopecssDisableNextLine=!1,this.commonHandlerForAtRuleWithSelfRule("page")):!1}fontFaceRule(){return this.commonMatch(/^@font-face\s*/)?this.commonHandlerForAtRuleWithSelfRule("font-face"):!1}layerRule(){return this.commonMatch(/^@layer\s*([^{;]+)/)?this.matchOpenBrace()?(this.matchComments(),this.matchRules(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):this.printError("@layer missing '}'",this.linkPath)):!!this.commonMatch(/^[;]+/):!1}createMatcherForRuleWithChildRule(e,r){return()=>this.commonMatch(e)?this.matchOpenBrace()?(this.matchComments(),this.matchRules(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):this.printError(`${r} missing '}'`,this.linkPath)):this.printError(`${r} missing '{'`,this.linkPath):!1}createMatcherForNoneBraceAtRule(e){const r=new RegExp("^@"+e+"\\s*([^;]+);");return()=>this.commonMatch(r)?(this.matchLeadingSpaces(),!0):!1}commonHandlerForAtRuleWithSelfRule(e){return this.matchOpenBrace()?(this.matchAllDeclarations(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):this.printError(`@${e} missing '}'`,this.linkPath)):this.printError(`@${e} missing '{'`,this.linkPath)}matchComments(){for(;this.matchComment(););}matchComment(){if(this.cssText.charAt(0)!=="/"||this.cssText.charAt(1)!=="*")return!1;this.scopecssDisableNextLine=!1;let e=2;for(;this.cssText.charAt(e)!==""&&(this.cssText.charAt(e)!=="*"||this.cssText.charAt(e+1)!=="/");)++e;if(e+=2,this.cssText.charAt(e-1)==="")return this.printError("End of comment missing",this.linkPath);let r=this.cssText.slice(2,e-2);return this.recordResult(`/*${r}*/`),r=vt(r.replace(/^\s*!/,"")),r==="scopecss-disable-next-line"?this.scopecssDisableNextLine=!0:/^scopecss-disable/.test(r)?r==="scopecss-disable"?this.scopecssDisable=!0:(this.scopecssDisable=!0,r.replace("scopecss-disable","").split(",").forEach(o=>{this.scopecssDisableSelectors.push(vt(o))})):r==="scopecss-enable"&&(this.scopecssDisable=!1,this.scopecssDisableSelectors=[]),this.cssText=this.cssText.slice(e),this.matchLeadingSpaces(),!0}commonMatch(e,r=!1){const n=e.exec(this.cssText);if(!n)return;const o=n[0];return this.cssText=this.cssText.slice(o.length),r||this.recordResult(o),n}matchOpenBrace(){return this.commonMatch(/^{\s*/)}matchCloseBrace(){return this.commonMatch(/^}\s*/)}matchLeadingSpaces(){this.commonMatch(/^\s*/)}recordResult(e){Xt()?this.result+=encodeURIComponent(e):this.result+=e}printError(e,r){this.cssText.length&&Zo(e,r)}}function er(t,e,r,n,o){if(!t.__MICRO_APP_HAS_SCOPED__){t.__MICRO_APP_HAS_SCOPED__=!0;let i=null;try{i=xe.exec(t.textContent,r,n,o),xe.reset()}catch(s){xe.reset(),I(`An error occurred while parsing CSS:
`,e,s)}i&&(t.textContent=i)}}let xe;function dt(t,e,r){if(e.scopecss){const n=Bt(e.name);xe||(xe=new ko);const o=i=>i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(t.textContent){er(t,e.name,n,e.url,r);const i=new MutationObserver(()=>{const s=o(n),a=t.textContent&&new RegExp(s).test(t.textContent);i.disconnect(),a||(t.__MICRO_APP_HAS_SCOPED__=!1,dt(t,e,r))});i.observe(t,{childList:!0,characterData:!0})}else{const i=new MutationObserver(function(){i.disconnect(),t.textContent&&!t.hasAttribute("data-styled")&&er(t,e.name,n,e.url,r)});i.observe(t,{childList:!0})}}return t}function Bt(t,e=!1){const r=e?"\\":"";return`${_.tagName}${r}[name=${t}${r}]`}function br(t,e){Object.defineProperties(t,{currentTarget:{get(){return e}},srcElement:{get(){return e}},target:{get(){return e}}})}function Pr(t){const e=new CustomEvent("load");br(e,t),S(t.onload)?t.onload(e):t.dispatchEvent(e)}function Rr(t){const e=new CustomEvent("error");br(e,t),S(t.onerror)?t.onerror(e):t.dispatchEvent(e)}function ei(){const t=new Map,e=new Map;function r(n){return{setInfo(o,i){n.set(o,i)},getInfo(o){var i;return(i=n.get(o))!==null&&i!==void 0?i:null},hasInfo(o){return n.has(o)},deleteInfo(o){return n.delete(o)}}}return{link:r(t),script:Object.assign(Object.assign({},r(e)),{deleteInlineInfo(n){n.forEach(o=>{je(o)&&e.delete(o)})}})}}var J=ei();function ti(t,e,r){const n=r.appSpace;for(const o in n)if(o!==t){const i=n[o];if(i.parsedCode)return i.parsedCode.replace(new RegExp(Bt(o,!0),"g"),e)}}function ri(t,e){e.forEach((r,n)=>{n!=="rel"&&(n==="href"&&(n="data-origin-href"),l.rawSetAttribute.call(t,n,r))})}function Sr(t,e,r,n=!1){const o=t.getAttribute("rel");let i=t.getAttribute("href"),s=null;if(o==="stylesheet"&&i){i=z(i,r.url);let a=J.link.getInfo(i);const c={attrs:St(t)};if(a?a.appSpace[r.name]=a.appSpace[r.name]||c:a={code:"",appSpace:{[r.name]:c}},J.link.setInfo(i,a),!n)r.source.links.add(i),s=document.createComment(`link element with href=${i} move to micro-app-head as style element`),a.appSpace[r.name].placeholder=s;else return{address:i,linkInfo:a}}else o&&["prefetch","preload","prerender","modulepreload","icon"].includes(o)?n?s=document.createComment(`link element with rel=${o}${i?" & href="+i:""} removed by micro-app`):e?.removeChild(t):i&&l.rawSetAttribute.call(t,"href",z(i,r.url));if(n)return{replaceComment:s};if(s)return e?.replaceChild(s,t)}function ni(t,e,r,n){const o=Array.from(e.source.links),i=o.map(a=>{const c=J.link.getInfo(a);return c.code?c.code:Ae(a,e.name)}),s=n?[]:null;ut(i,a=>{Fe(s,()=>oi(o[a.index],a.data,r,e))},a=>{I(a,e.name)},()=>{n?n.then(()=>{s.push(()=>Promise.resolve(e.onLoad({html:t}))),He(s)}):e.onLoad({html:t})})}function oi(t,e,r,n){const o=J.link.getInfo(t);o.code=e;const i=o.appSpace[n.name],s=i.placeholder;if(s){const a=Y("style");yr(n,t,a,o,i.attrs),s.parentNode?s.parentNode.replaceChild(a,s):r.appendChild(a),i.placeholder=null}}function yr(t,e,r,n,o){if(t.scopecss){const i=n.appSpace[t.name];if(i.prefix=i.prefix||Bt(t.name),i.parsedCode)r.textContent=i.parsedCode;else{const s=ti(t.name,i.prefix,n);s?r.textContent=s:(r.textContent=n.code,dt(r,t,e)),i.parsedCode=r.textContent}}else r.textContent=n.code;ri(r,o)}function ii(t,e,r,n){const o=Y("style"),i=()=>{yr(e,t,o,r,r.appSpace[e.name].attrs),Pr(n)};return r.code?te(i):Ae(t,e.name).then(s=>{r.code=s,i()}).catch(s=>{I(s,e.name),Rr(n)}),o}var Ne;(function(t){t.NAME="name",t.URL="url"})(Ne||(Ne={}));var j;(function(t){t.CREATED="created",t.LOADING="loading",t.LOAD_FAILED="load_failed",t.BEFORE_MOUNT="before_mount",t.MOUNTING="mounting",t.MOUNTED="mounted",t.UNMOUNT="unmount"})(j||(j={}));var N;(function(t){t.CREATED="created",t.BEFOREMOUNT="beforemount",t.MOUNTED="mounted",t.UNMOUNT="unmount",t.ERROR="error",t.BEFORESHOW="beforeshow",t.AFTERSHOW="aftershow",t.AFTERHIDDEN="afterhidden"})(N||(N={}));var Pe;(function(t){t.ONMOUNT="onmount",t.ONUNMOUNT="onunmount"})(Pe||(Pe={}));var Be;(function(t){t.KEEP_ALIVE_SHOW="keep_alive_show",t.KEEP_ALIVE_HIDDEN="keep_alive_hidden"})(Be||(Be={}));var tr;(function(t){t.DESTROY="destroy",t.DESTORY="destory",t.INLINE="inline",t.DISABLESCOPECSS="disableScopecss",t.DISABLESANDBOX="disableSandbox",t.DISABLE_SCOPECSS="disable-scopecss",t.DISABLE_SANDBOX="disable-sandbox",t.DISABLE_MEMORY_ROUTER="disable-memory-router",t.DISABLE_PATCH_REQUEST="disable-patch-request",t.KEEP_ROUTER_STATE="keep-router-state",t.KEEP_ALIVE="keep-alive",t.CLEAR_DATA="clear-data",t.SSR="ssr",t.FIBER="fiber"})(tr||(tr={}));const rr="window,self,globalThis,document,Document,Array,Object,String,Boolean,Math,Number,Symbol,Date,Function,Proxy,WeakMap,WeakSet,Set,Map,Reflect,Element,Node,RegExp,Error,TypeError,JSON,isNaN,parseFloat,parseInt,performance,console,decodeURI,encodeURI,decodeURIComponent,encodeURIComponent,navigator,undefined,location,history",nr=[1,2,3],Mr="state",$e="search",rt="native",Or="native-scope",Dr="pure",si=[$e,Mr,rt,Or,Dr],Cr=["popstate","hashchange","load","unload","unmount","appstate-change","statechange","mounted","error"],ai=Cr,ci=Cr.concat(["unhandledrejection","message"]),Ir=["onpopstate","onhashchange","onload","onunload","onerror"],li=Ir,ui=Ir.concat(["onunhandledrejection"]),hi=["DOMContentLoaded","readystatechange"],di=["onreadystatechange"],Lr=["window","self","globalThis"],fi=["rawWindow","rawDocument"],pi=["host","hostname","port","protocol","origin"],mi=["text/javascript","text/ecmascript","application/javascript","application/ecmascript","module","systemjs-module","systemjs-importmap"];function me(t,e){return e.appSpace[t.name].module&&(!t.useSandbox||t.iframe)}function _i(t,e){return e.appSpace[t.name].attrs.has("id")}function ft(t,e){return t.inline||e.appSpace[t.name].inline||me(t,e)||_i(t,e)}function Tr(t){return t.iframe?t.sandBox.microAppWindow:l.rawWindow}function vi(t,e){const r=Tr(t);return new r.Function(e)}function gi(t,e,r){const n=e.appSpace;for(const o in n)if(o!==t.name){const i=n[o];if(i.parsedCode===r&&i.parsedFunction)return i.parsedFunction}}function xr(t,e,r){return gi(t,e,r)||vi(t,r)}function Nr(){const t=qo();return J.script.hasInfo(t)?Nr():t}function Ei(t,e){e.forEach((r,n)=>{n==="type"&&r==="module"||n==="defer"||n==="async"||(n==="src"&&(n="data-origin-src"),l.rawSetAttribute.call(t,n,r))})}function Br(t,e){return t.useSandbox&&!me(t,e)}function Ur(t,e){return Br(t,e)?t.iframe?"iframe":"with":"disable"}function Wr(t,e,r,n=!1){var o;let i=null,s=t.getAttribute("src");if(s&&(s=z(s,r.url)),t.hasAttribute("exclude")||Ut(s,r.name))i=document.createComment("script element with exclude attribute removed by micro-app");else{if(t.type&&!mi.includes(t.type)||t.hasAttribute("ignore")||Wt(s,r.name))return!((o=l.rawDocument)===null||o===void 0)&&o.currentScript&&delete l.rawDocument.currentScript,null;if(l.supportModuleScript&&t.noModule||!l.supportModuleScript&&t.type==="module")i=document.createComment(`${t.noModule?"noModule":"module"} script ignored by micro-app`);else if(s){let a=J.script.getInfo(s);const c={async:t.hasAttribute("async"),defer:t.defer||t.type==="module",module:t.type==="module",inline:t.hasAttribute("inline"),pure:t.hasAttribute("pure"),attrs:St(t)};if(a?a.appSpace[r.name]=a.appSpace[r.name]||c:a={code:"",isExternal:!0,appSpace:{[r.name]:c}},J.script.setInfo(s,a),!n)r.source.scripts.add(s),i=document.createComment(`script with src='${s}' extract by micro-app`);else return{address:s,scriptInfo:a}}else if(t.textContent){const a=Nr(),c={code:t.textContent,isExternal:!1,appSpace:{[r.name]:{async:!1,defer:t.type==="module",module:t.type==="module",inline:t.hasAttribute("inline"),pure:t.hasAttribute("pure"),attrs:St(t)}}};if(!n)r.source.scripts.add(a),J.script.setInfo(a,c),i=document.createComment("inline script extract by micro-app");else return{address:a,scriptInfo:c}}else n||(i=document.createComment("script element removed by micro-app"))}return n?{replaceComment:i}:e?.replaceChild(i,t)}function Fr(t){var e,r,n;const o=((e=_.options.plugins)===null||e===void 0?void 0:e.global)||[],i=((n=(r=_.options.plugins)===null||r===void 0?void 0:r.modules)===null||n===void 0?void 0:n[t])||[];return[...o,...i]}function Ut(t,e){return t?(Fr(e)||[]).some(n=>n.excludeChecker?n.excludeChecker(t):!1):!1}function Wt(t,e){return t?(Fr(e)||[]).some(n=>n.ignoreChecker?n.ignoreChecker(t):!1):!1}function wi(t,e){const r=Array.from(e.source.scripts),n=[],o=[];for(const s of r){const a=J.script.getInfo(s),c=a.appSpace[e.name];(!c.defer&&!c.async||e.isPrefetch&&!e.isPrerender)&&(n.push(a.code?a.code:Ae(s,e.name)),o.push([s,a]))}const i=e.isPrefetch||e.fiber?[]:null;n.length?ut(n,s=>{Fe(i,()=>Ai(o[s.index][0],o[s.index][1],s.data,e))},s=>{I(s,e.name)},()=>{i?(i.push(()=>Promise.resolve(e.onLoad({html:t}))),He(i)):e.onLoad({html:t})}):e.onLoad({html:t})}function Ai(t,e,r,n){if(e.code=r,n.isPrefetch&&n.prefetchLevel===2){const o=e.appSpace[n.name];if(!o.parsedCode&&(o.parsedCode=Hr(t,n,r,e),o.sandboxType=Ur(n,e),!ft(n,e)))try{o.parsedFunction=xr(n,e,o.parsedCode)}catch(i){I("Something went wrong while handling preloaded resources",n.name,`
`,i)}}}function bi(t,e){const r=t.fiber?[]:null,n=Array.from(t.source.scripts),o=[],i=[];for(const s of n){const a=J.script.getInfo(s),c=a.appSpace[t.name];c.defer||c.async?(a.isExternal&&!a.code&&!me(t,a)?o.push(Ae(s,t.name)):o.push(a.code),i.push([s,a]),me(t,a)&&(e.moduleCount=e.moduleCount?++e.moduleCount:1)):Fe(r,()=>{nt(s,t,a),e(!1)})}o.length?ut(o,s=>{const a=i[s.index][1];a.code=a.code||s.data},s=>{e.errorCount=e.errorCount?++e.errorCount:1,I(s,t.name)},()=>{i.forEach(([s,a])=>{B(a.code)&&Fe(r,()=>{nt(s,t,a,e),!me(t,a)&&e(!1)})}),r?(r.push(()=>Promise.resolve(e(ve(e.moduleCount)||e.errorCount===o.length))),He(r)):e(ve(e.moduleCount)||e.errorCount===o.length)}):r?(r.push(()=>Promise.resolve(e(!0))),He(r)):e(!0)}function nt(t,e,r,n,o){var i,s;try{Mi(e);const a=r.appSpace[e.name],c=Ur(e,r);if((!a.parsedCode||a.sandboxType!==c)&&(a.parsedCode=Hr(t,e,r.code,r),a.sandboxType=c,a.parsedFunction=null),ft(e,r)){const u=o||Y("script");if(Si(t,a.parsedCode,me(e,r),u,a.attrs,n),!o){const d=e.iframe?(i=e.sandBox)===null||i===void 0?void 0:i.microBody:e.querySelector("micro-app-body");d?.appendChild(u)}}else yi(e,r)}catch(a){const c=a;let u=!0;if(typeof((s=_?.options)===null||s===void 0?void 0:s.excludeRunScriptFilter)=="function"&&(u=_.options.excludeRunScriptFilter(t,c,e.name,e.url)!==!0),u)throw a}}function Pi(t,e,r,n){const o=ft(e,r)?Y("script"):document.createComment(`dynamic script with src='${t}' extract by micro-app`),i=()=>Pr(n),s=()=>{const a=Object.getOwnPropertyDescriptor(l.rawDocument,"currentScript");(!a||a.configurable)&&Object.defineProperty(l.rawDocument,"currentScript",{value:n,configurable:!0}),nt(t,e,r,i,o),!me(e,r)&&i()};return r.code||me(e,r)?te(s):Ae(t,e.name).then(a=>{r.code=a,s()}).catch(a=>{I(a,e.name),Rr(n)}),o}function Ri(t,e,r){const n=ft(e,r)?Y("script"):document.createComment("dynamic inline script extract by micro-app");return nt(t,e,r,void 0,n),n}function Si(t,e,r,n,o,i){if(r){if(l.rawSetAttribute.call(n,"type","module"),je(t)?n.textContent=e:n.src=t,i){const s=()=>{i.moduleCount&&i.moduleCount--,i(i.moduleCount===0)};je(t)?te(s):n.onload=s}}else n.textContent=e;Ei(n,o)}function yi(t,e){const r=e.appSpace[t.name];r.parsedFunction||(r.parsedFunction=xr(t,e,r.parsedCode)),r.parsedFunction.call(Tr(t))}function Hr(t,e,r,n){return U(_.options.plugins)&&(r=Di(t,r,e.name,_.options.plugins)),Br(e,n)?e.iframe?`(function(window,self,global,location){;${r}
${je(t)?"":`//# sourceURL=${t}
`}}).call(window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyLocation);`:`;(function(proxyWindow){with(proxyWindow.__MICRO_APP_WINDOW__){(function(${rr}){;${r}
${je(t)?"":`//# sourceURL=${t}
`}}).call(proxyWindow,${rr})}})(window.__MICRO_APP_PROXY_WINDOW__);`:r}function Mi(t){Oi(t)}function Oi(t){t.sandBox&&(l.rawWindow.__MICRO_APP_PROXY_WINDOW__=t.sandBox.proxyWindow)}function Di(t,e,r,n){var o;const i=or(n.global,e,t);return or((o=n.modules)===null||o===void 0?void 0:o[r],i,t)}function or(t,e,r){return le(t)?t.reduce((n,o)=>U(o)&&S(o.loader)?o.loader(n,r):n,e):e}function Ci(t,e,r){if(!t||!To(t))return;Array.from(t.getElementsByTagName("link")).map(a=>(a.hasAttribute("exclude")||Ut(a.getAttribute("href"),e.name)?a.parentElement.replaceChild(document.createComment("link element with exclude attribute ignored by micro-app"),a):a.hasAttribute("ignore")||Wt(a.getAttribute("href"),e.name)?a.hasAttribute("href")&&l.rawSetAttribute.call(a,"href",z(a.getAttribute("href"),e.url)):Sr(a,a.parentElement,e),a)),Array.from(t.getElementsByTagName("style")).map(a=>(a.hasAttribute("exclude")?a.parentElement.replaceChild(document.createComment("style element with exclude attribute ignored by micro-app"),a):e.scopecss&&!a.hasAttribute("ignore")&&Fe(r,()=>dt(a,e)),a)),Array.from(t.getElementsByTagName("script")).map(a=>(Wr(a,a.parentElement,e),a)),Array.from(t.getElementsByTagName("img")).map(a=>(a.hasAttribute("src")&&l.rawSetAttribute.call(a,"src",z(a.getAttribute("src"),e.url)),a))}function Ii(t,e){const r=e.parseHtmlString(t),n=l.rawElementQuerySelector.call(r,"micro-app-head"),o=l.rawElementQuerySelector.call(r,"micro-app-body");if(!n||!o){const a=`element ${n?"body":"head"} is missing`;return e.onerror(new Error(a)),I(a,e.name)}const i=e.isPrefetch||e.fiber?[]:null;Ci(r,e,i);const s=He(i);e.source.links.size?ni(r,e,n,s):s?s.then(()=>e.onLoad({html:r})):e.onLoad({html:r}),e.source.scripts.size?wi(r,e):e.onLoad({html:r})}class Li{constructor(){this.eventList=new Map,this.queue=[],this.recordStep={},this.process=()=>{var e,r;let n;const o=this.recordStep,i=this.queue;for(this.recordStep={},this.queue=[];n=i.shift();){const s=this.eventList.get(n),a=s.tempData,c=s.force;s.tempData=null,s.force=!1;let u;if(c||!this.isEqual(s.data,a)){s.data=a||s.data;for(const d of s.callbacks){const A=d(s.data);A&&(u??(u=[])).push(A)}(r=(e=o[n]).dispatchDataEvent)===null||r===void 0||r.call(e),o[n].nextStepList.forEach(d=>d(u))}}}}isLegalName(e){return e?!0:(I("event-center: Invalid name"),!1)}enqueue(e,r,n){this.recordStep[e]?(this.recordStep[e].nextStepList.push(r),n&&(this.recordStep[e].dispatchDataEvent=n)):this.recordStep[e]={nextStepList:[r],dispatchDataEvent:n},!this.queue.includes(e)&&this.queue.push(e)===1&&te(this.process)}isEqual(e,r){if(!r||Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&e[n]!==r[n])return!1;return!0}on(e,r,n=!1){if(this.isLegalName(e)){if(!S(r))return I("event-center: Invalid callback function");let o=this.eventList.get(e);o?n&&Object.keys(o.data).length&&(!this.queue.includes(e)||this.isEqual(o.data,o.tempData))&&r(o.data):(o={data:{},callbacks:new Set},this.eventList.set(e,o)),o.callbacks.add(r)}}off(e,r){if(this.isLegalName(e)){const n=this.eventList.get(e);n&&(S(r)?n.callbacks.delete(r):n.callbacks.clear())}}clearData(e){if(this.isLegalName(e)){const r=this.eventList.get(e);r&&(r.data={})}}dispatch(e,r,n,o,i){if(this.isLegalName(e)){if(!U(r))return I("event-center: data must be object");let s=this.eventList.get(e);s?(s.tempData=k({},s.tempData||s.data,r),!s.force&&(s.force=!!o)):(s={data:r,callbacks:new Set},this.eventList.set(e,s),s.force=!0),this.enqueue(e,n,i)}}getData(e){var r;const n=this.eventList.get(e);return(r=n?.data)!==null&&r!==void 0?r:null}}const x=new Li;function q(t,e){return!B(t)||!t?"":e?`__${t}_from_base_app__`:`__${t}_from_micro_app__`}class jr{addGlobalDataListener(e,r){const n=this.appName;n&&(e.__APP_NAME__=n,e.__AUTO_TRIGGER__=r),x.on("global",e,r)}removeGlobalDataListener(e){S(e)&&x.off("global",e)}setGlobalData(e,r,n){G(),x.dispatch("global",e,o=>S(r)&&r(o),n)}forceSetGlobalData(e,r){this.setGlobalData(e,r,!0)}getGlobalData(){return x.getData("global")}clearGlobalData(){x.clearData("global")}clearGlobalDataListener(){const e=this.appName,r=x.eventList.get("global");if(r)for(const n of r.callbacks)(e&&e===n.__APP_NAME__||!(e||n.__APP_NAME__))&&r.callbacks.delete(n)}}class Ti extends jr{addDataListener(e,r,n){x.on(q($(e),!1),r,n)}removeDataListener(e,r){S(r)&&x.off(q($(e),!1),r)}getData(e,r=!1){return x.getData(q($(e),r))}setData(e,r,n,o){x.dispatch(q($(e),!0),r,i=>S(n)&&n(i),o)}forceSetData(e,r,n){this.setData(e,r,n,!0)}clearData(e,r=!0){x.clearData(q($(e),r))}clearDataListener(e){x.off(q($(e),!1))}changeEventAppName(e,r){const n=q($(e),!0),o=q($(r),!0);x.eventList.has(o)&&(x.eventList.set(n,x.eventList.get(o)),x.eventList.delete(o))}}class $r extends jr{constructor(e){super(),this.appName=$(e),!this.appName&&I(`Invalid appName ${e}`)}addDataListener(e,r){e.__AUTO_TRIGGER__=r,x.on(q(this.appName,!0),e,r)}removeDataListener(e){S(e)&&x.off(q(this.appName,!0),e)}getData(e=!0){return x.getData(q(this.appName,e))}dispatch(e,r,n){G(),x.dispatch(q(this.appName,!1),e,o=>S(r)&&r(o),n,()=>{const o=O.get(this.appName);if(o?.container&&U(e)){const i=new CustomEvent("datachange",{detail:{data:x.getData(q(this.appName,!1))}});de(o.container).dispatchEvent(i)}})}forceDispatch(e,r){this.dispatch(e,r,!0)}clearData(e=!1){x.clearData(q(this.appName,e))}clearDataListener(){x.off(q(this.appName,!0))}}function Gr(t){var e,r;if(t){t.umdDataListeners={global:new Set((e=t.umdDataListeners)===null||e===void 0?void 0:e.global),normal:new Set((r=t.umdDataListeners)===null||r===void 0?void 0:r.normal)};const n=x.eventList.get("global");if(n)for(const i of n.callbacks)t.appName===i.__APP_NAME__&&t.umdDataListeners.global.add(i);const o=x.eventList.get(q(t.appName,!0));if(o)for(const i of o.callbacks)t.umdDataListeners.normal.add(i)}}function qr(t){if(t?.umdDataListeners){for(const e of t.umdDataListeners.global)t.addGlobalDataListener(e,e.__AUTO_TRIGGER__);for(const e of t.umdDataListeners.normal)t.addDataListener(e,e.__AUTO_TRIGGER__);Ft(t)}}function Ft(t){t==null||delete t.umdDataListeners}class Ge{constructor(){this.appInstanceMap=O}static getInstance(){return this.instance||(this.instance=new Ge),this.instance}get(e){return this.appInstanceMap.get(e)}set(e,r){this.appInstanceMap.set(e,r)}getAll(){return Array.from(this.appInstanceMap.values())}clear(){this.appInstanceMap.clear()}}function Kr(){Vr(),Ge.getInstance().getAll().forEach(t=>{t.container&&de(t.container).disconnectedCallback()}),!window.__MICRO_APP_UMD_MODE__&&Ge.getInstance().clear()}function Vr(){window.__MICRO_APP_ENVIRONMENT__&&window.removeEventListener("unmount",Kr,!1)}function xi(){window.__MICRO_APP_ENVIRONMENT__&&(Vr(),window.addEventListener("unmount",Kr,!1))}function Ni(t){return gr(t.__MICRO_APP_IS_BOUND_FUNCTION__)?t.__MICRO_APP_IS_BOUND_FUNCTION__:t.__MICRO_APP_IS_BOUND_FUNCTION__=Mo(t)}function Bi(t){return gr(t.__MICRO_APP_IS_CONSTRUCTOR__)?t.__MICRO_APP_IS_CONSTRUCTOR__:t.__MICRO_APP_IS_CONSTRUCTOR__=at(t)}function Z(t,e,r="WINDOW"){if(S(t)&&!Bi(t)&&!Ni(t)&&t.bind){const n=`__MICRO_APP_BOUND_${r}_FUNCTION__`;if(t[n])return t[n];const o=t.bind(e);for(const i in t)o[i]=t[i];return t.hasOwnProperty("prototype")&&H(o,"prototype",{value:t.prototype,configurable:!0,enumerable:!1,writable:!0}),t[n]=o}return t}class Ui{constructor(e,r){this.rawWindowScopeKeyList=["location"],this.staticEscapeProperties=["System","__cjsWrapper"],this.staticScopeProperties=["webpackJsonp","webpackHotUpdate","Vue","onpopstate","onhashchange","event"],this.scopeProperties=Array.from(this.staticScopeProperties),this.escapeProperties=[],this.injectedKeys=new Set,this.escapeKeys=new Set,this.appName=e,this.url=r,this.injectReactHMRProperty()}injectReactHMRProperty(){}}class Wi{}function Fi(){l.rawWindow._babelPolyfill&&(l.rawWindow._babelPolyfill=!1)}function Ht(t,e){const r=Array.from(t.childNodes);r.length&&r.forEach(n=>{Ht(n,e)}),F(t,e)}function F(t,e){var r,n;if(e&&De(t)&&t.__MICRO_APP_NAME__!==e&&!t.__PURE_ELEMENT__&&!xt()){const o={__MICRO_APP_NAME__:{configurable:!0,enumerable:!0,writable:!0,value:e}};if(Do(t)&&Ge.getInstance().get(e)&&(o.href={get(){return this.getAttribute("href")},set(s){s!==void 0&&this.setAttribute("href",s)}}),ee(t,o),be(e)){const i=(n=(r=O.get(e))===null||r===void 0?void 0:r.sandBox)===null||n===void 0?void 0:n.proxyWindow;i&&ee(t,{baseURI:{configurable:!0,enumerable:!0,get:()=>i.location.href},ownerDocument:{configurable:!0,enumerable:!0,get:()=>t!==i.document?i.document:null},parentNode:Qr(e,l.rawParentNodeDesc),getRootNode:{configurable:!0,enumerable:!0,writable:!0,value:function(){return i.document}}})}}return t}function Qr(t,e){return{configurable:!0,enumerable:!0,get(){var r,n,o,i,s,a,c;Tt(t);const u=(r=e.get)===null||r===void 0?void 0:r.call(this);if(et(u)&&(!((n=O.get(t))===null||n===void 0)&&n.container)){const d=(i=(o=_.options).getRootElementParentNode)===null||i===void 0?void 0:i.call(o,this,t);return d||((s=_?.options)===null||s===void 0?void 0:s.inheritBaseBody)!==!0&&((c=(a=O.get(t))===null||a===void 0?void 0:a.container)===null||c===void 0?void 0:c.querySelector("micro-app-body"))||l.rawDocument.body}return u}}}function Hi(t,e,r){const{proxyDocument:n,documentEffect:o}=ji(t,r),i=$i(t,n);return ee(e,{document:{configurable:!1,enumerable:!0,get(){return n}},Document:{configurable:!1,enumerable:!1,get(){return i}}}),o}function ji(t,e){const r=new Map,n=new Map;let o=null,i=null;const{rawDocument:s,rawCreateElement:a,rawCreateElementNS:c,rawAddEventListener:u,rawRemoveEventListener:d}=l;function A(p,m){const R=a.call(s,p,m);return F(R,t)}function b(p,m,R){const T=c.call(s,p,m,R);return F(T,t)}function M(p,m,R){const T=r.get(p);T?T.add(m):r.set(p,new Set([m])),m&&(m.__MICRO_APP_MARK_OPTIONS__=R),u.call(s,p,m,R)}function D(p,m,R){const T=r.get(p);T?.size&&T.has(m)&&T.delete(m),d.call(s,p,m,R)}const g=()=>{n.clear(),i=null},P=()=>{i=o||i,r.forEach((p,m)=>{if(p.size){const R=n.get(m)||[];n.set(m,new Set([...R,...p]))}})},w=()=>{i&&!o&&(E.onclick=i),n.forEach((p,m)=>{for(const R of p)E.addEventListener(m,R,R?.__MICRO_APP_MARK_OPTIONS__)}),g()},v=()=>{S(o)&&d.call(s,"click",o),o=null,r.size&&(r.forEach((p,m)=>{for(const R of p)d.call(s,m,R)}),r.clear())},f=(()=>{var p;const m=new Map([["onclick",L=>{S(o)&&d.call(s,"click",o,!1),S(L)&&u.call(s,"click",L,!1),o=L}]]),R=((p=_.options)===null||p===void 0?void 0:p.customProxyDocumentProps)||new Map;return new Map([...m,...R])})(),E=new Proxy(s,{get:(p,m)=>{var R;return We(t),m==="createElement"?A:m==="createElementNS"?b:m===Symbol.toStringTag?"ProxyDocument":m==="defaultView"?e.proxyWindow:m==="onclick"?o:m==="addEventListener"?M:m==="removeEventListener"?D:m==="microAppElement"?(R=O.get(t))===null||R===void 0?void 0:R.container:m==="__MICRO_APP_NAME__"?t:Z(Reflect.get(p,m),s,"DOCUMENT")},set:(p,m,R)=>(f.has(m)?f.get(m)(R):m!=="microAppElement"&&Reflect.set(p,m,R),!0)});return{proxyDocument:E,documentEffect:{reset:g,record:P,rebuild:w,release:v}}}function $i(t,e){const{rawDocument:r,rawRootDocument:n}=l;class o{static[Symbol.hasInstance](s){let a=s;for(;a;)if(a=Object.getPrototypeOf(a),a===o.prototype)return!0;return s===e||s instanceof n}}return Object.setPrototypeOf(o,n),Object.setPrototypeOf(o.prototype,new Proxy(n.prototype,{get(i,s){return We(t),Z(Reflect.get(i,s),r,"DOCUMENT")},set(i,s,a){return Reflect.set(i,s,a),!0}})),o}function Gi(t,e,r){return qi(e),Ki(t,e,r),Vi(e,t)}function qi(t){const e=l.rawWindow;Object.getOwnPropertyNames(e).filter(r=>/^on/.test(r)&&!li.includes(r)).forEach(r=>{const{enumerable:n,writable:o,set:i}=Object.getOwnPropertyDescriptor(e,r)||{enumerable:!0,writable:!0};H(t,r,{enumerable:n,configurable:!0,get:()=>e[r],set:o??!!i?s=>{e[r]=s}:void 0})})}function Ki(t,e,r){const n=l.rawWindow,o=new Map,i=new Proxy(e,{get:(s,a)=>(We(t),Reflect.has(s,a)||B(a)&&/^__MICRO_APP_/.test(a)||ne(r.scopeProperties,a)?(ne(fi,a)&&G(),Reflect.get(s,a)):Z(Reflect.get(n,a),n)),set:(s,a,c)=>{if(ne(r.rawWindowScopeKeyList,a))Reflect.set(n,a,c);else if(!we.call(s,a)&&we.call(n,a)&&!ne(r.scopeProperties,a)){const u=Object.getOwnPropertyDescriptor(n,a),{configurable:d,enumerable:A,writable:b,set:M}=u;H(s,a,{value:c,configurable:d,enumerable:A,writable:b??!!M}),r.injectedKeys.add(a)}else(!Reflect.has(s,a)||ne(r.scopeProperties,a))&&r.injectedKeys.add(a),Reflect.set(s,a,c);return(ne(r.escapeProperties,a)||ne(r.staticEscapeProperties,a)&&!Reflect.has(n,a))&&!ne(r.scopeProperties,a)&&(!Reflect.has(n,a)&&r.escapeKeys.add(a),Reflect.set(n,a,c)),!0},has:(s,a)=>ne(r.scopeProperties,a)?r.injectedKeys.has(a)?Reflect.has(s,a):!!s[a]:Reflect.has(s,a)||Reflect.has(n,a),getOwnPropertyDescriptor:(s,a)=>{if(we.call(s,a))return o.set(a,"target"),Object.getOwnPropertyDescriptor(s,a);if(we.call(n,a)){o.set(a,"rawWindow");const c=Object.getOwnPropertyDescriptor(n,a);return c&&!c.configurable&&(c.configurable=!0),c}},defineProperty:(s,a,c)=>o.get(a)==="rawWindow"?Reflect.defineProperty(n,a,c):Reflect.defineProperty(s,a,c),ownKeys:s=>Ko(Reflect.ownKeys(n).concat(Reflect.ownKeys(s))),deleteProperty:(s,a)=>we.call(s,a)?(r.injectedKeys.has(a)&&r.injectedKeys.delete(a),r.escapeKeys.has(a)&&Reflect.deleteProperty(n,a),Reflect.deleteProperty(s,a)):!0});r.proxyWindow=i}function Vi(t,e){const r=new Map,n=new Map,o=new Map,i=new Map,{rawWindow:s,rawAddEventListener:a,rawRemoveEventListener:c,rawDispatchEvent:u,rawSetInterval:d,rawSetTimeout:A,rawClearInterval:b,rawClearTimeout:M}=l;function D(h){var f;return ai.includes(h)&&(!((f=O.get(e))===null||f===void 0)&&f.container)?de(O.get(e).container):s}t.addEventListener=function(h,f,E){h=yt(h,e);const p=r.get(h);p?p.add(f):r.set(h,new Set([f])),f&&(f.__MICRO_APP_MARK_OPTIONS__=E),a.call(D(h),h,f,E)},t.removeEventListener=function(h,f,E){h=yt(h,e);const p=r.get(h);p?.size&&p.has(f)&&p.delete(f),c.call(D(h),h,f,E)},t.dispatchEvent=function(h){return u.call(D(h?.type),h)},t.setInterval=function(h,f,...E){const p=d.call(s,h,f,...E);return o.set(p,{handler:h,timeout:f,args:E}),p},t.setTimeout=function(h,f,...E){const m=typeof h=="string"?h:function(...T){i.delete(R),typeof h=="function"&&h(...T)},R=A.call(s,m,f,...E);return i.set(R,{handler:m,timeout:f,args:E}),R},t.clearInterval=function(h){o.delete(h),b.call(s,h)},t.clearTimeout=function(h){i.delete(h),M.call(s,h)};const g=()=>{n.clear()};return{reset:g,record:()=>{r.forEach((h,f)=>{if(h.size){const E=n.get(f)||[];n.set(f,new Set([...E,...h]))}})},rebuild:()=>{n.forEach((h,f)=>{for(const E of h)t.addEventListener(f,E,E?.__MICRO_APP_MARK_OPTIONS__)}),g()},release:h=>{r.size&&(r.forEach((f,E)=>{for(const p of f)c.call(D(E),E,p)}),r.clear()),h&&(o.forEach((f,E)=>{b.call(s,E)}),i.forEach((f,E)=>{M.call(s,E)}),o.clear(),i.clear())}}}function ce(t,e,r){const n=l.rawWindow.history.state,o={__MICRO_APP_STATE__:k({},n?.__MICRO_APP_STATE__,{[t]:{fullPath:r?r.pathname+r.search+r.hash:null,state:e??null,mode:Ce(t)}})};return k({},n,o)}function Qi(t,e){return U(e?.__MICRO_APP_STATE__)&&(ve(e.__MICRO_APP_STATE__[t])||delete e.__MICRO_APP_STATE__[t],Object.keys(e.__MICRO_APP_STATE__).length||delete e.__MICRO_APP_STATE__),zo(e)?null:k({},e)}function Qe(t){var e,r;const n=l.rawWindow.history.state;return((r=(e=n?.__MICRO_APP_STATE__)===null||e===void 0?void 0:e[t])===null||r===void 0?void 0:r.state)||null}function Xr(t){var e;const r=l.rawWindow.history.state;return((e=r?.__MICRO_APP_STATE__)===null||e===void 0?void 0:e[t])||null}const Xi=/&/g,zi=/=/g,zr=/%M1/g,Yr=/%M2/g;function Jr(t){return encodeURIComponent(jt(t).replace(Xi,"%M1").replace(zi,"%M2"))}function Zr(t){return jt(t).replace(zr,"&").replace(Yr,"=")}function jt(t){try{const e=decodeURIComponent(t);return t===e||zr.test(e)||Yr.test(e)?e:jt(e)}catch{return t}}function Xe(t){var e,r,n,o;const i=l.rawWindow.location,s=l.rawWindow.history.state;if(X(t)){const a=$t(i.search,i.hash),c=((e=a.hashQuery)===null||e===void 0?void 0:e[t])||((r=a.searchQuery)===null||r===void 0?void 0:r[t]);return B(c)?Zr(c):null}return((o=(n=s?.__MICRO_APP_STATE__)===null||n===void 0?void 0:n[t])===null||o===void 0?void 0:o.fullPath)||(ie(t)?i.pathname+i.search+i.hash:null)}function _e(t,e){const r=l.rawWindow.location;let n=e.pathname+e.search+e.hash,o=!1;if(X(t)){let{pathname:i,search:s,hash:a}=r;const c=$t(s,a),u=Jr(n);return a&&!s?(o=!0,c.hashQuery?c.hashQuery[t]=u:c.hashQuery={[t]:u},a=(a.includes("?")?a.slice(0,a.indexOf("?")+1):a+"?")+tt(c.hashQuery)):(c.searchQuery?c.searchQuery[t]=u:c.searchQuery={[t]:u},s="?"+tt(c.searchQuery)),{fullPath:i+s+a,isAttach2Hash:o}}return(Gt(t)||oe(t))&&(n=r.pathname+r.search+r.hash),{fullPath:n,isAttach2Hash:o}}function Yi(t){var e,r,n,o;let{pathname:i,search:s,hash:a}=l.rawWindow.location,c=!1;if(X(t)){const u=$t(s,a);if(!((e=u.hashQuery)===null||e===void 0)&&e[t]){c=!0,(r=u.hashQuery)===null||r===void 0||delete r[t];const d=tt(u.hashQuery);a=a.slice(0,a.indexOf("?")+ +!!d)+d}else if(!((n=u.searchQuery)===null||n===void 0)&&n[t]){(o=u.searchQuery)===null||o===void 0||delete o[t];const d=tt(u.searchQuery);s=d?"?"+d:""}}return{fullPath:i+s+a,isAttach2Hash:c}}function $t(t,e){const r={};return t!==""&&t!=="?"&&(r.searchQuery=zt(t.slice(1))),e.includes("?")&&(r.hashQuery=zt(e.slice(e.indexOf("?")+1))),r}function Ji(t,e){const r=Xe(t);if(!r)return"";const n=W(r,e);return n.origin+n.pathname+n.search}function qe(t){const e=O.get(t);return!!(e&&!e.isPrefetch)}function Ce(t){var e;return(e=O.get(t))===null||e===void 0?void 0:e.routerMode}function X(t){return Ce(t)===$e}function Gt(t){return Ce(t)===Mr}function Mt(t){return Ce(t)===rt}function Zi(t){return Ce(t)===Or}function oe(t){return Ce(t)===Dr}function ie(t){return Mt(t)||Zi(t)}function kr(t,e){const r=e&&rt||t||_.options["disable-memory-router"]&&rt||_.options["router-mode"]||$e;return si.includes(r)?r:$e}function en(t){const e=l.rawWindow,r=n=>{var o,i,s;if(Oe({excludeHiddenApp:!0,excludePreRender:!0}).includes(t)&&!n.onlyForBrowser&&(!ie(t)||!l.rawWindow.history.state||Xr(t))){const a=(o=O.get(t))===null||o===void 0?void 0:o.container;jo(()=>ot(t,Xe(t)),(s=(i=a&&de(a))===null||i===void 0?void 0:i.getRouterEventDelay())!==null&&s!==void 0?s:0)}};return e.addEventListener("popstate",r),()=>{e.removeEventListener("popstate",r)}}function ot(t,e){const r=O.get(t);if(r?.sandBox){const n=r.sandBox.proxyWindow,o=r.sandBox.microAppWindow;let i=!1;const s=n.location.href;if(e){const a=n.location.hash;Ie(t,e,o.location),i=n.location.hash!==a}ki(t,n,o),i&&es(t,n,o,s),G()}}function ki(t,e,r){const n=new PopStateEvent("popstate",{state:Qe(t)});r.dispatchEvent(n),be(t)||S(e.onpopstate)&&e.onpopstate(n)}function es(t,e,r,n){const o=new HashChangeEvent("hashchange",{newURL:e.location.href,oldURL:n});r.dispatchEvent(o),be(t)||S(e.onhashchange)&&e.onhashchange(o)}function ts(t){const e=new PopStateEvent("popstate",{state:null});t&&(e.onlyForBrowser=!0),l.rawWindow.dispatchEvent(e)}function rs(t){const e=new HashChangeEvent("hashchange",{newURL:l.rawWindow.location.href,oldURL:t});l.rawWindow.dispatchEvent(e)}function Ot(t,e,r){G(),qe(t)&&(ts(e),r&&rs(r))}function tn(t,e){const r=l.rawWindow.history;function n(i){return function(...s){var a,c,u;s[2]=ve(s[2])||Ue(s[2])||""+s[2]==""?e.href:""+s[2];const d=W(s[2],e.href),A=d.pathname+d.search+d.hash;oe(t)||pt(t,i,_e(t,d),!0,ce(t,s[0],d),s[1]),A!==e.fullPath&&Ie(t,A,e),(u=(a=O.get(t))===null||a===void 0?void 0:(c=a.sandBox).updateIframeBase)===null||u===void 0||u.call(c)}}const o={pushState:n("pushState"),replaceState:n("replaceState")};return be(t)?k({go(i){return r.go(i)}},o):new Proxy(r,{get(i,s){return s==="pushState"||s==="replaceState"?o[s]:s==="state"?Qe(t):Z(Reflect.get(i,s),i,"HISTORY")},set(i,s,a){return s==="pushState"||s==="replaceState"?o[s]=a:Reflect.set(i,s,a),!0}})}function Me(t,e,r,n=null,o=""){qe(t)&&(e==="pushState"?l.rawPushState:l.rawReplaceState).call(l.rawWindow.history,n,o,r)}function pt(t,e,r,n,o,i){if(qe(t)){const s=l.rawWindow.location,a=s.pathname+s.search+s.hash,c=r.isAttach2Hash&&a!==r.fullPath?s.href:null;Me(t,e,r.fullPath,o,i),a!==r.fullPath&&X(t)&&Ot(t,n,c)}}function mt(t,e,r){pt(t,"replaceState",e,!0,r)}function ir(t){const e=l.rawWindow;return function(...r){var n;if(!((n=e.history.state)===null||n===void 0)&&n.__MICRO_APP_STATE__&&(!U(r[0])||!r[0].__MICRO_APP_STATE__)&&(B(r[2])||ct(r[2]))){const o=e.location.href;W(r[2],o).href===o&&(r[0]=k({},r[0],{__MICRO_APP_STATE__:e.history.state.__MICRO_APP_STATE__}))}t.apply(e.history,r),Oe({excludeHiddenApp:!0,excludePreRender:!0}).forEach(o=>{if((X(o)||Gt(o))&&!Xe(o)){const i=O.get(o);mt(o,_e(o,i.sandBox.proxyWindow.location),ce(o,Qe(o),i.sandBox.proxyWindow.location))}ie(o)&&!Xr(o)&&Me(o,"replaceState",e.location.href,ce(o))}),G()}}function rn(){const t=l.rawWindow;t.history.pushState=ir(l.rawPushState),t.history.replaceState=ir(l.rawReplaceState)}function nn(){const t=l.rawWindow;t.history.pushState=l.rawPushState,t.history.replaceState=l.rawReplaceState}function ns(){function t(g,P,w,v){pt(g,P,_e(g,w),!1,ce(g,v??null,w)),G()}function e(g,P,w,v){const h=P.sandBox.proxyWindow.location,f=W(w.path,h.href),E=h.pathname+h.search+h.hash,p=f.pathname+f.search+f.hash;if(E!==p||Xe(g)!==p){if(!oe(g)){const m=v&&w.replace!==!1||w.replace===!0?"replaceState":"pushState";t(g,m,f,w.state)}X(g)||ot(g,p)}}function r(g){return function(P){return new Promise((w,v)=>{const h=$(P.name);if(h&&B(P.path))if(Oe({excludeHiddenApp:!0,excludePreRender:!0}).includes(h)){const f=O.get(h);w(f.sandBox.sandboxReady.then(()=>e(h,f,P,g)))}else v(I(""));else v(I(`navigation failed, name & path are required when use router.${g?"replace":"push"}`))})}}function n(g){return function(...P){return l.rawWindow.history[g](...P)}}const o=Yt(),i=Yt();function s(g,P,w,v){G();for(const h of v)S(h)?h(P,w,g):U(h)&&S(h[g])&&h[g](P,w)}function a(g,P,w){D.current.set(g,P),s(g,P,w,o.list()),ht(()=>{s(g,P,w,i.list())})}function c(g){D.current.delete(g)}function u(g){if(X(g)||Gt(g)){const P=O.get(g);mt(g,_e(g,P.sandBox.proxyWindow.location),ce(g,Qe(g),P.sandBox.proxyWindow.location))}}function d(g){g=$(g),g&&Oe().includes(g)&&u(g)}function A({includeHiddenApp:g=!1,includePreRender:P=!1}){Oe({excludeHiddenApp:!g,excludePreRender:!P}).forEach(w=>u(w))}function b(){const g=Vo();function P(v){const h=$(v.name);return!h||!v.path?Ro:g.add(h,v.path)}function w(v){return v=$(v),v?g.delete(v):!1}return{setDefaultPage:P,removeDefaultPage:w,getDefaultPage:g.get}}function M(){let g=null;function P(w){yo(w)&&(g=new Proxy(w,{get(v,h){return G(),Z(Reflect.get(v,h),v,"BASEROUTER")},set(v,h,f){return Reflect.set(v,h,f),!0}}))}return{setBaseAppRouter:P,getBaseAppRouter:()=>g}}const D=Object.assign(Object.assign({current:new Map,encode:Jr,decode:Zr,push:r(!1),replace:r(!0),go:n("go"),back:n("back"),forward:n("forward"),beforeEach:o.add,afterEach:i.add,attachToURL:d,attachAllToURL:A},b()),M());return{router:D,executeNavigationGuard:a,clearRouterWhenUnmount:c}}const{router:ze,executeNavigationGuard:on,clearRouterWhenUnmount:os}=ns(),is=["href","pathname","search","hash","host","hostname","port","protocol","search"],ss=[...is,"origin","fullPath"];function sn(t,e,r,n,o,i){const a=l.rawWindow.location,c=!!r,u=W(e);function d(){return c?r.location:u}function A(v,h){const f=W(v,w.href);if(f.origin===w.origin){const E=_e(t,f);if(!ie(t)){if(h=oe(t)?"replaceState":h,f.pathname===w.pathname&&f.search===w.search){let p=null;(f.hash!==w.hash||oe(t))&&(E.isAttach2Hash&&(p=a.href),(!oe(t)||!f.hash)&&Me(t,h,E.fullPath,X(t)?null:ce(t,null,f))),f.hash?X(t)?Ot(t,!1,p):ot(t,f.pathname+f.search+f.hash):P();return}Me(t,h,E.fullPath,X(t)?null:ce(t,null,f)),P();return}return E.fullPath}return v}function b(v,h){const f=W(v,e);f[h]===w[h]&&w.hash?Ot(t,!1):(Me(t,f[h]===w[h]||oe(t)?"replaceState":"pushState",_e(t,f).fullPath,X(t)?null:ce(t,null,f)),P())}const M=v=>function(h){if(qe(t)){const f=A(h,v==="assign"?"pushState":"replaceState");f&&a[v](W(f,a.origin).href)}},D=M("assign"),g=M("replace"),P=v=>a.reload(v);H(d(),"fullPath",{enumerable:!0,configurable:!0,get:()=>w.pathname+w.search+w.hash});const w=new Proxy({},{get:(v,h)=>{const f=d();if(h==="assign")return D;if(h==="replace")return g;if(h==="reload")return P;if(h==="self")return f;if(h==="fullPath")return f.fullPath;if(pi.includes(h)){if(Mt(t))return a[h];if(c)return n[h]}if(h==="href"){if(Mt(t))return f[h].replace(f.origin,a.origin);if(c)return f[h].replace(o,i)}return Z(Reflect.get(f,h),f,"LOCATION")},set:(v,h,f)=>{if(qe(t)){const E=d();if(h==="href"){const p=A(f,"pushState");p&&(a.href=W(p,a.origin).href)}else if(h==="pathname")if(ie(t))a.pathname=f;else{const p=("/"+f).replace(/^\/+/,"/")+w.search+w.hash;b(p,"pathname")}else if(h==="search")if(ie(t))a.search=f;else{const p=w.pathname+("?"+f).replace(/^\?+/,"?")+w.hash;b(p,"search")}else if(h==="hash")if(ie(t))a.hash=f;else{const p=w.pathname+w.search+("#"+f).replace(/^#+/,"#"),m=W(p,e);m.hash!==w.hash&&(oe(t)||pt(t,"pushState",_e(t,m),!1,ce(t,null,m)),X(t)||ot(t,m.pathname+m.search+m.hash))}else Reflect.set(E,h,f)}return!0}});return w}function it(t,e){const r=k({name:t},e);for(const n of ss)r[n]=e[n];return r}function as(t,e){on(t,it(t,e),it(t,e))}function Ie(t,e,r,n){var o;const i=it(t,r),s=W(e,r.href);if(be(t)){const u=O.get(t).sandBox.microAppWindow;(o=u.rawReplaceState)===null||o===void 0||o.call(u.history,Qe(t),"",s.href)}else{let u=s.href;r.self.origin!==s.origin&&(u=u.replace(s.origin,r.self.origin)),r.self.href=u}const a=l.rawWindow.location;ie(t)&&e!==a.pathname+a.search+a.hash&&n!=="prevent"&&Me(t,"replaceState",e,l.rawWindow.history.state);const c=it(t,r);(n==="auto"||i.fullPath!==c.fullPath&&n!=="prevent")&&on(t,c,i)}function cs(t,e){const r=sn(t,e);return{microLocation:r,microHistory:tn(t,r)}}function an(t,e,r){const n=Xe(t);n?(Ie(t,n,e,"auto"),oe(t)&&_t(t)):qt(t,e,r)}function qt(t,e,r){r&&Ie(t,r,e,"prevent"),oe(t)||mt(t,_e(t,e),ce(t,null,e)),as(t,e)}function cn(t,e,r,n){if(!n&&!ie(t)){const{pathname:o,search:i,hash:s}=W(e);Ie(t,o+i+s,r,"prevent")}oe(t)||_t(t),os(t)}function _t(t){mt(t,Yi(t),Qi(t,l.rawWindow.history.state))}function sr(t,e){const r=ve(e)?l.rawWindow.fetch:e;return S(r)?function(o,i,...s){return(B(o)||ct(o))&&(o=W(o,t).toString()),G(),r.call(l.rawWindow,o,i,...s)}:r}function ar(t,e){const r=ve(e)?l.rawWindow.XMLHttpRequest:e;return at(r)?class extends r{open(o,i,...s){(B(i)&&!/^f(ile|tp):\/\//.test(i)||ct(i))&&(i=W(i,t).toString()),G(),super.open(o,i,...s)}}:r}function ls(){let t;function e(n,o,i){const s=ve(i)?l.rawWindow.EventSource:i;return at(s)?class extends s{constructor(c,u,...d){if((B(c)||ct(c))&&(c=W(c,o).toString()),G(),super(c,u,...d),t){const A=t.get(n);A?A.add(this):t.set(n,new Set([this]))}else t=new Map([[n,new Set([this])]])}close(){var c;super.close(),(c=t.get(n))===null||c===void 0||c.delete(this)}}:s}function r(n){const o=t?.get(n);o?.size&&(o.forEach(i=>{i.close()}),o.clear())}return{createMicroEventSource:e,clearMicroEventSource:r}}const{createMicroEventSource:cr,clearMicroEventSource:us}=ls();class Ke extends Ui{constructor(e,r){super(e,r),this.active=!1,this.microAppWindow=new Wi,this.patchWith(n=>{this.getSpecialProperties(e),this.patchRouter(e,r,this.microAppWindow),this.windowEffect=Gi(e,this.microAppWindow,this),this.documentEffect=Hi(e,this.microAppWindow,this),this.setMappingPropertiesWithRawDescriptor(this.microAppWindow),this.initStaticGlobalKeys(e,r,this.microAppWindow),n()})}start({umdMode:e,baseroute:r,defaultPage:n,disablePatchRequest:o}){this.active||(this.active=!0,this.initRouteState(n),this.removeHistoryListener=en(this.microAppWindow.__MICRO_APP_NAME__),ie(this.microAppWindow.__MICRO_APP_NAME__)&&(this.microAppWindow.__MICRO_APP_BASE_ROUTE__=this.microAppWindow.__MICRO_APP_BASE_URL__=r),e||this.initGlobalKeysWhenStart(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.__MICRO_APP_URL__,this.microAppWindow,o),++l.activeSandbox===1&&(pn(),rn()),++Ke.activeCount===1&&xi(),Fi())}stop({umdMode:e,keepRouteState:r,destroy:n,clearData:o}){var i;this.active&&(this.recordAndReleaseEffect({umdMode:e,clearData:o,destroy:n},!e||n),this.clearRouteState(r),(i=this.removeHistoryListener)===null||i===void 0||i.call(this),(!e||n)&&(us(this.microAppWindow.__MICRO_APP_NAME__),this.injectedKeys.forEach(s=>{Reflect.deleteProperty(this.microAppWindow,s)}),this.injectedKeys.clear(),this.escapeKeys.forEach(s=>{Reflect.deleteProperty(l.rawWindow,s)}),this.escapeKeys.clear(),this.clearHijackUmdHooks()),--l.activeSandbox===0&&(mn(),nn()),--Ke.activeCount,this.active=!1)}initStaticGlobalKeys(e,r,n){n.__MICRO_APP_ENVIRONMENT__=!0,n.__MICRO_APP_NAME__=e,n.__MICRO_APP_URL__=r,n.__MICRO_APP_PUBLIC_PATH__=lt(r),n.__MICRO_APP_BASE_ROUTE__="",n.__MICRO_APP_WINDOW__=n,n.__MICRO_APP_PRE_RENDER__=!1,n.__MICRO_APP_UMD_MODE__=!1,n.__MICRO_APP_PROXY_WINDOW__=this.proxyWindow,n.__MICRO_APP_SANDBOX__=this,n.__MICRO_APP_SANDBOX_TYPE__="with",n.rawWindow=l.rawWindow,n.rawDocument=l.rawDocument,n.microApp=k(new $r(e),{removeDomScope:G,pureCreateElement:Y,location:n.location,router:ze})}recordAndReleaseEffect(e,r=!1){r?this.resetEffectSnapshot():this.recordEffectSnapshot(),this.releaseGlobalEffect(e)}resetEffectSnapshot(){this.windowEffect.reset(),this.documentEffect.reset(),Ft(this.microAppWindow.microApp)}recordEffectSnapshot(){this.windowEffect.record(),this.documentEffect.record(),Gr(this.microAppWindow.microApp)}rebuildEffectSnapshot(){this.windowEffect.rebuild(),this.documentEffect.rebuild(),qr(this.microAppWindow.microApp)}releaseGlobalEffect({umdMode:e=!1,clearData:r=!1,isPrerender:n=!1,keepAlive:o=!1,destroy:i=!1}){var s,a,c;this.windowEffect.release(!e&&!o&&!n||i),this.documentEffect.release(),(s=this.microAppWindow.microApp)===null||s===void 0||s.clearDataListener(),(a=this.microAppWindow.microApp)===null||a===void 0||a.clearGlobalDataListener(),r&&(_.clearData(this.microAppWindow.__MICRO_APP_NAME__),(c=this.microAppWindow.microApp)===null||c===void 0||c.clearData())}getSpecialProperties(e){var r;U(_.options.plugins)&&(this.commonActionForSpecialProperties(_.options.plugins.global),this.commonActionForSpecialProperties((r=_.options.plugins.modules)===null||r===void 0?void 0:r[e]))}commonActionForSpecialProperties(e){if(le(e))for(const r of e)U(r)&&(le(r.scopeProperties)&&(this.scopeProperties=this.scopeProperties.concat(r.scopeProperties)),le(r.escapeProperties)&&(this.escapeProperties=this.escapeProperties.concat(r.escapeProperties)))}setPreRenderState(e){this.microAppWindow.__MICRO_APP_PRE_RENDER__=e}markUmdMode(e){this.microAppWindow.__MICRO_APP_UMD_MODE__=e}patchWith(e){this.sandboxReady=new Promise(r=>e(r))}setMappingPropertiesWithRawDescriptor(e){let r,n;const o=l.rawWindow;o===o.parent?r=n=this.proxyWindow:(r=o.top,n=o.parent),ee(e,{top:this.createDescriptorForMicroAppWindow("top",r),parent:this.createDescriptorForMicroAppWindow("parent",n)}),Lr.forEach(i=>{H(e,i,this.createDescriptorForMicroAppWindow(i,this.proxyWindow))})}createDescriptorForMicroAppWindow(e,r){const{configurable:n=!0,enumerable:o=!0,writable:i,set:s}=Object.getOwnPropertyDescriptor(l.rawWindow,e)||{writable:!0};return{value:r,configurable:n,enumerable:o,writable:i??!!s}}initGlobalKeysWhenStart(e,r,n,o){n.hasOwnProperty=i=>we.call(n,i)||we.call(l.rawWindow,i),this.setHijackProperty(e,n),o||this.patchRequestApi(e,r,n),this.setScopeProperties(n)}setHijackProperty(e,r){let n,o;ee(r,{eval:{configurable:!0,enumerable:!1,get(){return We(e),n||l.rawWindow.eval},set:i=>{n=i}},Image:{configurable:!0,enumerable:!1,get(){return We(e),o||l.ImageProxy},set:i=>{o=i}}})}patchRequestApi(e,r,n){let o=sr(r),i=ar(r),s=cr(e,r);ee(n,{fetch:{configurable:!0,enumerable:!0,get(){return o},set(a){o=sr(r,a)}},XMLHttpRequest:{configurable:!0,enumerable:!0,get(){return i},set(a){i=ar(r,a)}},EventSource:{configurable:!0,enumerable:!0,get(){return s},set(a){s=cr(e,r,a)}}})}setScopeProperties(e){this.scopeProperties.forEach(r=>{Reflect.set(e,r,e[r])})}patchRouter(e,r,n){const{microLocation:o,microHistory:i}=cs(e,r);ee(n,{location:{configurable:!1,enumerable:!0,get(){return o},set:s=>{l.rawWindow.location=s}},history:{configurable:!0,enumerable:!0,get(){return i}}})}initRouteState(e){an(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location,e)}clearRouteState(e){cn(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.__MICRO_APP_URL__,this.microAppWindow.location,e)}setRouteInfoForKeepAliveApp(){qt(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location)}removeRouteInfoForKeepAliveApp(){_t(this.microAppWindow.__MICRO_APP_NAME__)}patchStaticElement(e){Ht(e,this.microAppWindow.__MICRO_APP_NAME__)}actionsBeforeExecScripts(e,r){this.patchStaticElement(e),this.clearHijackUmdHooks=this.hijackUmdHooks(this.appName,this.microAppWindow,r)}hijackUmdHooks(e,r,n){let o,i,s;return ee(r,{mount:{configurable:!0,get:()=>o,set:a=>{this.active&&S(a)&&!o&&n(o=a,i)}},unmount:{configurable:!0,get:()=>i,set:a=>{this.active&&S(a)&&!i&&n(o,i=a)}},[`micro-app-${e}`]:{configurable:!0,get:()=>s,set:a=>{this.active&&U(a)&&!s&&(s=a,n(s.mount,s.unmount))}}}),()=>{o=i=s=null}}setStaticAppState(e){this.microAppWindow.__MICRO_APP_STATE__=e}}Ke.activeCount=0;function hs(t,e,r,n){const o=l.rawWindow.history,i=W(e),s=i.protocol+"//"+i.host,a=i.pathname+i.search+i.hash,c=r.history;return r.rawReplaceState=c.replaceState,k(c,tn(t,r.location)),ee(c,{scrollRestoration:{configurable:!0,enumerable:!0,get(){return o.scrollRestoration},set(u){o.scrollRestoration=u}}}),Ie(t,a,r.location,"prevent"),sn(t,e,r,i,n,s)}const ds=["Array"],fs=["getComputedStyle","DOMParser","visualViewport","matchMedia","ResizeObserver","IntersectionObserver"],ps=[/animationFrame$/i,/mutationObserver$/i,/height$|width$/i,/offset$/i,/selection$/i,/^range/i,/^screen/i,/^scroll/i,/X$|Y$/],ms=["body","head","html","title"],_s=["childElementCount","children","firstElementChild","firstChild","lastElementChild","activeElement","fullscreenElement","pictureInPictureElement","pointerLockElement","styleSheets"],vs=["append","contains","replaceChildren","createRange","getSelection","elementFromPoint","elementsFromPoint","getAnimations"],gs=["characterSet","compatMode","contentType","designMode","dir","doctype","embeds","fullscreenEnabled","hidden","implementation","lastModified","pictureInPictureEnabled","plugins","readyState","referrer","visibilityState","fonts"],Es=["execCommand","createRange","exitFullscreen","exitPictureInPicture","getElementsByTagNameNS","hasFocus","prepend"],ws=["blob:"],As=window.Worker;function bs(t){try{const e=t instanceof URL?t:new URL(t);return ws.includes(e.protocol)?!0:e.protocol===window.location.protocol&&e.hostname===window.location.hostname&&e.port===window.location.port}catch{return!1}}function Ps(t){let e;try{e=new Blob([t],{type:"application/javascript"})}catch{const o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=new o;i.append(t),e=i.getBlob("application/javascript")}return(window.URL||window.webkitURL).createObjectURL(e)}const lr=new Proxy(As,{construct(t,e){let[r,n]=e;n=n||{};const o=Q();let i=r;if(o){const s=O.get(o);i=z(r,s.url)}if(i&&!bs(i)){const s=`import "${r}";`,a=Ps(s);return n.type="module",new t(a,n)}else return new t(r,n)}});function Rs(t,e,r){return Ss(t,e,r),ys(e,r),Ms(e)}function Ss(t,e,r){const n=l.rawWindow;fs.forEach(o=>{e[o]=Z(n[o],n)}),Object.getOwnPropertyNames(e).filter(o=>(ps.some(i=>{if(i.test(o)&&o in e.parent){if(S(n[o]))e[o]=Z(n[o],n);else{const{configurable:s,enumerable:a}=Object.getOwnPropertyDescriptor(e,o)||{configurable:!0,enumerable:!0};s&&H(e,o,{configurable:s,enumerable:a,get:()=>n[o],set:c=>{n[o]=c}})}return!0}return!1}),at(e[o])&&o in n&&!ds.includes(o)&&H(e[o],Symbol.hasInstance,{configurable:!0,enumerable:!1,value(i){return Zt(i,n[o])||Zt(i,e[o])}}),/^on/.test(o)&&!ui.includes(o))).forEach(o=>{const{enumerable:i,writable:s,set:a}=Object.getOwnPropertyDescriptor(e,o)||{enumerable:!0,writable:!0};try{H(e,o,{enumerable:i,configurable:!0,get:()=>n[o],set:s??!!a?c=>{n[o]=S(c)?c.bind(e):c}:void 0})}catch(c){ge(c,t)}}),r.escapeProperties.forEach(o=>{let i=e[o];H(e,o,{enumerable:!0,configurable:!0,get(){return i??Z(n[o],n)},set(s){i=s}})})}function ys(t,e){const r=l.rawWindow,n=new Set;Object.defineProperty(t,"Worker",{value:lr,configurable:!0,writable:!0});const o=new Proxy(t,{get:(i,s)=>s==="Worker"?lr:s==="location"?e.proxyLocation:ne(Lr,s)?o:n.has(s)?Reflect.get(i,s):ne(e.escapeProperties,s)&&!Reflect.get(i,s)?Z(Reflect.get(r,s),r):Z(Reflect.get(i,s),i),set:(i,s,a)=>s==="location"?Reflect.set(r,s,a):(Reflect.has(i,s)||n.add(s),Reflect.set(i,s,a),!0),has:(i,s)=>s in i,deleteProperty:(i,s)=>Reflect.has(i,s)?Reflect.deleteProperty(i,s):!0});e.proxyWindow=o}function Ms(t){const{rawWindow:e,rawAddEventListener:r,rawRemoveEventListener:n,rawDispatchEvent:o}=l,i=new Map,s=new Map;function a(b){var M;let D=[];return Array.isArray((M=_?.options)===null||M===void 0?void 0:M.escapeIframeWindowEvents)&&(D=_.options.escapeIframeWindowEvents),ci.filter(P=>!D.includes(P)).includes(b)?t:e}t.addEventListener=function(b,M,D){const g=i.get(b);g?g.add(M):i.set(b,new Set([M])),M&&(M.__MICRO_APP_MARK_OPTIONS__=D),r.call(a(b),b,M,D)},t.removeEventListener=function(b,M,D){const g=i.get(b);g?.size&&g.has(M)&&g.delete(M),n.call(a(b),b,M,D)},t.dispatchEvent=function(b){return o.call(a(b?.type),b)};const c=()=>{s.clear()};return{reset:c,record:()=>{i.forEach((b,M)=>{if(b.size){const D=s.get(M)||[];s.set(M,new Set([...D,...b]))}})},rebuild:()=>{s.forEach((b,M)=>{for(const D of b)t.addEventListener(M,D,D?.__MICRO_APP_MARK_OPTIONS__)}),c()},release:()=>{i.size&&(i.forEach((b,M)=>{for(const D of b)n.call(a(M),M,D)}),i.clear())}}}function Os(t,e,r){return Ds(t,e),Cs(t,e,r),Is(t,e)}function re(t,e){var r;return!((r=_?.options)===null||r===void 0)&&r.disableIframeRootDocument?e:t}function Ds(t,e){const r=l.rawDocument,n=e.Document,o=e.document,i=n.prototype.createElement,s=n.prototype.createElementNS,a=n.prototype.createTextNode,c=n.prototype.createDocumentFragment,u=n.prototype.createComment,d=n.prototype.querySelector,A=n.prototype.querySelectorAll,b=n.prototype.getElementById,M=n.prototype.getElementsByClassName,D=n.prototype.getElementsByTagName,g=n.prototype.getElementsByName,P=n.prototype.elementFromPoint,w=n.prototype.caretRangeFromPoint;n.prototype.caretRangeFromPoint=function(p,m){const R=P.call(r,p,m),T=w.call(r,p,m);return F(R,t),T},n.prototype.createElement=function(p,m){let R=i.call(re(this,r),p,m);return Fo(R)&&(R=i.call(r,p,m)),F(R,t)},n.prototype.createElementNS=function(p,m,R){const T=s.call(re(this,r),p,m,R);return F(T,t)},n.prototype.createTextNode=function(p){const m=a.call(re(this,r),p);return F(m,t)},n.prototype.createDocumentFragment=function(){const p=c.call(re(this,r));return F(p,t)},n.prototype.createComment=function(p){const m=u.call(re(this,r),p);return F(m,t)};function v(E){return Tt(t),o===E?r:E}function h(E){var p,m;const R=v(this);if(E==="body"&&((p=_?.options)===null||p===void 0?void 0:p.inheritBaseBody)!==!0)return this.body;if(!E||ye(E)||r!==R)return d.call(R,E);const T=(m=O.get(t))===null||m===void 0?void 0:m.querySelector(E);return T||E==="base"?T:d.call(o,E)}function f(E){var p,m;const R=v(this);if(!E||ye(E)||r!==R)return A.call(R,E);const T=(m=(p=O.get(t))===null||p===void 0?void 0:p.querySelectorAll(E))!==null&&m!==void 0?m:[];return T.length||E==="base"?T:A.call(o,E)}n.prototype.querySelector=h,n.prototype.querySelectorAll=f,n.prototype.getElementById=function(p){const m=v(this);if(pe(p))return b.call(m,p);try{return h.call(re(this,r),`#${p}`)}catch{return b.call(m,p)}},n.prototype.getElementsByClassName=function(p){const m=v(this);if(pe(p))return M.call(m,p);try{return f.call(re(this,r),`.${p}`)}catch{return M.call(m,p)}},n.prototype.getElementsByTagName=function(p){const m=v(re(this,r));if(ye(p)||pe(p))return D.call(m,p);if(/^script$/i.test(p))return D.call(o,p);try{return f.call(re(this,r),p)}catch{return D.call(m,p)}},n.prototype.getElementsByName=function(p){const m=v(re(this,r));if(pe(p))return g.call(m,p);try{return f.call(re(this,r),`[name=${p}]`)}catch{return g.call(m,p)}}}function Cs(t,e,r){const n=l.rawDocument,o=e.Document,i=e.document,s=(c,u)=>{const{enumerable:d}=Object.getOwnPropertyDescriptor(o.prototype,c)||{enumerable:!0};return{configurable:!0,enumerable:d,get:u}},a=()=>{const c={};return[["documentURI",()=>r.proxyLocation.href],["URL",()=>r.proxyLocation.href],["documentElement",()=>n.documentElement],["scrollingElement",()=>n.scrollingElement],["forms",()=>o.prototype.querySelectorAll.call(i,"form")],["images",()=>o.prototype.querySelectorAll.call(i,"img")],["links",()=>o.prototype.querySelectorAll.call(i,"a")],["microAppElement",()=>{var d;return(d=O.get(t))===null||d===void 0?void 0:d.container}],["__MICRO_APP_NAME__",()=>t]].forEach(d=>{c[d[0]]=s(d[0],d[1])}),_s.forEach(d=>{c[d]=s(d,()=>n[d])}),vs.forEach(d=>{c[d]=s(d,()=>Z(n[d],n,"DOCUMENT"))}),gs.forEach(d=>{c[d]=s(d,()=>n[d])}),Es.forEach(d=>{c[d]=s(d,()=>Z(n[d],n,"DOCUMENT"))}),c};ee(o.prototype,a()),ms.forEach(c=>{H(i,c,{enumerable:!0,configurable:!0,get:()=>{var u,d;return Tt(t),c==="body"&&((u=_?.options)===null||u===void 0?void 0:u.inheritBaseBody)!==!0&&((d=r.options.container)===null||d===void 0?void 0:d.querySelector("micro-app-body"))||n[c]},set:u=>{n[c]=u}})})}function Is(t,e){const{rawDocument:r,rawAddEventListener:n,rawRemoveEventListener:o,rawDispatchEvent:i}=l,s=new Map,a=new Map;let c=null,u=null;const d=e.Document,A=e.document;function b(v,h){return hi.includes(v)?h:r}d.prototype.addEventListener=function(v,h,f){const E=S(h)?h.__MICRO_APP_BOUND_FUNCTION__=h.__MICRO_APP_BOUND_FUNCTION__||h.bind(this):h,p=s.get(v);p?p.add(h):s.set(v,new Set([h])),h&&(h.__MICRO_APP_MARK_OPTIONS__=f),n.call(b(v,this),v,E,f)},d.prototype.removeEventListener=function(v,h,f){const E=s.get(v);E?.size&&E.has(h)&&E.delete(h);const p=h?.__MICRO_APP_BOUND_FUNCTION__||h;o.call(b(v,this),v,p,f)},d.prototype.dispatchEvent=function(v){return i.call(b(v?.type,this),v)};function M(v){return v==="onclick"?h=>{S(c)&&o.call(r,"click",c,!1),S(h)?(c=h.bind(A),n.call(r,"click",c,!1)):c=h}:h=>{r[v]=S(h)?h.bind(A):h}}Object.getOwnPropertyNames(d.prototype).filter(v=>/^on/.test(v)&&!di.includes(v)).forEach(v=>{const{enumerable:h,writable:f,set:E}=Object.getOwnPropertyDescriptor(d.prototype,v)||{enumerable:!0,writable:!0};try{H(d.prototype,v,{enumerable:h,configurable:!0,get:()=>v==="onclick"?c:r[v],set:f??!!E?M(v):void 0})}catch(p){ge(p,t)}});const D=()=>{a.clear(),u=null};return{reset:D,record:()=>{u=c||u,s.forEach((v,h)=>{if(v.size){const f=a.get(h)||[];a.set(h,new Set([...f,...v]))}})},rebuild:()=>{u&&!c&&(A.onclick=u),a.forEach((v,h)=>{for(const f of v)A.addEventListener(h,f,f?.__MICRO_APP_MARK_OPTIONS__)}),D()},release:()=>{S(c)&&o.call(r,"click",c),c=null,s.size&&(s.forEach((v,h)=>{for(const f of v)o.call(b(h,A),h,f?.__MICRO_APP_BOUND_FUNCTION__||f)}),s.clear())}}}function Ls(t,e,r,n){Ts(t,r,n),xs(e,r,t)}function Ts(t,e,r){const n=l.rawRootElement,o=l.rawRootNode,i=l.rawDocument,s=e.document,a=e.Node,c=e.Element,u=e.DocumentFragment,d=a.prototype.appendChild,A=a.prototype.insertBefore,b=a.prototype.replaceChild,M=a.prototype.removeChild,D=c.prototype.append,g=c.prototype.prepend,P=u.prototype.append,w=u.prototype.prepend,v=c.prototype.insertAdjacentElement,h=a.prototype.cloneNode,f=Object.getOwnPropertyDescriptor(c.prototype,"innerHTML"),E=Object.getOwnPropertyDescriptor(a.prototype,"parentNode"),p=Object.getOwnPropertyDescriptor(a.prototype,"ownerDocument"),m=L=>(Se(L)||Bo(L))&&L.__PURE_ELEMENT__,R=L=>L===r.microHead?i.head:L===r.microBody?i.body:L;a.prototype.appendChild=function(y){return F(y,t),m(y)?d.call(this,y):o.prototype.appendChild.call(R(this),y)},a.prototype.insertBefore=function(y,C){return F(y,t),m(y)?A.call(this,y,C):o.prototype.insertBefore.call(R(this),y,C)},a.prototype.replaceChild=function(y,C){return F(y,t),m(y)?b.call(this,y,C):o.prototype.replaceChild.call(R(this),y,C)},a.prototype.removeChild=function(y){return m(y)||this.contains(y)?M.call(this,y):o.prototype.removeChild.call(R(this),y)},u.prototype.append=c.prototype.append=function(...y){let C=0,Ee=!1;for(;C<y.length;)y[C]=De(y[C])?y[C]:s.createTextNode(y[C]),m(y[C])&&(Ee=!0),C++;return Ee?(ke(this)?P:D).call(this,...y):n.prototype.append.call(R(this),...y)},u.prototype.prepend=c.prototype.prepend=function(...y){let C=0,Ee=!1;for(;C<y.length;)y[C]=De(y[C])?y[C]:s.createTextNode(y[C]),m(y[C])&&(Ee=!0),C++;return Ee?(ke(this)?w:g).call(this,...y):n.prototype.prepend.call(R(this),...y)},c.prototype.insertAdjacentElement=function(y,C){return F(C,t),m(C)?v.call(this,y,C):n.prototype.insertAdjacentElement.call(R(this),y,C)},H(a.prototype,"baseURI",{configurable:!0,enumerable:!0,get(){return r.proxyWindow.location.href}}),H(a.prototype,"ownerDocument",{configurable:!0,enumerable:!0,get(){var L;return this.__PURE_ELEMENT__||this===s?(L=p.get)===null||L===void 0?void 0:L.call(this):s}}),H(a.prototype,"parentNode",Qr(t,E)),a.prototype.getRootNode=function(){return s},a.prototype.cloneNode=function(y){const C=h.call(this,y);return F(C,t)},H(c.prototype,"innerHTML",{configurable:!0,enumerable:!0,get(){var L;return(L=f.get)===null||L===void 0?void 0:L.call(this)},set(L){var y;(y=f.set)===null||y===void 0||y.call(this,L),Array.from(this.children).forEach(C=>{he(C)&&F(C,t)})}});const T=new Proxy(e.Image,{construct(L,y){const C=new L(...y);return F(C,t),C}});H(e,"Image",{configurable:!0,writable:!0,value:T})}function xs(t,e,r){const n=e.Element,o=n.prototype.setAttribute;n.prototype.setAttribute=function(a,c){var u;if(/^micro-app(-\S+)?/i.test(this.tagName)&&a==="data"&&this.setAttribute!==n.prototype.setAttribute)this.setAttribute(a,c);else{const d=(u=_?.options)===null||u===void 0?void 0:u.aHrefResolver;if(a==="href"&&/^a$/i.test(this.tagName)&&typeof d=="function")c=d(c,r,t);else if((a==="src"||a==="srcset")&&/^(img|script|video|audio|source|embed)$/i.test(this.tagName)||a==="href"&&/^(link|image)$/i.test(this.tagName)||a==="href"&&/^(a)$/i.test(this.tagName)&&!/^#/.test(c)){let A=t;st&&a==="href"&&/^a$/i.test(this.tagName)&&S(_.options.excludeAssetFilter)&&_.options.excludeAssetFilter(c)&&(A=document.baseURI),c=z(c,A)}o.call(this,a,c)}},[[e.HTMLImageElement.prototype,"src"],[e.HTMLScriptElement.prototype,"src"],[e.HTMLLinkElement.prototype,"href"],[e.SVGImageElement.prototype,"href"]].forEach(([s,a])=>{const{enumerable:c,configurable:u,get:d,set:A}=Object.getOwnPropertyDescriptor(s,a)||{enumerable:!0,configurable:!0};H(s,a,{enumerable:c,configurable:u,get:function(){return d?.call(this)},set:function(b){A?.call(this,z(b,t))}})})}class Ve{constructor(e,r,n){this.active=!1,this.escapeProperties=[],this.updateIframeBase=()=>{var s;(s=this.baseElement)===null||s===void 0||s.setAttribute("href",W(this.url).origin+this.proxyLocation.pathname)},this.appName=e,this.url=r,this.options=n;const o=l.rawWindow.location,i=o.protocol+"//"+o.host;this.deleteIframeElement=this.createIframeElement(e,i+o.pathname,n),this.microAppWindow=this.iframe.contentWindow,this.patchIframe(this.microAppWindow,s=>{this.microAppWindow=this.iframe.contentWindow,this.createIframeTemplate(this.microAppWindow),this.getSpecialProperties(e),this.proxyLocation=hs(e,r,this.microAppWindow,i),this.windowEffect=Rs(e,this.microAppWindow,this),this.documentEffect=Os(e,this.microAppWindow,this),Ls(e,r,this.microAppWindow,this),this.initStaticGlobalKeys(e,r,this.microAppWindow),s()})}createIframeElement(e,r,n){this.iframe=Y("iframe");const o=Object.assign(Object.assign({},n?.attrs),{id:e,src:_.options.iframeSrc||r,style:"display: none","powered-by":"micro-app"});return Object.keys(o).forEach(i=>this.iframe.setAttribute(i,o[i])),l.rawDocument.body.appendChild(this.iframe),()=>te(()=>{var i,s;(s=(i=this.iframe)===null||i===void 0?void 0:i.parentNode)===null||s===void 0||s.removeChild(this.iframe),this.iframe=null})}start({baseroute:e,defaultPage:r,disablePatchRequest:n}){this.active||(this.active=!0,this.initRouteState(r),this.removeHistoryListener=en(this.microAppWindow.__MICRO_APP_NAME__),ie(this.microAppWindow.__MICRO_APP_NAME__)&&(this.microAppWindow.__MICRO_APP_BASE_ROUTE__=this.microAppWindow.__MICRO_APP_BASE_URL__=e),n||this.createIframeBase(),++l.activeSandbox===1&&(pn(),rn()),++Ve.activeCount)}stop({umdMode:e,keepRouteState:r,destroy:n,clearData:o}){var i;this.active&&(this.recordAndReleaseEffect({clearData:o},!e||n),this.clearRouteState(r),(i=this.removeHistoryListener)===null||i===void 0||i.call(this),(!e||n)&&(this.deleteIframeElement(),this.clearHijackUmdHooks()),--l.activeSandbox===0&&(mn(),nn()),--Ve.activeCount,this.active=!1)}initStaticGlobalKeys(e,r,n){n.__MICRO_APP_ENVIRONMENT__=!0,n.__MICRO_APP_NAME__=e,n.__MICRO_APP_URL__=r,n.__MICRO_APP_PUBLIC_PATH__=lt(r),n.__MICRO_APP_BASE_ROUTE__="",n.__MICRO_APP_WINDOW__=n,n.__MICRO_APP_PRE_RENDER__=!1,n.__MICRO_APP_UMD_MODE__=!1,n.__MICRO_APP_PROXY_WINDOW__=this.proxyWindow,n.__MICRO_APP_SANDBOX__=this,n.__MICRO_APP_SANDBOX_TYPE__="iframe",n.rawWindow=l.rawWindow,n.rawDocument=l.rawDocument,n.microApp=k(new $r(e),{removeDomScope:G,pureCreateElement:Y,location:this.proxyLocation,router:ze})}recordAndReleaseEffect(e,r=!1){r?this.resetEffectSnapshot():this.recordEffectSnapshot(),this.releaseGlobalEffect(e)}resetEffectSnapshot(){var e,r;(e=this.windowEffect)===null||e===void 0||e.reset(),(r=this.documentEffect)===null||r===void 0||r.reset(),Ft(this.microAppWindow.microApp)}recordEffectSnapshot(){var e,r;(e=this.windowEffect)===null||e===void 0||e.record(),(r=this.documentEffect)===null||r===void 0||r.record(),Gr(this.microAppWindow.microApp)}rebuildEffectSnapshot(){var e,r;(e=this.windowEffect)===null||e===void 0||e.rebuild(),(r=this.documentEffect)===null||r===void 0||r.rebuild(),qr(this.microAppWindow.microApp)}releaseGlobalEffect({clearData:e=!1}){var r,n,o,i,s;(r=this.windowEffect)===null||r===void 0||r.release(),(n=this.documentEffect)===null||n===void 0||n.release(),(o=this.microAppWindow.microApp)===null||o===void 0||o.clearDataListener(),(i=this.microAppWindow.microApp)===null||i===void 0||i.clearGlobalDataListener(),e&&(_.clearData(this.microAppWindow.__MICRO_APP_NAME__),(s=this.microAppWindow.microApp)===null||s===void 0||s.clearData())}setPreRenderState(e){this.microAppWindow.__MICRO_APP_PRE_RENDER__=e}markUmdMode(e){this.microAppWindow.__MICRO_APP_UMD_MODE__=e}patchIframe(e,r){const n=e.document;this.sandboxReady=new Promise(o=>{(function i(){setTimeout(()=>{try{e.document===n?i():(e.stop(),r(o))}catch{i()}},0)})()})}createIframeTemplate(e){const r=e.document;Qo(r);const n=r.createElement("html");n.innerHTML="<head></head><body></body>",r.appendChild(n),this.microBody=r.body,this.microHead=r.head}createIframeBase(){this.baseElement=Y("base"),this.updateIframeBase(),this.microHead.appendChild(this.baseElement)}getSpecialProperties(e){var r;U(_.options.plugins)&&(this.commonActionForSpecialProperties(_.options.plugins.global),this.commonActionForSpecialProperties((r=_.options.plugins.modules)===null||r===void 0?void 0:r[e]))}commonActionForSpecialProperties(e){if(le(e))for(const r of e)U(r)&&le(r.escapeProperties)&&(this.escapeProperties=this.escapeProperties.concat(r.escapeProperties))}initRouteState(e){an(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location,e)}clearRouteState(e){cn(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.__MICRO_APP_URL__,this.microAppWindow.location,e)}setRouteInfoForKeepAliveApp(){qt(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location)}removeRouteInfoForKeepAliveApp(){_t(this.microAppWindow.__MICRO_APP_NAME__)}patchStaticElement(e){Ht(e,this.microAppWindow.__MICRO_APP_NAME__)}actionsBeforeExecScripts(e,r){this.patchStaticElement(e),this.clearHijackUmdHooks=this.hijackUmdHooks(this.appName,this.microAppWindow,r)}hijackUmdHooks(e,r,n){let o,i,s;return ee(r,{mount:{configurable:!0,get:()=>o,set:a=>{this.active&&S(a)&&!o&&n(o=a,i)}},unmount:{configurable:!0,get:()=>i,set:a=>{this.active&&S(a)&&!i&&n(o,i=a)}},[`micro-app-${e}`]:{configurable:!0,get:()=>s,set:a=>{this.active&&U(a)&&!s&&(s=a,n(s.mount,s.unmount))}}}),()=>{o=i=s=null}}setStaticAppState(e){this.microAppWindow.__MICRO_APP_STATE__=e}}Ve.activeCount=0;const O=new Map;class ln{constructor({name:e,url:r,container:n,scopecss:o,useSandbox:i,inline:s,iframe:a,ssrUrl:c,isPrefetch:u,prefetchLevel:d,routerMode:A,attrs:b}){this.state=j.CREATED,this.keepAliveState=null,this.loadSourceLevel=0,this.umdHookMount=null,this.umdHookUnmount=null,this.umdMode=!1,this.sandBox=null,this.fiber=!1,this.isReloading=!1,O.set(e,this),this.name=e,this.url=r,this.useSandbox=i,this.scopecss=this.useSandbox&&o,this.attrs=b,this.iframe=a??!1,this.inline=this.getInlineModeState(s),this.isReloading=!1,this.routerMode=A||$e,this.container=n??null,this.ssrUrl=c??"",this.isPrefetch=u??!1,this.isPrerender=d===3,this.prefetchLevel=d,this.source={html:null,links:new Set,scripts:new Set},this.loadSourceCode(),this.createSandbox()}loadSourceCode(){this.setAppState(j.LOADING),Nt.getInstance().run(this,Ii)}onLoad({html:e,defaultPage:r,routerMode:n,baseroute:o,disablePatchRequest:i}){var s;if(++this.loadSourceLevel===2){if(this.source.html=e,this.isUnmounted())return;if(!this.isPrefetch)de(this.container).mount(this);else if(this.isPrerender){const a=Y("div");a.setAttribute("prerender","true"),(s=this.sandBox)===null||s===void 0||s.setPreRenderState(!0),this.mount({container:a,inline:this.inline,fiber:!0,defaultPage:r||"",disablePatchRequest:i??!1,routerMode:n,baseroute:o||""})}}}onLoadError(e){this.loadSourceLevel=-1,this.isUnmounted()||(this.onerror(e),this.setAppState(j.LOAD_FAILED))}mount({container:e,inline:r,routerMode:n,defaultPage:o,baseroute:i,disablePatchRequest:s,fiber:a}){if(this.loadSourceLevel!==2)return this.container=e,this.isPrerender=!1,se(this,"statechange",{appState:j.LOADING}),this.setAppState(j.LOADING);this.createSandbox();const c=()=>{var u,d,A,b,M,D,g;if(this.setAppState(j.BEFORE_MOUNT),this.isPrerender&&xo(this.container)&&this.container.hasAttribute("prerender"))this.container=this.cloneContainer(e,this.container,!1),(u=this.sandBox)===null||u===void 0||u.rebuildEffectSnapshot(),(d=this.preRenderEvents)===null||d===void 0||d.forEach(P=>P()),this.isPrerender=!1,this.preRenderEvents=null,ze.attachToURL(this.name),(A=this.sandBox)===null||A===void 0||A.setPreRenderState(!1);else{this.container=e,this.inline=this.getInlineModeState(r),this.fiber=a,this.routerMode=n;const P=()=>{fe(this.container,this.name,N.BEFOREMOUNT)};if(this.isPrerender?((b=this.preRenderEvents)!==null&&b!==void 0?b:this.preRenderEvents=[]).push(P):P(),this.setAppState(j.MOUNTING),se(this,"statechange",{appState:j.MOUNTING}),this.cloneContainer(this.container,this.source.html,!this.umdMode),(M=this.sandBox)===null||M===void 0||M.start({umdMode:this.umdMode,baseroute:i,defaultPage:o,disablePatchRequest:s}),!this.umdMode)(D=this.sandBox)===null||D===void 0||D.actionsBeforeExecScripts(this.container,(w,v)=>{var h;if(!this.umdMode&&!this.isUnmounted()&&(this.umdHookMount=S(w)?w:null,this.umdHookUnmount=S(v)?v:null,S(this.umdHookMount)&&S(this.umdHookUnmount))){(h=this.sandBox)===null||h===void 0||h.markUmdMode(this.umdMode=!0);try{this.getAppState()===j.MOUNTED?this.umdHookMount(_.getData(this.name,!0)):this.handleMounted(this.umdHookMount(_.getData(this.name,!0)))}catch(f){I(`An error occurred when mount 
`,this.name,f)}}}),bi(this,w=>{!this.umdMode&&w===!0&&this.handleMounted()});else{(g=this.sandBox)===null||g===void 0||g.rebuildEffectSnapshot();try{this.handleMounted(this.umdHookMount(_.getData(this.name,!0)))}catch(w){I(`An error occurred when mount 
`,this.name,w)}}}};this.sandBox?this.sandBox.sandboxReady.then(()=>!this.isUnmounted()&&c()):c()}handleMounted(e){var r,n;const o=()=>{const i=()=>this.actionsAfterMounted();At(e)?e.then(i).catch(s=>{I(`An error occurred in window.mount 
`,this.name,s),i()}):i()};this.isPrerender?((r=this.preRenderEvents)===null||r===void 0||r.push(o),(n=this.sandBox)===null||n===void 0||n.recordAndReleaseEffect({isPrerender:!0})):o()}actionsAfterMounted(){var e;this.isUnmounted()||(this.setAppState(j.MOUNTED),Jt(this.getMicroAppGlobalHook(Pe.ONMOUNT),this.name,Pe.ONMOUNT,_.getData(this.name,!0)),se(this,"statechange",{appState:j.MOUNTED}),se(this,"mounted"),fe(this.container,this.name,N.MOUNTED),this.isHidden()&&((e=this.sandBox)===null||e===void 0||e.recordAndReleaseEffect({keepAlive:!0})))}unmount({destroy:e,clearData:r,keepRouteState:n,unmountcb:o}){var i;e=e||this.state===j.LOAD_FAILED,this.setAppState(j.UNMOUNT);try{this.handleUnmounted(e,r,n,o,(i=this.umdHookUnmount)===null||i===void 0?void 0:i.call(this,_.getData(this.name,!0)))}catch(s){I(`An error occurred when unmount 
`,this.name,s)}}handleUnmounted(e,r,n,o,i){se(this,"statechange",{appState:j.UNMOUNT}),se(this,"unmount"),Jt(this.getMicroAppGlobalHook(Pe.ONUNMOUNT),this.name,Pe.ONUNMOUNT);const s=()=>this.actionsAfterUnmounted({destroy:e,clearData:r,keepRouteState:n,unmountcb:o});At(i)?(G(),i.then(s).catch(a=>{I(`An error occurred in window.unmount 
`,this.name,a),s()})):s()}actionsAfterUnmounted({destroy:e,clearData:r,keepRouteState:n,unmountcb:o}){var i;this.umdMode&&this.container&&!e&&this.cloneContainer(this.source.html,this.container,!1);const s=this.isReloading?!1:r||e;(i=this.sandBox)===null||i===void 0||i.stop({umdMode:this.umdMode,keepRouteState:n&&!e,destroy:e,clearData:s}),fe(this.container,this.name,N.UNMOUNT),this.clearOptions(e),o?.()}clearOptions(e){var r,n;this.isPrerender=!1,this.preRenderEvents=null,this.setKeepAliveState(null),this.container?(this.container.innerHTML="",this.container=null):this.umdMode||(n=(r=this.sandBox)===null||r===void 0?void 0:r.deleteIframeElement)===null||n===void 0||n.call(r),this.iframe&&!this.umdMode&&(this.sandBox=null),e&&this.actionsForCompletelyDestroy(),G()}actionsForCompletelyDestroy(){var e,r;(r=(e=this.sandBox)===null||e===void 0?void 0:e.deleteIframeElement)===null||r===void 0||r.call(e),J.script.deleteInlineInfo(this.source.scripts),O.delete(this.name)}hiddenKeepAliveApp(e){var r,n;this.setKeepAliveState(Be.KEEP_ALIVE_HIDDEN),se(this,"appstate-change",{appState:"afterhidden"}),fe(this.container,this.name,N.AFTERHIDDEN),X(this.name)&&((r=this.sandBox)===null||r===void 0||r.removeRouteInfoForKeepAliveApp()),this.loadSourceLevel!==2?de(this.container).unmount():(this.container=this.cloneContainer(Y("div"),this.container,!1),(n=this.sandBox)===null||n===void 0||n.recordAndReleaseEffect({keepAlive:!0})),e?.()}showKeepAliveApp(e){var r,n;const o=this.container;this.container=e,(r=this.sandBox)===null||r===void 0||r.rebuildEffectSnapshot(),se(this,"appstate-change",{appState:"beforeshow"}),fe(e,this.name,N.BEFORESHOW),this.setKeepAliveState(Be.KEEP_ALIVE_SHOW),this.cloneContainer(this.container,o,!1),X(this.name)&&((n=this.sandBox)===null||n===void 0||n.setRouteInfoForKeepAliveApp()),se(this,"appstate-change",{appState:"aftershow"}),fe(this.container,this.name,N.AFTERSHOW)}onerror(e){se(this,"statechange",{appState:j.LOAD_FAILED}),fe(this.container,this.name,N.ERROR,e)}parseHtmlString(e){var r;const n=!((r=this.sandBox)===null||r===void 0)&&r.proxyWindow?this.sandBox.proxyWindow.DOMParser:l.rawWindow.DOMParser;return new n().parseFromString(e,"text/html").body}cloneContainer(e,r,n){return r&&e&&(e.innerHTML="",Array.from(n?this.parseHtmlString(r.innerHTML).childNodes:r.childNodes).forEach(o=>{e.appendChild(o)})),e}createSandbox(){if(this.useSandbox&&!this.sandBox){const e={attrs:this.attrs,container:this.container};this.sandBox=this.iframe?new Ve(this.name,this.url,e):new Ke(this.name,this.url)}}setAppState(e){var r;this.state=e,(r=this.sandBox)===null||r===void 0||r.setStaticAppState(e)}getAppState(){return this.state}setKeepAliveState(e){this.keepAliveState=e}getKeepAliveState(){return this.keepAliveState}isUnmounted(){return j.UNMOUNT===this.state}isHidden(){return Be.KEEP_ALIVE_HIDDEN===this.keepAliveState}getMicroAppGlobalHook(e){var r,n;const o=(n=(r=this.sandBox)===null||r===void 0?void 0:r.proxyWindow)===null||n===void 0?void 0:n[e];return S(o)?o:null}querySelector(e){return this.container?l.rawElementQuerySelector.call(this.container,e):null}querySelectorAll(e){return this.container?l.rawElementQuerySelectorAll.call(this.container,e):[]}getInlineModeState(e){var r;return(r=this.iframe||e)!==null&&r!==void 0?r:!1}}function be(t){var e,r;return(r=(e=O.get(t))===null||e===void 0?void 0:e.iframe)!==null&&r!==void 0?r:!1}const ue=new WeakMap;function un(t){var e;return(e=ue.get(t))!==null&&e!==void 0?e:t}function hn(t,e){if(ue.has(t))return ue.get(t);if(Er(t)){if(t.hasAttribute("exclude")){const r=document.createComment("style element with exclude attribute ignored by micro-app");return ue.set(t,r),r}else if(e.scopecss&&!t.hasAttribute("ignore"))return dt(t,e);return t}else if(Lo(t)){if(t.hasAttribute("exclude")||Ut(t.getAttribute("href"),e.name)){const i=document.createComment("link element with exclude attribute ignored by micro-app");return ue.set(t,i),i}else if(t.hasAttribute("ignore")||Wt(t.getAttribute("href"),e.name)||t.href&&S(_.options.excludeAssetFilter)&&_.options.excludeAssetFilter(t.href))return t;const{address:r,linkInfo:n,replaceComment:o}=Sr(t,null,e,!0);if(r&&n){const i=ii(r,e,n,t);return ue.set(t,i),i}else if(o)return ue.set(t,o),o;return t}else if(Se(t)){if(t.src&&S(_.options.excludeAssetFilter)&&_.options.excludeAssetFilter(t.src))return t;const{replaceComment:r,address:n,scriptInfo:o}=Wr(t,null,e,!0)||{};if(n&&o){const i=o.isExternal?Pi(n,e,o,t):Ri(n,e,o);return ue.set(t,i),i}else if(r)return ue.set(t,r),r;return t}return t}function dn(t,e,r,n,o){const i=fn(r,n,t);if(i){if(!be(t.name)&&et(i)&&e!==l.rawRemoveChild){const s=Object.getOwnPropertyDescriptor(n,"parentNode");(!s||s.configurable)&&!n.__MICRO_APP_HAS_DPN__&&ee(n,{parentNode:{configurable:!0,get(){var a,c;const u=l.rawParentNodeDesc.get.call(this);return et(u)&&t.container?((c=(a=_.options).getRootElementParentNode)===null||c===void 0?void 0:c.call(a,this,t.name))||document.body:u}},__MICRO_APP_HAS_DPN__:{configurable:!0,get:()=>!0}})}if(o&&!i.contains(o)){if(e===l.rawInsertBefore&&r.contains(o)){const s=Array.from(r.childNodes).indexOf(o);if(i.childNodes[s])return Ze(e,i,n,i.childNodes[s],t)}return l.rawAppendChild.call(i,n)}else if(e===l.rawRemoveChild&&!i.contains(n))return r.contains(n)?e.call(n.parentElement,n):n;return Ze(e,i,n,o,t)}return Ze(e,r,n,o,t)}function fn(t,e,r){if(r){if(t===document.head)return r.iframe&&Se(e)?r.sandBox.microHead:r.querySelector("micro-app-head");if(t===document.body||t===document.body.parentNode)return r.iframe&&Se(e)?r.sandBox.microBody:r.querySelector("micro-app-body");if(r.iframe&&Se(e))return r.sandBox.microBody}return null}function Ze(t,e,r,n,o){return Ns(t)?(o?.iframe&&Se(r)&&(t===l.rawFragmentAppend?t=l.rawAppend:t===l.rawFragmentPrepend&&(t=l.rawPrepend)),t.call(e,r)):t.call(e,r,n)}function Ns(t){return t===l.rawAppend||t===l.rawPrepend||t===l.rawFragmentAppend||t===l.rawFragmentPrepend}function Bs(t,e){var r;if(he(e)){if(/^(img|script)$/i.test(e.tagName))e.hasAttribute("src")&&l.rawSetAttribute.call(e,"src",z(e.getAttribute("src"),t.url)),e.hasAttribute("srcset")&&l.rawSetAttribute.call(e,"srcset",z(e.getAttribute("srcset"),t.url));else if(/^(link|image)$/i.test(e.tagName)&&e.hasAttribute("href")||/^(a)$/i.test(e.tagName)&&e.hasAttribute("href")&&!/^#/.test(e.getAttribute("href")||"")){const n=(r=_?.options)===null||r===void 0?void 0:r.aHrefResolver,o=e.getAttribute("href");let i;/^(a)$/i.test(e.tagName)&&typeof n=="function"?i=n(o,t.name,t.url):i=z(o,t.url),l.rawSetAttribute.call(e,"href",i)}}}function Le(t,e,r,n){const o=Q();if(De(e)&&!e.__PURE_ELEMENT__&&(e.__MICRO_APP_NAME__||o)){F(e,e.__MICRO_APP_NAME__||o);const i=O.get(e.__MICRO_APP_NAME__);if(i?.container)return Er(e)&&t.getRootNode()instanceof ShadowRoot&&e.setAttribute("ignore","true"),Bs(i,e),dn(i,n,t,hn(e,i),r&&un(r))}return Ze(n,t,e,r)}function pn(){Us();const t=l.rawRootElement,e=l.rawRootNode,r=l.rawDocumentFragment;e.prototype.appendChild=function(s){return Le(this,s,null,l.rawAppendChild)},e.prototype.insertBefore=function(s,a){return Le(this,s,a,l.rawInsertBefore)},e.prototype.replaceChild=function(s,a){return Le(this,s,a,l.rawReplaceChild)},e.prototype.removeChild=function(s){if(s?.__MICRO_APP_NAME__){const a=O.get(s.__MICRO_APP_NAME__);if(a?.container)return dn(a,l.rawRemoveChild,this,un(s));try{return l.rawRemoveChild.call(this,s)}catch{return s?.parentNode&&l.rawRemoveChild.call(s.parentNode,s)}}return l.rawRemoveChild.call(this,s)},r.prototype.append=t.prototype.append=function(...s){let a=0;for(;a<s.length;){let c=s[a];c=De(c)?c:l.rawCreateTextNode.call(l.rawDocument,c),Le(this,Re(c),null,ke(this)?l.rawFragmentAppend:l.rawAppend),a++}},r.prototype.prepend=t.prototype.prepend=function(...s){let a=s.length,c=l.rawPrepend;for((ke(this)||Uo(this))&&(c=l.rawFragmentPrepend);a>0;){let u=s[a-1];u=De(u)?u:l.rawCreateTextNode.call(l.rawDocument,u),Le(this,Re(u),null,c),a--}},t.prototype.insertAdjacentElement=function(i,s){var a;if(s?.__MICRO_APP_NAME__&&he(s)){const c=O.get(s.__MICRO_APP_NAME__);if(c?.container){const u=hn(s,c);if(!he(u))return s;const d=(a=fn(this,u,c))!==null&&a!==void 0?a:this;return l.rawInsertAdjacentElement.call(d,i,u)}}return l.rawInsertAdjacentElement.call(this,i,s)};function n(i){const s=Je()||Q();if((i===document.body||i===document.head)&&s){const a=O.get(s);if(a?.container){if(i===document.body)return a.querySelector("micro-app-body");if(i===document.head)return a.querySelector("micro-app-head")}}return i}function o(i,s,a,c,u){if(i){const d=Je()||Q();if(d&&be(d)){const A=O.get(d);if(Wo(s))return A.sandBox.microHead[u](c);if(et(s))return A.sandBox.microBody[u](c)}}return a}t.prototype.querySelector=function(s){var a;const c=(a=n(this))!==null&&a!==void 0?a:this,u=l.rawElementQuerySelector.call(c,s);return o(Ue(u)&&c!==this,c,u,s,"querySelector")},t.prototype.querySelectorAll=function(s){var a;const c=(a=n(this))!==null&&a!==void 0?a:this,u=l.rawElementQuerySelectorAll.call(c,s);return o(!u.length&&c!==this,c,u,s,"querySelectorAll")},t.prototype.setAttribute=function(s,a){var c,u;if(/^micro-app(-\S+)?/i.test(this.tagName)&&s==="data"&&this.setAttribute!==t.prototype.setAttribute)this.setAttribute(s,a);else{const d=this.__MICRO_APP_NAME__||Q();if(d&&O.has(d)&&((s==="src"||s==="srcset")&&/^(img|script|video|audio|source|embed)$/i.test(this.tagName)||s==="href"&&/^(link|image)$/i.test(this.tagName)||s==="href"&&/^(a)$/i.test(this.tagName)&&!/^#/.test(a))){const A=O.get(d),b=(c=_?.options)===null||c===void 0?void 0:c.aHrefResolver;s==="href"&&/^a$/i.test(this.tagName)&&typeof b=="function"?a=b(a,d,A.url):a=z(a,A.url)}if(l.rawSetAttribute.call(this,s,a),No(this)||Io(this)||Co(this)){let A=!1;!((u=_?.options)===null||u===void 0)&&u.includeCrossOrigin&&S(_.options.includeCrossOrigin)&&(A=_.options.includeCrossOrigin(a)),A&&(node.crossOrigin="anonymous")}}},H(e.prototype,"parentNode",{configurable:!0,enumerable:!0,get(){var i,s,a;const c=Je()||Q();if(c&&this===l.rawDocument.firstElementChild){const d=(a=(s=(i=O.get(c))===null||i===void 0?void 0:i.sandBox)===null||s===void 0?void 0:s.proxyWindow)===null||a===void 0?void 0:a.document;if(d)return d}return l.rawParentNodeDesc.get.call(this)}}),H(t.prototype,"innerHTML",{configurable:!0,enumerable:!0,get(){return l.rawInnerHTMLDesc.get.call(this)},set(i){l.rawInnerHTMLDesc.set.call(this,i);const s=this.__MICRO_APP_NAME__||Je()||Q();Array.from(this.children).forEach(a=>{he(a)&&s&&F(a,s)})}}),e.prototype.cloneNode=function(s){const a=l.rawCloneNode.call(this,s);return F(a,this.__MICRO_APP_NAME__)}}function Re(t){return F(t,Q())}function Us(){const t=l.rawDocument,e=l.rawRootDocument;function r(i){return Ho(i)?t:i}e.prototype.createElement=function(s,a){const c=l.rawCreateElement.call(r(this),s,a);return Re(c)},e.prototype.createElementNS=function(s,a,c){const u=l.rawCreateElementNS.call(r(this),s,a,c);return Re(u)},e.prototype.createDocumentFragment=function(){const s=l.rawCreateDocumentFragment.call(r(this));return Re(s)},e.prototype.createComment=function(s){const a=l.rawCreateComment.call(r(this),s);return Re(a)};function n(i){var s,a;const c=r(this),u=Q();return!u||!i||ye(i)||t!==c?l.rawQuerySelector.call(c,i):(a=(s=O.get(u))===null||s===void 0?void 0:s.querySelector(i))!==null&&a!==void 0?a:null}function o(i){var s,a;const c=r(this),u=Q();return!u||!i||ye(i)||t!==c?l.rawQuerySelectorAll.call(c,i):(a=(s=O.get(u))===null||s===void 0?void 0:s.querySelectorAll(i))!==null&&a!==void 0?a:[]}e.prototype.querySelector=n,e.prototype.querySelectorAll=o,e.prototype.getElementById=function(s){const a=r(this);if(!Q()||pe(s))return l.rawGetElementById.call(a,s);try{return n.call(a,`#${s}`)}catch{return l.rawGetElementById.call(a,s)}},e.prototype.getElementsByClassName=function(s){const a=r(this);if(!Q()||pe(s))return l.rawGetElementsByClassName.call(a,s);try{return o.call(a,`.${s}`)}catch{return l.rawGetElementsByClassName.call(a,s)}},e.prototype.getElementsByTagName=function(s){var a;const c=r(this),u=Q();if(!u||ye(s)||pe(s)||!(!((a=O.get(u))===null||a===void 0)&&a.inline)&&/^script$/i.test(s))return l.rawGetElementsByTagName.call(c,s);try{return o.call(c,s)}catch{return l.rawGetElementsByTagName.call(c,s)}},e.prototype.getElementsByName=function(s){const a=r(this);if(!Q()||pe(s))return l.rawGetElementsByName.call(a,s);try{return o.call(a,`[name=${s}]`)}catch{return l.rawGetElementsByName.call(a,s)}}}function Ws(){const t=l.rawRootDocument;t.prototype.createElement=l.rawCreateElement,t.prototype.createElementNS=l.rawCreateElementNS,t.prototype.createDocumentFragment=l.rawCreateDocumentFragment,t.prototype.querySelector=l.rawQuerySelector,t.prototype.querySelectorAll=l.rawQuerySelectorAll,t.prototype.getElementById=l.rawGetElementById,t.prototype.getElementsByClassName=l.rawGetElementsByClassName,t.prototype.getElementsByTagName=l.rawGetElementsByTagName,t.prototype.getElementsByName=l.rawGetElementsByName}function mn(){G(),Ws();const t=l.rawRootElement,e=l.rawRootNode;e.prototype.appendChild=l.rawAppendChild,e.prototype.insertBefore=l.rawInsertBefore,e.prototype.replaceChild=l.rawReplaceChild,e.prototype.removeChild=l.rawRemoveChild,e.prototype.cloneNode=l.rawCloneNode,t.prototype.append=l.rawAppend,t.prototype.prepend=l.rawPrepend,t.prototype.querySelector=l.rawElementQuerySelector,t.prototype.querySelectorAll=l.rawElementQuerySelectorAll,t.prototype.setAttribute=l.rawSetAttribute,H(e.prototype,"parentNode",l.rawParentNodeDesc),H(t.prototype,"innerHTML",l.rawInnerHTMLDesc)}let ur=!1;function Fs(){if(!ur){ur=!0;const t=Y("style");l.rawSetAttribute.call(t,"type","text/css"),t.textContent=`
${_.tagName}, micro-app-body { display: block; } 
micro-app-head { display: none; }`,l.rawDocument.head.appendChild(t)}}const l={activeSandbox:0};function Hs(){if(st){const t=window.rawWindow||Function("return window")(),e=window.rawDocument||Function("return document")(),r=t.Document||Function("return Document")(),n=t.Element,o=t.Node,i=t.EventTarget,s=t.DocumentFragment,a=o.prototype.appendChild,c=o.prototype.insertBefore,u=o.prototype.replaceChild,d=o.prototype.removeChild,A=n.prototype.setAttribute,b=n.prototype.append,M=n.prototype.prepend,D=s.prototype.append,g=s.prototype.prepend,P=o.prototype.cloneNode,w=n.prototype.querySelector,v=n.prototype.querySelectorAll,h=n.prototype.insertAdjacentElement,f=Object.getOwnPropertyDescriptor(n.prototype,"innerHTML"),E=Object.getOwnPropertyDescriptor(o.prototype,"parentNode"),p=r.prototype.createElement,m=r.prototype.createElementNS,R=r.prototype.createTextNode,T=r.prototype.createDocumentFragment,L=r.prototype.createComment,y=r.prototype.querySelector,C=r.prototype.querySelectorAll,Ee=r.prototype.getElementById,vn=r.prototype.getElementsByClassName,gn=r.prototype.getElementsByTagName,En=r.prototype.getElementsByName,wn=new Proxy(t.Image,{construct(Cn,In){return F(new Cn(...In),Q())}}),An=t.setInterval,bn=t.setTimeout,Pn=t.clearInterval,Rn=t.clearTimeout,Sn=t.history.pushState,yn=t.history.replaceState,Mn=i.prototype.addEventListener,On=i.prototype.removeEventListener,Dn=i.prototype.dispatchEvent;window.__MICRO_APP_BASE_APPLICATION__=!0,k(l,{supportModuleScript:Go(),rawWindow:t,rawDocument:e,rawRootDocument:r,rawRootElement:n,rawRootNode:o,rawDocumentFragment:s,rawSetAttribute:A,rawAppendChild:a,rawInsertBefore:c,rawReplaceChild:u,rawRemoveChild:d,rawAppend:b,rawPrepend:M,rawFragmentAppend:D,rawFragmentPrepend:g,rawCloneNode:P,rawElementQuerySelector:w,rawElementQuerySelectorAll:v,rawInsertAdjacentElement:h,rawInnerHTMLDesc:f,rawParentNodeDesc:E,rawCreateElement:p,rawCreateElementNS:m,rawCreateDocumentFragment:T,rawCreateTextNode:R,rawCreateComment:L,rawQuerySelector:y,rawQuerySelectorAll:C,rawGetElementById:Ee,rawGetElementsByClassName:vn,rawGetElementsByTagName:gn,rawGetElementsByName:En,ImageProxy:wn,rawSetInterval:An,rawSetTimeout:bn,rawClearInterval:Pn,rawClearTimeout:Rn,rawPushState:Sn,rawReplaceState:yn,rawAddEventListener:Mn,rawRemoveEventListener:On,rawDispatchEvent:Dn}),Fs()}}function js(t){class e extends HTMLElement{constructor(){super(...arguments),this.isWaiting=!1,this.cacheData=null,this.connectedCount=0,this.connectStateMap=new Map,this._appName="",this.appUrl="",this.ssrUrl="",this.version=Po,this.handleAttributeUpdate=()=>{this.isWaiting=!1;const n=$(this.getAttribute("name")),o=bt(this.getAttribute("url"),this.appName);if(this.legalAttribute("name",n)&&this.legalAttribute("url",o)){const i=O.get(n);if(n!==this.appName&&i&&!i.isUnmounted()&&!i.isHidden()&&!i.isPrefetch)return this.setAttribute("name",this.appName),I(`app name conflict, an app named ${n} is running`);(n!==this.appName||o!==this.appUrl)&&(n===this.appName?this.unmount(!0,()=>{this.actionsForAttributeChange(n,o,i)}):this.getKeepAliveModeResult()?(this.handleHiddenKeepAliveApp(),this.actionsForAttributeChange(n,o,i)):this.unmount(!1,()=>{this.actionsForAttributeChange(n,o,i)}))}else n!==this.appName&&this.setAttribute("name",this.appName)}}static get observedAttributes(){return["name","url"]}connectedCallback(){Object.getPrototypeOf(this)!==e.prototype&&Object.setPrototypeOf(this,e.prototype);const n=++this.connectedCount;this.connectStateMap.set(n,!0);const o=this.appName&&this.appUrl;te(()=>{this.connectStateMap.get(n)&&(fe(this,this.appName,N.CREATED),o&&this.handleConnected())})}disconnectedCallback(){this.connectStateMap.set(this.connectedCount,!1),this.handleDisconnected()}reload(n){return new Promise(o=>{const i=()=>{this.removeEventListener(N.MOUNTED,i),this.removeEventListener(N.AFTERSHOW,i),o(!0)};this.addEventListener(N.MOUNTED,i),this.addEventListener(N.AFTERSHOW,i),this.handleDisconnected(n,()=>{this.handleConnected()})})}handleDisconnected(n=!1,o){const i=O.get(this.appName);i&&!i.isUnmounted()&&!i.isHidden()&&(this.getKeepAliveModeResult()&&!n?this.handleHiddenKeepAliveApp(o):this.unmount(n,o))}attributeChangedCallback(n,o,i){if(this.legalAttribute(n,i)&&this[n===Ne.NAME?"appName":"appUrl"]!==i)if(n===Ne.URL&&(!this.appUrl||!this.connectStateMap.get(this.connectedCount))){if(i=bt(i,this.appName),!i)return I(`Invalid attribute url ${i}`,this.appName);this.appUrl=i,this.handleInitialNameAndUrl()}else if(n===Ne.NAME&&(!this.appName||!this.connectStateMap.get(this.connectedCount))){const s=$(i);if(!s)return I(`Invalid attribute name ${i}`,this.appName);this.cacheData&&(_.setData(s,this.cacheData),this.cacheData=null),this.appName=s,s!==i&&this.setAttribute("name",this.appName),this.handleInitialNameAndUrl()}else this.isWaiting||(this.isWaiting=!0,te(this.handleAttributeUpdate))}handleInitialNameAndUrl(){this.connectStateMap.get(this.connectedCount)&&this.handleConnected()}handleConnected(){if(!(!this.appName||!this.appUrl))if(this.getDisposeResult("shadowDOM")&&!this.shadowRoot&&S(this.attachShadow)&&this.attachShadow({mode:"open"}),this.updateSsrUrl(this.appUrl),O.has(this.appName)){const n=O.get(this.appName),o=n.ssrUrl||n.url,i=this.ssrUrl||this.appUrl;n.isHidden()&&n.url===this.appUrl?this.handleShowKeepAliveApp(n):o===i&&(n.isUnmounted()||n.isPrefetch&&this.sameCoreOptions(n))?this.handleMount(n):n.isPrefetch||n.isUnmounted()?this.handleCreateApp():I(`app name conflict, an app named ${this.appName} with url ${o} is running`)}else this.handleCreateApp()}actionsForAttributeChange(n,o,i){var s;this.updateSsrUrl(o),this.appName=n,this.appUrl=o,((s=this.shadowRoot)!==null&&s!==void 0?s:this).innerHTML="",n!==this.getAttribute("name")&&this.setAttribute("name",this.appName),i?i.isHidden()?i.url===this.appUrl?this.handleShowKeepAliveApp(i):I(`app name conflict, an app named ${this.appName} is running`):i.url===this.appUrl&&i.ssrUrl===this.ssrUrl?this.handleMount(i):this.handleCreateApp():this.handleCreateApp()}legalAttribute(n,o){return!B(o)||!o?(I(`unexpected attribute ${n}, please check again`,this.appName),!1):!0}handleCreateApp(){const n={};Array.prototype.slice.call(this.attributes).forEach(({name:s,value:a})=>{s.startsWith("data-")&&(n[s]=a)});const o=()=>{var s;return new ln({name:this.appName,url:this.appUrl,container:(s=this.shadowRoot)!==null&&s!==void 0?s:this,scopecss:this.useScopecss(),useSandbox:this.useSandbox(),inline:this.getDisposeResult("inline"),iframe:this.getDisposeResult("iframe"),ssrUrl:this.ssrUrl,routerMode:this.getMemoryRouterMode(),attrs:n})},i=O.get(this.appName);i?i.isPrerender?this.unmount(!0,o):(i.actionsForCompletelyDestroy(),o()):o()}handleMount(n){n.isPrefetch=!1,n.setAppState(j.BEFORE_MOUNT),te(()=>this.mount(n))}mount(n){var o;n.mount({container:(o=this.shadowRoot)!==null&&o!==void 0?o:this,inline:this.getDisposeResult("inline"),routerMode:this.getMemoryRouterMode(),baseroute:this.getBaseRouteCompatible(),defaultPage:this.getDefaultPage(),disablePatchRequest:this.getDisposeResult("disable-patch-request"),fiber:this.getDisposeResult("fiber")})}unmount(n,o){const i=O.get(this.appName);i&&!i.isUnmounted()&&i.unmount({destroy:n||this.getDestroyCompatibleResult(),clearData:this.getDisposeResult("clear-data"),keepRouteState:this.getDisposeResult("keep-router-state"),unmountcb:o}),delete this.__MICRO_APP_NAME__}handleHiddenKeepAliveApp(n){const o=O.get(this.appName);o&&!o.isUnmounted()&&!o.isHidden()&&o.hiddenKeepAliveApp(n)}handleShowKeepAliveApp(n){te(()=>{var o;return n.showKeepAliveApp((o=this.shadowRoot)!==null&&o!==void 0?o:this)})}getDisposeResult(n){return(this.compatibleProperties(n)||!!_.options[n])&&this.compatibleDisableProperties(n)}compatibleProperties(n){return n==="disable-scopecss"?this.hasAttribute("disable-scopecss")||this.hasAttribute("disableScopecss"):n==="disable-sandbox"?this.hasAttribute("disable-sandbox")||this.hasAttribute("disableSandbox"):this.hasAttribute(n)}compatibleDisableProperties(n){return n==="disable-scopecss"?this.getAttribute("disable-scopecss")!=="false"&&this.getAttribute("disableScopecss")!=="false":n==="disable-sandbox"?this.getAttribute("disable-sandbox")!=="false"&&this.getAttribute("disableSandbox")!=="false":this.getAttribute(n)!=="false"}useScopecss(){return!(this.getDisposeResult("disable-scopecss")||this.getDisposeResult("shadowDOM"))}useSandbox(){return!this.getDisposeResult("disable-sandbox")}sameCoreOptions(n){return n.scopecss===this.useScopecss()&&n.useSandbox===this.useSandbox()&&n.iframe===this.getDisposeResult("iframe")}getBaseRouteCompatible(){var n,o;return(o=(n=this.getAttribute("baseroute"))!==null&&n!==void 0?n:this.getAttribute("baseurl"))!==null&&o!==void 0?o:""}getDestroyCompatibleResult(){return this.getDisposeResult("destroy")||this.getDisposeResult("destory")}getKeepAliveModeResult(){return this.getDisposeResult("keep-alive")&&!this.getDestroyCompatibleResult()}updateSsrUrl(n){if(this.getDisposeResult("ssr"))if(this.getDisposeResult("disable-memory-router")||this.getDisposeResult("disableSandbox")){const o=l.rawWindow.location;this.ssrUrl=z(o.pathname+o.search,n)}else{let o=Ji(this.appName,n);const i=this.getDefaultPage();if(!o&&i){const s=W(i,n);o=s.origin+s.pathname+s.search}this.ssrUrl=o}else this.ssrUrl&&(this.ssrUrl="")}getDefaultPage(){return ze.getDefaultPage(this.appName)||this.getAttribute("default-page")||this.getAttribute("defaultPage")||""}getMemoryRouterMode(){return kr(this.getAttribute("router-mode"),this.compatibleProperties("disable-memory-router")&&this.compatibleDisableProperties("disable-memory-router"))}setAttribute(n,o){if(n==="data")if(U(o)){const i={};Object.getOwnPropertyNames(o).forEach(s=>{B(s)&&s.indexOf("__")===0||(i[s]=o[s])}),this.data=i}else o!=="[object Object]"&&ge("property data must be an object",this.appName);else l.rawSetAttribute.call(this,n,o)}getRouterEventDelay(){let n=parseInt(this.getAttribute("router-event-delay"));return isNaN(n)&&(n=parseInt(S(_.options["router-event-delay"])?_.options["router-event-delay"](this.appName):_.options["router-event-delay"])),isNaN(n)?0:n}set data(n){this.appName?_.setData(this.appName,n):this.cacheData=n}get data(){return this.appName?_.getData(this.appName,!0):this.cacheData?this.cacheData:null}set appName(n){n!==this._appName&&(_.changeEventAppName(n,this._appName),this._appName=n)}get appName(){return this._appName}get publicPath(){return lt(this.appUrl)}get baseRoute(){return this.getBaseRouteCompatible()}}window.customElements.define(t,e)}function hr(t,e){if(!st)return I("preFetch is only supported in browser environment");ht(()=>{const r=wt(e)?e:_.options.prefetchDelay;setTimeout(()=>{$s(t)},wt(r)?r:3e3)})}function $s(t){S(t)&&(t=t()),le(t)&&t.reduce((e,r)=>e.then(()=>Gs(r)),Promise.resolve())}function Gs(t){return Ar(e=>{var r,n,o,i,s,a;if(U(t)&&navigator.onLine)if(t.name=$(t.name),t.url=bt(t.url,t.name),t.name&&t.url&&!O.has(t.name)){const c=new ln({name:t.name,url:t.url,isPrefetch:!0,scopecss:!((n=(r=t["disable-scopecss"])!==null&&r!==void 0?r:t.disableScopecss)!==null&&n!==void 0?n:_.options["disable-scopecss"]),useSandbox:!((i=(o=t["disable-sandbox"])!==null&&o!==void 0?o:t.disableSandbox)!==null&&i!==void 0?i:_.options["disable-sandbox"]),inline:(s=t.inline)!==null&&s!==void 0?s:_.options.inline,iframe:(a=t.iframe)!==null&&a!==void 0?a:_.options.iframe,prefetchLevel:t.level&&nr.includes(t.level)?t.level:_.options.prefetchLevel&&nr.includes(_.options.prefetchLevel)?_.options.prefetchLevel:2}),u=c.onLoad,d=c.onLoadError;c.onLoad=A=>{c.isPrerender&&k(A,{defaultPage:t["default-page"],routerMode:kr(t["router-mode"]),baseroute:t.baseroute,disablePatchRequest:t["disable-patch-request"]}),e(),u.call(c,A)},c.onLoadError=(...A)=>{e(),d.call(c,...A)}}else e();else e()})}function qs(t){U(t)&&ht(()=>{dr(t.js,"js",J.script),dr(t.css,"css",J.link)})}function dr(t,e,r){if(le(t)){const n=t.filter(i=>B(i)&&wr(i,e)&&!r.hasInfo(i)),o=n.map(i=>Ae(i));ut(o,i=>{const s=n[i.index];e==="js"?r.hasInfo(s)||r.setInfo(s,{code:i.data,isExternal:!1,appSpace:{}}):r.hasInfo(s)||r.setInfo(s,{code:i.data,appSpace:{}})},i=>{I(i)})}}function Oe({excludeHiddenApp:t=!1,excludePreRender:e=!1}={}){const r=[];return O.forEach((n,o)=>{!n.isUnmounted()&&(!n.isPrefetch||n.isPrerender&&!e)&&(!t||!n.isHidden())&&r.push(o)}),r}function Ks(){return Array.from(O.keys())}function _n(t,e){const r=O.get($(t));return new Promise(n=>{if(r)if(r.isUnmounted()||r.isPrefetch)r.isPrerender?r.unmount({destroy:!!e?.destroy,clearData:!!e?.clearData,keepRouteState:!1,unmountcb:n.bind(null,!0)}):(e?.destroy&&r.actionsForCompletelyDestroy(),n(!0));else if(r.isHidden())e?.destroy?r.unmount({destroy:!0,clearData:!0,keepRouteState:!0,unmountcb:n.bind(null,!0)}):e?.clearAliveState?r.unmount({destroy:!1,clearData:!!e.clearData,keepRouteState:!0,unmountcb:n.bind(null,!0)}):n(!0);else{const o=de(r.container),i=()=>{o.removeEventListener(N.UNMOUNT,i),o.removeEventListener(N.AFTERHIDDEN,s),n(!0)},s=()=>{o.removeEventListener(N.UNMOUNT,i),o.removeEventListener(N.AFTERHIDDEN,s),n(!0)};if(o.addEventListener(N.UNMOUNT,i),o.addEventListener(N.AFTERHIDDEN,s),e?.destroy){let a,c;o.hasAttribute("destroy")&&(a=o.getAttribute("destroy")),o.hasAttribute("destory")&&(c=o.getAttribute("destory")),o.setAttribute("destroy","true"),o.parentNode.removeChild(o),o.removeAttribute("destroy"),B(a)&&o.setAttribute("destroy",a),B(c)&&o.setAttribute("destory",c)}else if(e?.clearAliveState&&o.hasAttribute("keep-alive")){const a=o.getAttribute("keep-alive");o.removeAttribute("keep-alive");let c=null;e.clearData&&(c=o.getAttribute("clear-data"),o.setAttribute("clear-data","true")),o.parentNode.removeChild(o),o.setAttribute("keep-alive",a),B(c)&&o.setAttribute("clear-data",c)}else{let a=null;e?.clearData&&(a=o.getAttribute("clear-data"),o.setAttribute("clear-data","true")),o.parentNode.removeChild(o),B(a)&&o.setAttribute("clear-data",a)}}else ge(`app ${t} does not exist when unmountApp`),n(!1)})}function Vs(t){return Array.from(O.keys()).reduce((e,r)=>e.then(()=>_n(r,t)),Promise.resolve(!0))}function Qs(t,e){return new Promise(r=>{const n=O.get($(t));if(n){const o=n.container&&de(n.container);if(o){const i=_.getData(t);n.isReloading=!0,o.reload(e).then(()=>{i&&_.setData(t,i),n.isReloading=!1,r(!0)})}else ge(`app ${t} is not rendered, cannot use reload`),r(!1)}else ge(`app ${t} does not exist when reload app`),r(!1)})}function Xs(t){return new Promise(e=>{if(!U(t))return I("renderApp options must be an object");const r=he(t.container)?t.container:B(t.container)?document.querySelector(t.container):null;if(!he(r))return I("Target container is not a DOM element.");const n=Y(_.tagName);for(const a in t)if(a==="onDataChange")S(t[a])&&n.addEventListener("datachange",t[a]);else if(a==="lifeCycles"){const c=t[a];if(U(c))for(const u in c)u.toUpperCase()in N&&S(c[u])&&n.addEventListener(u.toLowerCase(),c[u])}else a!=="container"&&n.setAttribute(a,t[a]);const o=()=>{s(),e(!0)},i=()=>{s(),e(!1)},s=()=>{n.removeEventListener(N.MOUNTED,o),n.removeEventListener(N.ERROR,i)};n.addEventListener(N.MOUNTED,o),n.addEventListener(N.ERROR,i),r.appendChild(n)})}class zs extends Ti{constructor(){super(...arguments),this.tagName="micro-app",this.hasInit=!1,this.options={},this.router=ze,this.preFetch=hr,this.unmountApp=_n,this.unmountAllApps=Vs,this.getActiveApps=Oe,this.getAllApps=Ks,this.reload=Qs,this.renderApp=Xs}start(e){var r,n;if(!st||!window.customElements)return I("micro-app is not supported in this environment");if(this.hasInit)return I("microApp.start executed repeatedly");if(this.hasInit=!0,e?.tagName)if(/^micro-app(-\S+)?/.test(e.tagName))this.tagName=e.tagName;else return I(`${e.tagName} is invalid tagName`);if(Hs(),window.customElements.get(this.tagName))return ge(`element ${this.tagName} is already defined`);if(U(e)&&(this.options=e,e["disable-scopecss"]=(r=e["disable-scopecss"])!==null&&r!==void 0?r:e.disableScopecss,e["disable-sandbox"]=(n=e["disable-sandbox"])!==null&&n!==void 0?n:e.disableSandbox,e.preFetchApps&&hr(e.preFetchApps),e.globalAssets&&qs(e.globalAssets),U(e.plugins))){const o=e.plugins.modules;if(U(o))for(const i in o){const s=$(i);s&&i!==s&&(o[s]=o[i],delete o[i])}}js(this.tagName)}}const _=new zs;async function na(t){await Bn({overrides:Un});const e=no(so);if(Wn){const{setupMockData:r}=await V(async()=>{const{setupMockData:n}=await import("./index-BK-4Of0r.js");return{setupMockData:n}},__vite__mapDeps([66,1,2,3]));r()}_.start({tagName:Et.powerByMicro?`micro-app-${Et.baseRoute.slice(1).toLowerCase()}`:"micro-app","disable-memory-router":!0,"disable-patch-request":!0,"router-mode":"native",iframeSrc:`${window.origin}/empty.html`,fetch:(r,n)=>{const o={};return window.fetch(r,Object.assign({},n,o)).then(i=>i.text())}}),Fn(e,{level:Kn,name:qn}),await oo(e),io(e),bo(e),e.mount("#app"),gt.info("namespace",t),Hn(()=>{if(ae.app.dynamicTitle){const r=Dt.currentRoute.value.meta?.title,n=(r?`${jn(r)} - `:"")+ae.app.name;$n(n)}}),Gn(()=>ae.theme,r=>{_.setGlobalData({theme:r})})}export{na as bootstrap};
