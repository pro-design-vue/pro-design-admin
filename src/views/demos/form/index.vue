<!--
 * @Author: shen
 * @Date: 2025-05-27 16:33:00
 * @LastEditors: shen
 * @LastEditTime: 2025-09-02 15:53:23
 * @Description:
-->
<script setup lang="ts">
import { onMounted, useTemplateRef } from 'vue'
import {
  ProFieldType,
  ProForm,
  ProPage,
  ProQueryFilter,
  ProModalForm,
  ProButton,
  type ProFormItemType,
  type ProQueryFilterInstance,
} from 'pro-design-vue'
import { getPublicConfig } from '@/api'
import { sleep } from '@/shared/utils'
import { Card, Image } from 'ant-design-vue'
import { useApplication } from '@/hooks'

const mounted = false
onMounted(async () => {
  console.log('onMounted')
  // mounted = true
  // const resut = await getPublicConfig()
  // console.log('ğŸš€ ~ onMounted ~ resut:', resut.data.id)
})

const { onActivated, onDeactivated } = useApplication()

onActivated(() => {
  console.log('main onActivated')
})

onDeactivated(() => {
  console.log('main onDeactivated')
})

const Filter = ProForm.Filter
const filterRef = useTemplateRef<ProQueryFilterInstance>('filterRef')
const filterItems: ProFormItemType[] = [
  {
    name: 'INPUT',
    title: 'æ–‡æœ¬',
    initialValue: '1111',
    allowClear: true,
    rules: [{ required: true, message: 'è¯·è¾“å…¥æ–‡æœ¬', trigger: 'change' }],
  },
  {
    name: 'DIGIT',
    title: 'æ•°å­—',
    fieldType: ProFieldType.DIGIT,
  },
  {
    name: 'DIGIT_RANGE',
    title: 'æ•°å­—åŒºé—´',
    fieldType: ProFieldType.DIGIT_RANGE,
  },
  {
    name: 'SELECT',
    title: 'é€‰æ‹©å™¨',
    fieldType: ProFieldType.SELECT,
    options: [
      { value: '1', label: 'ç”·' },
      { value: '2', label: 'å¥³' },
    ],
  },

  // {
  //   name: 'TREE_SELECT',
  //   title: 'æ ‘å½¢é€‰æ‹©å™¨',
  //   fieldType: ProFieldType.TREE_SELECT,
  //   options: [
  //     {
  //       value: '1',
  //       label: 'å‰æ—çœ',
  //       children: [
  //         { value: '1-1', label: 'é•¿æ˜¥å¸‚' },
  //         { value: '1-2', label: 'å‰æ—å¸‚' },
  //         { value: '1-3', label: 'å››å¹³å¸‚' },
  //       ],
  //     },
  //     {
  //       value: '2',
  //       label: 'é»‘é¾™æ±Ÿçœ',
  //       children: [
  //         { value: '2-1', label: 'å“ˆå°”æ»¨å¸‚' },
  //         { value: '2-2', label: 'é½é½å“ˆå°”å¸‚' },
  //         { value: '2-3', label: 'ç‰¡ä¸¹æ±Ÿå¸‚' },
  //       ],
  //     },
  //   ],
  // },
  // {
  //   name: 'CASCADER',
  //   title: 'çº§è”é€‰æ‹©å™¨',
  //   fieldType: ProFieldType.CASCADER,
  //   options: [
  //     {
  //       value: '1',
  //       label: 'å‰æ—çœ',
  //       children: [
  //         { value: '1-1', label: 'é•¿æ˜¥å¸‚' },
  //         { value: '1-2', label: 'å‰æ—å¸‚' },
  //         { value: '1-3', label: 'å››å¹³å¸‚' },
  //       ],
  //     },
  //     {
  //       value: '2',
  //       label: 'é»‘é¾™æ±Ÿçœ',
  //       children: [
  //         { value: '2-1', label: 'å“ˆå°”æ»¨å¸‚' },
  //         { value: '2-2', label: 'é½é½å“ˆå°”å¸‚' },
  //         { value: '2-3', label: 'ç‰¡ä¸¹æ±Ÿå¸‚' },
  //       ],
  //     },
  //   ],
  // },
  // {
  //   name: 'SELECT',
  //   title: 'é€‰æ‹©å™¨ï¼ˆè¿œç¨‹-æ‰€æœ‰optionséƒ½æ”¯æŒï¼‰',
  //   fieldType: ProFieldType.SELECT,
  //   request: () =>
  //     new Promise((resolve) => {
  //       setTimeout(() => {
  //         resolve([
  //           { value: '1', label: 'ç”·' },
  //           { value: '2', label: 'å¥³' },
  //         ])
  //       }, 3000)
  //     }),
  // },
  {
    name: 'date',
    title: 'æ—¥æœŸ',
    fieldType: ProFieldType.DATE,
  },
  {
    name: 'dateRange',
    title: 'æ—¥æœŸåŒºé—´',
    fieldType: ProFieldType.DATE_RANGE,
  },
  {
    name: 'time',
    title: 'æ—¶é—´',
    fieldType: ProFieldType.TIME,
  },
  {
    name: 'timeRange',
    title: 'æ—¶é—´åŒºé—´',
    fieldType: ProFieldType.TIME_RANGE,
  },
]

const formItems: ProFormItemType[] = [
  {
    name: 'INPUT',
    title: 'æ–‡æœ¬',
    initialValue: '22222',
    readonly: true,
    readonlyProps: {
      copy: true,
    },
    // width: 'md',
  },
  {
    name: 'DIGIT',
    title: 'æ•°å­—',
    fieldType: ProFieldType.DIGIT,
    rules: [{ required: true, message: 'è¯·è¾“å…¥æ–‡æœ¬', trigger: 'change' }],
  },
  {
    name: 'DIGIT_RANGE',
    title: 'æ•°å­—åŒºé—´',
    fieldType: ProFieldType.DIGIT_RANGE,
  },
  {
    name: 'SELECT',
    title: 'é€‰æ‹©å™¨',
    fieldType: ProFieldType.SELECT,
    options: [
      { value: '1', label: 'ç”·' },
      { value: '2', label: 'å¥³' },
    ],
  },

  {
    name: 'TREE_SELECT',
    title: 'æ ‘å½¢é€‰æ‹©å™¨',
    fieldType: ProFieldType.TREE_SELECT,
    options: [
      {
        value: '1',
        label: 'å‰æ—çœ',
        children: [
          { value: '1-1', label: 'é•¿æ˜¥å¸‚' },
          { value: '1-2', label: 'å‰æ—å¸‚' },
          { value: '1-3', label: 'å››å¹³å¸‚' },
        ],
      },
      {
        value: '2',
        label: 'é»‘é¾™æ±Ÿçœ',
        children: [
          { value: '2-1', label: 'å“ˆå°”æ»¨å¸‚' },
          { value: '2-2', label: 'é½é½å“ˆå°”å¸‚' },
          { value: '2-3', label: 'ç‰¡ä¸¹æ±Ÿå¸‚' },
        ],
      },
    ],
  },
  {
    name: 'CASCADER',
    title: 'çº§è”é€‰æ‹©å™¨',
    fieldType: ProFieldType.CASCADER,
    options: [
      {
        value: '1',
        label: 'å‰æ—çœ',
        children: [
          { value: '1-1', label: 'é•¿æ˜¥å¸‚' },
          { value: '1-2', label: 'å‰æ—å¸‚' },
          { value: '1-3', label: 'å››å¹³å¸‚' },
        ],
      },
      {
        value: '2',
        label: 'é»‘é¾™æ±Ÿçœ',
        children: [
          { value: '2-1', label: 'å“ˆå°”æ»¨å¸‚' },
          { value: '2-2', label: 'é½é½å“ˆå°”å¸‚' },
          { value: '2-3', label: 'ç‰¡ä¸¹æ±Ÿå¸‚' },
        ],
      },
    ],
  },
  {
    name: 'SELECT',
    title: 'é€‰æ‹©å™¨ï¼ˆè¿œç¨‹-æ‰€æœ‰optionséƒ½æ”¯æŒï¼‰',
    initialValue: '1',
    fieldType: ProFieldType.SELECT,
    request: () =>
      new Promise((resolve) => {
        setTimeout(() => {
          resolve([
            { value: '1', label: 'ç”·' },
            { value: '2', label: 'å¥³' },
          ])
        }, 3000)
      }),
  },
  {
    name: 'date',
    title: 'æ—¥æœŸ',
    fieldType: ProFieldType.DATE,
  },
  {
    name: 'dateRange',
    title: 'æ—¥æœŸåŒºé—´',
    fieldType: ProFieldType.DATE_RANGE,
  },
  {
    fieldType: ProFieldType.GROUP,
    title: '123123',
    colProps: {
      span: 16,
    },
    children: [
      {
        name: 'time',
        title: 'æ—¶é—´',
        formItemProps: {},
        fieldProps: {},
        colProps: {
          span: 4,
        },
        fieldType: ProFieldType.TIME,
      },
      {
        name: 'timeRange',
        title: 'æ—¶é—´åŒºé—´',
        fieldType: ProFieldType.TIME_RANGE,
      },
      // {
      //   name: 'UPLOAD_BUTTON',
      //   title: 'ç‚¹å‡»ä¸Šä¼ ',
      //   fieldType: ProFieldType.UPLOAD_BUTTON,
      // },
      {
        name: 'UPLOAD_PICTURE',
        title: 'ä¸Šä¼ å›¾ç‰‡',
        allowClear: true,
        fieldType: ProFieldType.UPLOAD_PICTURE,
        rules: [{ required: true, message: 'è¯·é€‰æ‹©å›¾ç‰‡', trigger: 'change' }],
        fieldProps: {
          width: 118,
          height: 118,
          // isCropper: false,
          showTitle: true,
          // customRequest: async (params) => {
          //   try {
          //     const { data, code } = await uploadImageFile(params, { folder: 'tenants' })
          //     if (code === 200) {
          //       return data
          //     }
          //     return null
          //   } catch (error) {
          //     return null
          //   }
          // },
        },
      },
    ],
  },

  {
    name: 'UPLOAD_DRAGGER',
    title: 'æ‹–æ‹½ä¸Šä¼ ',
    fieldType: ProFieldType.UPLOAD_DRAGGER,
    // colProps: {
    //   span: 24,
    // },
  },
  {
    title: 'æ–‡æœ¬åŸŸ',
    name: 'textarea',
    fieldType: ProFieldType.TEXTAREA,
    colProps: {
      span: 24,
    },
  },
]

const formItems2: ProFormItemType[][] = [
  [
    {
      name: 'INPUT',
      title: 'æ–‡æœ¬',
      initialValue: '1111',
      allowClear: true,
      rules: [{ required: true, message: 'è¯·è¾“å…¥æ–‡æœ¬', trigger: 'change' }],
    },
    {
      name: 'DIGIT',
      title: 'æ•°å­—',
      fieldType: ProFieldType.DIGIT,
      rules: [{ required: true, message: 'è¯·è¾“å…¥æ–‡æœ¬', trigger: 'change' }],
    },
    {
      name: 'DIGIT_RANGE',
      title: 'æ•°å­—åŒºé—´',
      fieldType: ProFieldType.DIGIT_RANGE,
    },
  ],
  [
    {
      name: 'date',
      title: 'æ—¥æœŸ',
      fieldType: ProFieldType.DATE,
    },
    {
      name: 'dateRange',
      title: 'æ—¥æœŸåŒºé—´',
      fieldType: ProFieldType.DATE_RANGE,
    },
    {
      name: 'time',
      title: 'æ—¶é—´',
      fieldType: ProFieldType.TIME,
    },
  ],
  [
    {
      name: 'date',
      title: 'æ—¥æœŸ',
      fieldType: ProFieldType.DATE,
    },
    {
      name: 'dateRange',
      title: 'æ—¥æœŸåŒºé—´',
      fieldType: ProFieldType.DATE_RANGE,
    },
    {
      name: 'time',
      title: 'æ—¶é—´',
      fieldType: ProFieldType.TIME,
    },
  ],
]

const handleReset = (val) => {
  console.log('ğŸš€ ~ handleReset ~ val:', val)
}

const handleFinish = async (val) => {
  await sleep(3000)
  console.log('ğŸš€ ~ handleReset ~ val:', val)
  return true
}

const onTest = () => {
  filterRef.value?.reset()
}
</script>

<template>
  <ProPage>
    <template #title> è‡ªå¸¦è·¯ç”±ç¤ºä¾‹é¡µé¢ </template>
    <Card style="margin-bottom: 10px">
      <Filter ref="filterRef" :items="filterItems" @reset="handleReset" @finish="handleFinish" />
    </Card>
    <Card>
      <!-- <ProForm.Steps
        :steps="[
          { title: 'åˆ›å»ºå®éªŒ', description: 'è¿™é‡Œå¡«å…¥çš„éƒ½æ˜¯åŸºæœ¬ä¿¡æ¯' },
          { title: 'è®¾ç½®å‚æ•°', description: 'è¿™é‡Œå¡«å…¥è¿ç»´å‚æ•°' },
          { title: 'ç¬¬ä¸‰æ­¥', description: 'è¿™é‡Œå¡«å…¥è¿ç»´å‚æ•°' },
        ]"
        :items="formItems2"
        @finish="handleFinish"
      /> -->
      <ProForm.Drawer title="ç­–å››" :items="formItems" @finish="handleFinish">
        <template #trigger>
          <ProButton>æ‰“å¼€</ProButton>
        </template>
      </ProForm.Drawer>
      <ProForm grid :col-props="{ span: 8 }" :items="formItems" @finish="handleFinish"> </ProForm>
    </Card>
  </ProPage>
</template>
